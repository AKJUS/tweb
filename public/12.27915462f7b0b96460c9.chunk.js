(this.webpackJsonp=this.webpackJsonp||[]).push([[12,4,6,7,25,26,27],[,,,,,,,,,,,,function(e,t,s){"use strict";function i(e){if(e=e||window.event){e=e.originalEvent||e;try{e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0}catch(e){}}return!1}s.d(t,"a",(function(){return i}))},,function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return n}));const i=s(18).isTouchSupported?"mousedown":"click";function a(e,t,s={}){const a=s.listenerSetter?s.listenerSetter.add.bind(s.listenerSetter,e):e.addEventListener.bind(e);s.listenerSetter?s.listenerSetter.removeManual.bind(s.listenerSetter,e):e.removeEventListener.bind(e);s.touchMouseDown=!0,a(i,t,s)}function n(e,t,s){"touchend"===i?e.removeEventListener("touchstart",t,s):e.removeEventListener(i,t,s)}},,,,function(e,t,s){"use strict";s.r(t),s.d(t,"isTouchSupported",(function(){return i}));const i="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch},function(e,t,s){"use strict";var i=s(11),a=s(27);t.a=(e,t={})=>{const s=document.createElement(t.asDiv?"div":"button");return s.className=e+(t.icon?" tgico-"+t.icon:""),t.noRipple||(t.rippleSquare&&s.classList.add("rp-square"),Object(a.ripple)(s)),t.onlyMobile&&s.classList.add("only-handhelds"),t.disabled&&s.setAttribute("disabled","true"),t.text&&s.append(Object(i.i18n)(t.text)),s}},,function(e,t,s){"use strict";s.r(t),s.d(t,"STATE_INIT",(function(){return f})),s.d(t,"AppStateManager",(function(){return _}));var i=s(38),a=s(10),n=s(66),o=s(24),r=s(15),d=s(3),l=s(9),c=s(71),h=s(0),p=s(89),u=s(54),g=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const m=d.a.version,f={allDialogsLoaded:{},pinnedOrders:{},contactsList:[],updates:{},filters:{},maxSeenMsgId:0,stateCreatedTime:Date.now(),recentEmoji:[],topPeers:[],recentSearch:[],version:m,authState:{_:h.isMobile?"authStateSignIn":"authStateSignQr"},hiddenPinnedMessages:{},settings:{messagesTextSize:16,sendShortcut:"enter",animationsEnabled:!0,autoDownload:{contacts:!0,private:!0,groups:!0,channels:!0},autoPlay:{gifs:!0,videos:!0},stickers:{suggest:!0,loop:!0},emoji:{suggest:!0,big:!0},themes:[{name:"day",background:{type:"image",blur:!1,slug:"ByxGo2lrMFAIAAAAmkJxZabh8eM",highlightningColor:"hsla(85.5319, 36.9171%, 40.402%, 0.4)"}},{name:"night",background:{type:"color",blur:!1,color:"#0f0f0f",highlightningColor:"hsla(0, 0%, 3.82353%, 0.4)"}}],theme:"system",notifications:{sound:!1}},keepSigned:!0},v=Object.keys(f),X=["contactsList","stateCreatedTime","maxSeenMsgId","filters","topPeers"];class _ extends i.a{constructor(){super(),this.log=Object(o.b)("STATE"),this.neededPeers=new Map,this.singlePeerMap=new Map,this.storages={users:new c.a(p.a,"users"),chats:new c.a(p.a,"chats"),dialogs:new c.a(p.a,"dialogs")},this.storagesResults={},this.storage=n.a,this.loadSavedState()}loadSavedState(){return this.loaded||(console.time("load state"),this.loaded=new Promise(e=>{const t=Object.keys(this.storages),s=t.map(e=>this.storages[e].getAll()),i=v.map(e=>n.a.get(e)).concat(u.a.get("user_auth")).concat(n.a.get("user_auth")).concat(s);Promise.all(i).then(s=>g(this,void 0,void 0,(function*(){let i=this.state={};for(let e=0,t=v.length;e<t;++e){const t=v[e],a=s[e];void 0!==a?i[t]=a:this.pushToState(t,Object(r.a)(f[t]))}s.splice(0,v.length);let o=s.shift(),c=s.shift();if(!o&&c){o=c;const e=["dc","server_time_offset","xt_instance"];for(let t=1;t<=5;++t)e.push(`dc${t}_server_salt`),e.push(`dc${t}_auth_key`);const t=yield Promise.all(e.map(e=>n.a.get(e)));e.push("user_auth"),t.push("number"==typeof o?{dcID:t[0]||d.a.baseDcId,date:Date.now()/1e3|0,id:o}:o);let s={};e.forEach((e,i)=>{s[e]=t[i]}),yield u.a.set(s)}o&&(i.authState={_:"authStateSignedIn"},a.default.dispatchEvent("user_auth","number"==typeof o?{dcID:0,date:Date.now()/1e3|0,id:o}:o));for(let e=0,i=t.length;e<i;++e)this.storagesResults[t[e]]=s[e];s.splice(0,t.length);const h=Date.now();if(i.stateCreatedTime+864e5<h){l.b&&this.log("will refresh state",i.stateCreatedTime,h);(e=>{e.forEach(e=>{this.pushToState(e,Object(r.a)(f[e]));const t=this.storagesResults[e];t&&t.length&&(t.length=0)})})(X)}if(!i.settings.hasOwnProperty("theme")&&i.settings.hasOwnProperty("nightTheme")&&(i.settings.theme=i.settings.nightTheme?"night":"day",this.pushToState("settings",i.settings)),!i.settings.hasOwnProperty("themes")&&i.settings.background){i.settings.themes=Object(r.a)(f.settings.themes);const e=i.settings.themes.find(e=>e.name===i.settings.theme);e&&(e.background=i.settings.background,this.pushToState("settings",i.settings))}Object(r.k)(f,i,e=>{this.pushToState(e,i[e])}),i.version!==m&&this.pushToState("version",m),a.default.settings=i.settings,l.b&&this.log("state res",i,Object(r.a)(i)),console.timeEnd("load state"),e(i)}))).catch(e)})),this.loaded}getState(){return void 0===this.state?this.loadSavedState():Promise.resolve(this.state)}setByKey(e,t){Object(r.j)(this.state,e,t),a.default.dispatchEvent("settings_updated",{key:e,value:t});const s=e.split(".")[0];this.pushToState(s,this.state[s])}pushToState(e,t,s=!0){s&&(this.state[e]=t),this.storage.set({[e]:t})}requestPeer(e,t,s){let i=this.neededPeers.get(e);i&&i.has(t)||(i||(i=new Set,this.neededPeers.set(e,i)),i.add(t),this.dispatchEvent("peerNeeded",e),void 0!==s&&this.keepPeerSingle(e,t))}isPeerNeeded(e){return this.neededPeers.has(e)}keepPeerSingle(e,t){const s=this.singlePeerMap.get(t);if(s&&s!==e&&this.neededPeers.has(s)){const e=this.neededPeers.get(s);e.delete(t),e.size||(this.neededPeers.delete(s),this.dispatchEvent("peerUnneeded",s))}e&&this.singlePeerMap.set(t,e)}}_.STATE_INIT=f;const y=new _;l.a.appStateManager=y,t.default=y},function(e,t,s){"use strict";s.d(t,"f",(function(){return h})),s.d(t,"g",(function(){return p})),s.d(t,"c",(function(){return g})),s.d(t,"b",(function(){return v})),s.d(t,"d",(function(){return b})),s.d(t,"e",(function(){return M})),s.d(t,"a",(function(){return w}));var i=s(9),a=s(64),n=s(12),o=s(14),r=s(23),d=s(18),l=s(0),c=s(36);function h(e,t=!1){const s='\n  <svg xmlns="http://www.w3.org/2000/svg" class="preloader-circular" viewBox="25 25 50 50">\n  <circle class="preloader-path" cx="50" cy="50" r="20" fill="none" stroke-miterlimit="10"/>\n  </svg>';if(t){const t=document.createElement("div");return t.classList.add("preloader"),t.innerHTML=s,e&&e.appendChild(t),t}return e.insertAdjacentHTML("beforeend",s),e.lastElementChild}function p(e,t="check"){return e.classList.remove("tgico-"+t),e.disabled=!0,h(e),()=>{e.innerHTML="",e.classList.add("tgico-"+t),e.removeAttribute("disabled")}}let u;function g(e){let t=(e=e.replace(/\D/g,"")).slice(0,6);u||(u=a.b.slice().sort((e,t)=>t.phoneCode.length-e.phoneCode.length));let s=u.find(e=>e.phoneCode.split(" and ").find(e=>0===t.indexOf(e.replace(/\D/g,""))));return s?(s=a.a[s.phoneCode]||s,(s.pattern||s.phoneCode).split("").forEach((t,s)=>{" "===t&&" "!==e[s]&&e.length>s&&(e=e.slice(0,s)+" "+e.slice(s))}),{formatted:e,country:s}):{formatted:e,country:s}}i.a.putPreloader=h;let m=e=>{let t=X.getBoundingClientRect(),{clientX:s,clientY:i}=e,a=s>=t.right?s-t.right:t.left-s,n=i>=t.bottom?i-t.bottom:t.top-i;(a>=100||n>=100)&&v()};const f=e=>{v()},v=()=>{X&&(X.classList.remove("active"),X.parentElement.classList.remove("menu-open"),y&&y.remove(),X=null),_&&(_(),_=null),d.isTouchSupported||(window.removeEventListener("mousemove",m),window.removeEventListener("contextmenu",f)),document.removeEventListener(o.a,f),l.isMobileSafari||c.a.removeByType("menu")};window.addEventListener("resize",()=>{X&&v()});let X=null,_=null,y=null;function b(e,t){v(),l.isMobileSafari||c.a.pushItem({type:"menu",onPop:e=>{v()}}),X=e,X.classList.add("active"),X.parentElement.classList.add("menu-open"),y||(y=document.createElement("div"),y.classList.add("btn-menu-overlay"),y.addEventListener(o.a,e=>{Object(n.a)(e),f()})),X.parentElement.insertBefore(y,X),_=t,d.isTouchSupported||(window.addEventListener("mousemove",m),window.addEventListener("contextmenu",f,{once:!0})),document.addEventListener(o.a,f)}function M({pageX:e,pageY:t},s,i){let{scrollWidth:a,scrollHeight:n}=s;const o=document.body.getBoundingClientRect(),d=o.width,l=o.height;i=r.b.isMobile?"right":"left";let c="top";const h={x:{left:e,right:e-a},intermediateX:"right"===i?8:d-a-8,y:{top:t,bottom:t-n},intermediateY:t<l/2?8:l-n-8},p={left:h.x.left+a+8<=d,right:h.x.right>=8},u={top:h.y.top+n+8<=l,bottom:h.y.bottom-8>=8};{let e;e=p[i]?h.x[i]:(i="center",h.intermediateX),s.style.left=e+"px"}{let e;e=u[c]?h.y[c]:(c="center",h.intermediateY),s.style.top=e+"px"}s.className=s.className.replace(/(top|center|bottom)-(left|center|right)/g,""),s.classList.add(("center"===c?c:"bottom")+"-"+("center"===i?i:"left"===i?"right":"left"))}function w(e,t,s){const i=s?s.add.bind(s,e):e.addEventListener.bind(e),a=s?s.removeManual.bind(s,e):e.removeEventListener.bind(e);if(l.isApple&&d.isTouchSupported){let s;const o={capture:!0},r=()=>{clearTimeout(s),a("touchmove",r,o),a("touchend",r,o),a("touchcancel",r,o)};i("touchstart",a=>{a.touches.length>1?r():(i("touchmove",r,o),i("touchend",r,o),i("touchcancel",r,o),s=window.setTimeout(()=>{t(a.touches[0]),r(),X&&e.addEventListener("touchend",n.a,{once:!0})},400))})}else i("contextmenu",d.isTouchSupported?s=>{t(s),X&&e.addEventListener("touchend",n.a,{once:!0})}:t)}},function(e,t,s){"use strict";s.d(t,"c",(function(){return d})),s.d(t,"a",(function(){return i}));var i,a=s(9),n=s(72),o=s(38);class r{constructor(e=0,t=e){this.width=e,this.height=t}aspect(e,t){return Object(n.a)(this.width,this.height,e.width,e.height,t)}aspectFitted(e){return this.aspect(e,!0)}aspectCovered(e){return this.aspect(e,!1)}}function d(e,t){return new r(e,t)}!function(e){e[e.mobile=0]="mobile",e[e.medium=1]="medium",e[e.large=2]="large"}(i||(i={}));class l extends o.a{constructor(){super(),this.screenSizes=[{key:i.mobile,value:600},{key:i.medium,value:1275},{key:i.large,value:1680}],this.sizes={handhelds:{regular:d(270,270),webpage:d(270,200),album:d(270,0),esgSticker:d(68,68),animatedSticker:d(180,180),staticSticker:d(180,180),emojiSticker:d(112,112)},desktop:{regular:d(400,320),webpage:d(400,320),album:d(420,0),esgSticker:d(80,80),animatedSticker:d(200,200),staticSticker:d(200,200),emojiSticker:d(112,112)}},this.isMobile=!1,this.handleResize=()=>{const e=window.innerWidth;let t=this.screenSizes[0].key;for(let s=this.screenSizes.length-1;s>=0;--s)if(this.screenSizes[s].value<e){t=(this.screenSizes[s+1]||this.screenSizes[s]).key;break}const s=this.activeScreen;this.activeScreen=t,this.isMobile=this.activeScreen===i.mobile,this.active=this.isMobile?this.sizes.handhelds:this.sizes.desktop,s!==t&&void 0!==s&&this.dispatchEvent("changeScreen",this.activeScreen,t)},window.addEventListener("resize",()=>{this.rAF&&window.cancelAnimationFrame(this.rAF),this.rAF=window.requestAnimationFrame(()=>{this.handleResize(),this.rAF=0})}),this.handleResize()}}const c=new l;a.a.mediaSizes=c,t.b=c},,,,function(e,t,s){"use strict";s.r(t),s.d(t,"ripple",(function(){return d}));var i=s(1),a=s(56),n=s(18),o=s(10);let r=0;function d(e,t=(()=>Promise.resolve()),s=null,d=!1){if(e.querySelector(".c-ripple"))return;e.classList.add("rp");let l=document.createElement("div");l.classList.add("c-ripple");let c;e.classList.contains("rp-square")&&l.classList.add("is-square"),e[d?"prepend":"append"](l);const h=(e,i)=>{const o=Date.now(),d=document.createElement("div"),h=r++,p=1e3*+window.getComputedStyle(l).getPropertyValue("--ripple-duration").replace("s","");c=()=>{let e=Date.now()-o;const t=()=>{a.a.mutate(()=>{d.remove()}),s&&s(h)};if(e<p){let s=Math.max(p-e,p/2);setTimeout(()=>d.classList.add("hiding"),Math.max(s-p/2,0)),setTimeout(t,s)}else d.classList.add("hiding"),setTimeout(t,p/2);n.isTouchSupported||window.removeEventListener("contextmenu",c),c=null,u=!1},t&&t(h),window.requestAnimationFrame(()=>{const t=l.getBoundingClientRect();d.classList.add("c-ripple__circle");const s=e-t.left,a=i-t.top,n=Math.sqrt(Math.pow(Math.abs(a-t.height/2)+t.height/2,2)+Math.pow(Math.abs(s-t.width/2)+t.width/2,2)),o=s-n/2,r=a-n/2;d.style.width=d.style.height=n+"px",d.style.left=o+"px",d.style.top=r+"px",l.append(d)})},p=t=>t.target!==e&&(["BUTTON","A"].includes(t.target.tagName)||Object(i.a)(t.target,"c-ripple")!==l);let u=!1;if(n.isTouchSupported){let t=()=>{c&&c()};e.addEventListener("touchstart",s=>{if(!o.default.settings.animationsEnabled)return;if(s.touches.length>1||u||p(s))return;u=!0;let{clientX:i,clientY:a}=s.touches[0];h(i,a),e.addEventListener("touchend",t,{once:!0}),window.addEventListener("touchmove",s=>{s.cancelBubble=!0,s.stopPropagation(),t(),e.removeEventListener("touchend",t)},{once:!0})},{passive:!0})}else e.addEventListener("mousedown",t=>{if(![0,2].includes(t.button))return;if(!o.default.settings.animationsEnabled)return;if("0"===e.dataset.ripple||p(t))return;if(u)return void(u=!1);let{clientX:s,clientY:i}=t;h(s,i),window.addEventListener("mouseup",c,{once:!0,passive:!0}),window.addEventListener("contextmenu",c,{once:!0,passive:!0})},{passive:!0})}},function(e,t,s){"use strict";s.d(t,"g",(function(){return n})),s.d(t,"a",(function(){return r})),s.d(t,"c",(function(){return l})),s.d(t,"d",(function(){return c})),s.d(t,"e",(function(){return h})),s.d(t,"f",(function(){return p})),s.d(t,"h",(function(){return u})),s.d(t,"b",(function(){return y}));var i=s(9),a=s(11);const n=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=86400,d=e=>{const t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),s=t.getUTCDay()||7;t.setUTCDate(t.getUTCDate()+4-s);const i=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t.getTime()-i.getTime())/r+1)/7)},l=e=>{const t=new Date,s=t.getTime()/1e3|0,i=e.getTime()/1e3|0;let a;return a=s-i<r&&t.getDate()===e.getDate()?("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2):t.getFullYear()!==e.getFullYear()?e.getDate()+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+(""+e.getFullYear()).slice(-2):s-i<7*r&&d(t)===d(e)?o[e.getDay()].slice(0,3):n[e.getMonth()].slice(0,3)+" "+("0"+e.getDate()).slice(-2),a};function c(e){const t=new Date,s=t.getTime()/1e3|0,i=e.getTime()/1e3|0,n={};return s-i<r&&t.getDate()===e.getDate()?n.hour=n.minute="2-digit":t.getFullYear()!==e.getFullYear()?(n.year=n.day="numeric",n.month="2-digit"):s-i<7*r&&d(t)===d(e)?n.weekday="short":(n.month="short",n.day="numeric"),new a.default.IntlDateElement({date:e,options:n}).element}function h(e){return new a.default.IntlDateElement({date:e,options:{hour:"2-digit",minute:"2-digit"}}).element}i.a&&(i.a.formatDateAccordingToTodayNew=c);const p=(e,t={})=>{const s=t.monthAsNumber?".":" ",i=("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+(t.noSeconds?"":":"+("0"+e.getSeconds()).slice(-2));return(t.leadingZero?("0"+e.getDate()).slice(-2):e.getDate())+s+(t.monthAsNumber?("0"+(e.getMonth()+1)).slice(-2):n[e.getMonth()])+s+e.getFullYear()+(t.noTime?"":", "+i)};function u(e){const t=Date.now();return e?Math.floor(t/1e3):t}const g=new RegExp("20[0-9]{1,2}"),m=new RegExp("(\\w{3,}) ([0-9]{0,4})","i"),f=new RegExp("([0-9]{0,4}) (\\w{2,})","i"),v=new RegExp("^([0-9]{1,4})(\\.| |/|\\-)([0-9]{1,4})$","i"),X=new RegExp("^([0-9]{1,2})(\\.| |/|\\-)([0-9]{1,2})(\\.| |/|\\-)([0-9]{1,4})$","i"),_=[31,29,31,30,31,30,31,31,30,31,30,31];function y(e,t){const s=e.trim().toLowerCase();if(s.length<3)return;if(0==="today".indexOf(s)){const e=new Date,s=e.getFullYear(),i=e.getMonth(),a=e.getDate();e.setFullYear(s,i,a),e.setHours(0,0,0);const n=e.getTime();e.setFullYear(s,i,a+1),e.setHours(0,0,0);const o=e.getTime()-1;return void t.push({title:"Today",minDate:n,maxDate:o})}if(0==="yesterday".indexOf(s)){const e=new Date,s=e.getFullYear(),i=e.getMonth(),a=e.getDate();e.setFullYear(s,i,a),e.setHours(0,0,0);const n=e.getTime()-864e5;e.setFullYear(s,i,a+1),e.setHours(0,0,0);const o=e.getTime()-86400001;return void t.push({title:"Yesterday",minDate:n,maxDate:o})}const i=function(e){const t=new Date;if(e.length<=3)return-1;for(let s=0;s<7;s++)if(t.setDate(t.getDate()+1),0===C(t.getTime()).toLowerCase().indexOf(e))return t.getDay();return-1}(s);if(i>=0){const e=new Date,s=e.getTime(),a=i-e.getDay();e.setDate(e.getDate()+a),e.getTime()>s&&e.setTime(e.getTime()-6048e5);const n=e.getFullYear(),o=e.getMonth(),r=e.getDate();e.setFullYear(n,o,r),e.setHours(0,0,0);const d=e.getTime();e.setFullYear(n,o,r+1),e.setHours(0,0,0);const l=e.getTime()-1;return void t.push({title:C(d),minDate:d,maxDate:l})}let a;if(null===(a=v.exec(s)))if(null===(a=X.exec(s)))if(null===(a=g.exec(s))){if(null!==(a=m.exec(s))){const e=a[1],s=a[2],i=E(e);if(i>=0){const e=+s;if(e>0&&e<=31){return void M(t,e-1,i)}if(e>=2013){return void b(t,i,e)}}}if(null!==(a=f.exec(s))){const e=a[1],s=E(a[2]);if(s>=0){const i=+e;if(i>0&&i<=31){return void M(t,i-1,s)}if(i>=2013){b(t,s,i)}}}}else{let e=+s;const i=(new Date).getFullYear();if(e<2013){e=2013;for(let s=i;s>=e;s--){const e=new Date;e.setFullYear(s,0,1),e.setHours(0,0,0);const i=e.getTime();e.setFullYear(s+1,0,1),e.setHours(0,0,0);const a=e.getTime()-1;t.push({title:""+s,minDate:i,maxDate:a})}}else if(e<=i){const s=new Date;s.setFullYear(e,0,1),s.setHours(0,0,0);const i=s.getTime();s.setFullYear(e+1,0,1),s.setHours(0,0,0);const a=s.getTime()-1;t.push({title:""+e,minDate:i,maxDate:a})}}else{const e=a[1],s=a[3],i=a[5];if(!a[2]===a[4])return;const n=parseInt(e),o=parseInt(s)-1;let r=parseInt(i);r>=10&&r<=99&&(r+=2e3);const d=(new Date).getFullYear();if(P(n-1,o)&&r>=2013&&r<=d){const e=new Date;e.setFullYear(r,o,n),e.setHours(0,0,0);const s=e.getTime();e.setFullYear(r,o,n+1),e.setHours(0,0,0);const i=e.getTime()-1;return void t.push({title:S(s),minDate:s,maxDate:i})}}else{const e=a[1],s=a[3],i=parseInt(e),n=parseInt(s);if(i>0&&i<=31){if(n>=2013&&i<=12){return void b(t,i-1,n)}if(n<=12){M(t,i-1,n-1)}}else if(i>=2013&&n<=12){b(t,n-1,i)}}}function b(e,t,s){const i=(new Date).getFullYear(),a=Date.now();if(s>=2013&&s<=i){const i=new Date;i.setFullYear(s,t,1),i.setHours(0,0,0);const n=i.getTime();if(n>a)return;i.setMonth(i.getMonth()+1);const o=i.getTime()-1;e.push({title:w(n),minDate:n,maxDate:o})}}function M(e,t,s){if(P(t,s)){const a=(new Date).getFullYear(),n=Date.now();for(let o=a;o>=2013;o--){if(1===s&&28===t&&(((i=o)%4!=0||i%100==0)&&i%400!=0))continue;const r=new Date;r.setFullYear(o,s,t+1),r.setHours(0,0,0);const d=r.getTime();if(d>n)continue;r.setFullYear(o,s,t+2),r.setHours(0,0,0);const l=r.getTime()-1;o===a?e.push({title:I(d),minDate:d,maxDate:l}):e.push({title:S(d),minDate:d,maxDate:l})}}var i}function w(e){const t=new Date(e);return n[t.getMonth()].slice(0,3)+" "+t.getFullYear()}function I(e){const t=new Date(e);return n[t.getMonth()].slice(0,3)+" "+t.getDate()}function S(e){const t=new Date(e);return("0"+t.getDate()).slice(-2)+"."+("0"+(t.getMonth()+1)).slice(-2)+"."+t.getFullYear()}function C(e){const t=new Date(e);return o[t.getDay()]}function P(e,t){return t>=0&&t<12&&e>=0&&e<_[t]}function E(e){e=e.toLowerCase();for(let t=0;t<12;t++){if(0===n[t].toLowerCase().indexOf(e))return t}return-1}i.a.fillTipDates=y},function(e,t,s){"use strict";var i=s(65),a=s(75),n=s(26),o=s(28),r=s(82),d=s(15),l=s(55),c=s(61),h=s(11),p=s(24),u=s(13),g=s(74),m=s(57),f=s(16),v=s(10),X=s(86),_=s(53),y=s(88);class b{constructor(e,t,s,i,a,n,o,r,d){this.appMessagesManager=e,this.appChatsManager=t,this.appPeersManager=s,this.appUsersManager=i,this.appDraftsManager=a,this.appNotificationsManager=n,this.appStateManager=o,this.apiUpdatesManager=r,this.serverTimeManager=d,this.dialogs={},this.byFolders={},this.dialogsIndex=new X.a,this.cachedResults={query:"",count:0,dialogs:[],folderId:0},this.onUpdateFolderPeers=e=>{e.folder_peers.forEach(e=>{var t;const{folder_id:s,peer:i}=e,a=this.appPeersManager.getPeerId(i),n=this.dropDialog(a)[0];n&&((null===(t=n.pFlags)||void 0===t?void 0:t.pinned)&&(delete n.pFlags.pinned,this.pinnedOrders[s].findAndSplice(e=>e===n.peerId),this.appStateManager.pushToState("pinnedOrders",this.pinnedOrders)),n.folder_id=s,this.generateIndexForDialog(n),this.pushDialog(n)),this.appMessagesManager.scheduleHandleNewDialogs(a,n)})},this.onUpdateDialogPinned=e=>{var t;const s=null!==(t=e.folder_id)&&void 0!==t?t:0,i=this.appPeersManager.getPeerId(e.peer.peer),a=this.getDialogOnly(i);a&&(e.pFlags.pinned?a.pFlags.pinned=!0:(delete a.pFlags.pinned,this.pinnedOrders[s].findAndSplice(e=>e===a.peerId),this.appStateManager.pushToState("pinnedOrders",this.pinnedOrders)),this.generateIndexForDialog(a)),this.appMessagesManager.scheduleHandleNewDialogs(i,a)},this.onUpdatePinnedDialogs=e=>{var t;const s=null!==(t=e.folder_id)&&void 0!==t?t:0,i=e=>{this.pinnedOrders[s].length=0,e.reverse(),e.forEach(e=>{a[e]=!0;const t=this.getDialogOnly(e);this.appMessagesManager.scheduleHandleNewDialogs(e,t),t&&(t.pFlags.pinned=!0,this.generateIndexForDialog(t))}),this.getFolder(s).forEach(e=>{const t=e.peerId;e.pFlags.pinned&&!a[t]&&this.appMessagesManager.scheduleHandleNewDialogs(t)})},a={};e.order?i(e.order.map(e=>this.appPeersManager.getPeerId(e.peer))):u.a.invokeApi("messages.getPinnedDialogs",{folder_id:s}).then(e=>{this.applyDialogs(e),i(e.dialogs.map(e=>e.peerId))})},this.storage=this.appStateManager.storages.dialogs,this.reset(),v.default.addEventListener("language_change",e=>{const t=i.getSelf().id;if(this.getDialogOnly(t)){const e=s.getPeerSearchText(t);this.dialogsIndex.indexObject(t,e)}}),v.default.addMultipleEventsListeners({updateFolderPeers:this.onUpdateFolderPeers,updateDialogPinned:this.onUpdateDialogPinned,updatePinnedDialogs:this.onUpdatePinnedDialogs}),o.getState().then(e=>{this.pinnedOrders=e.pinnedOrders||{},this.pinnedOrders[0]||(this.pinnedOrders[0]=[]),this.pinnedOrders[1]||(this.pinnedOrders[1]=[]);const t=o.storagesResults.dialogs;if(t.length)for(let e=0,s=t.length;e<s;++e){const s=t[e];if(s){s.top_message=this.appMessagesManager.getServerMessageId(s.top_message),s.topMessage&&this.appMessagesManager.saveMessages([s.topMessage]),this.saveDialog(s);this.appMessagesManager.getMessageByPeer(s.peerId,s.top_message).deleted&&this.appMessagesManager.reloadConversation(s.peerId)}}this.allDialogsLoaded=e.allDialogsLoaded||{}})}isDialogsLoaded(e){return!!this.allDialogsLoaded[e]}setDialogsLoaded(e,t){this.allDialogsLoaded[e]=t,this.appStateManager.pushToState("allDialogsLoaded",this.allDialogsLoaded)}reset(){this.allDialogsLoaded={},this.dialogsOffsetDate={},this.pinnedOrders={0:[],1:[]},this.dialogsNum=0}resetPinnedOrder(e){this.pinnedOrders[e]=[]}getOffsetDate(e){return this.dialogsOffsetDate[e]||0}getFolder(e){var t,s;if(e<=1)return null!==(t=this.byFolders[e])&&void 0!==t?t:this.byFolders[e]=[];const i=[],a=this.appMessagesManager.filtersStorage.filters[e];for(const e in this.dialogs){const t=this.dialogs[e];if(this.appMessagesManager.filtersStorage.testDialogForFilter(t,a)){let e;const n=a.pinned_peers.indexOf(t.peerId);e=-1!==n?this.generateDialogIndex(this.generateDialogPinnedDateByIndex(a.pinned_peers.length-1-n)):(null===(s=t.pFlags)||void 0===s?void 0:s.pinned)?this.generateIndexForDialog(t,!0):t.index,i.push({dialog:t,index:e})}}return i.sort((e,t)=>t.index-e.index),i.map(e=>e.dialog)}getDialog(e,t){const s=[];if(void 0===t){const e=this.byFolders;for(const t in e)s.push(e[t])}else s.push(this.getFolder(t));for(let t of s){const s=t.findIndex(t=>t.peerId===e);if(-1!==s)return[t[s],s]}return[]}getDialogOnly(e){return this.dialogs[e]}generateDialogIndex(e){return void 0===e&&(e=Object(o.h)(!0)+this.serverTimeManager.serverTimeOffset),65536*e+(65535&++this.dialogsNum)}generateIndexForDialog(e,t=!1,s){var i;const a=this.appPeersManager.isChannel(e.peerId)?-e.peerId:0;let n=0;if(e.pFlags.pinned&&!t)n=this.generateDialogPinnedDate(e);else{if(s||(s=this.appMessagesManager.getMessageByPeer(e.peerId,e.top_message)),n=s.date||n,a){const e=this.appChatsManager.getChat(a);(!n||e.date&&e.date>n)&&(n=e.date)}"draftMessage"===(null===(i=e.draft)||void 0===i?void 0:i._)&&e.draft.date>n&&(n=e.draft.date)}n||(n=Date.now()/1e3);const o=this.generateDialogIndex(n);if(t)return o;e.index=o}generateDialogPinnedDateByIndex(e){return 2147418112+(65535&e)}generateDialogPinnedDate(e){const t=this.pinnedOrders[e.folder_id],s=t.indexOf(e.peerId);let i=s;return-1===s&&(i=t.push(e.peerId)-1,this.appStateManager.pushToState("pinnedOrders",this.pinnedOrders)),this.generateDialogPinnedDateByIndex(i)}generateDialog(e){return{_:"dialog",pFlags:{},peer:this.appPeersManager.getOutputPeer(e),top_message:0,read_inbox_max_id:0,read_outbox_max_id:0,unread_count:0,unread_mentions_count:0,notify_settings:{_:"peerNotifySettings"}}}setDialogToState(e){const t=this.appMessagesManager.getHistoryStorage(e.peerId),s=[].concat(t.history.slice);let i;for(let t=0,a=s.length;t<a;++t){const a=s[t],n=this.appMessagesManager.getMessageByPeer(e.peerId,a);if(!n.pFlags.is_outgoing){i=n,n.fromId!==e.peerId&&this.appStateManager.requestPeer(n.fromId,"topMessage_"+e.peerId,1);break}}if(e.topMessage=i,e.peerId<0&&e.pts){const t=this.apiUpdatesManager.getChannelState(-e.peerId,e.pts).pts;e.pts=t}this.storage.set({[e.peerId]:e}),this.appStateManager.requestPeer(e.peerId,"dialog_"+e.peerId,1)}pushDialog(e,t){const s=this.getFolder(e.folder_id),i=s.findIndex(t=>t.peerId===e.peerId);if(-1!==i&&s.splice(i,1),this.dialogs[e.peerId]=e,this.setDialogToState(e),t&&!e.pFlags.pinned&&(!this.dialogsOffsetDate[e.folder_id]||t<this.dialogsOffsetDate[e.folder_id])){if(-1!==i)return!1;this.dialogsOffsetDate[e.folder_id]=t}Object(_.d)(s,e,"index",i)}dropDialog(e){const t=this.getDialog(e);return t[0]&&(this.byFolders[t[0].folder_id].splice(t[1],1),delete this.dialogs[e],this.dialogsIndex.indexObject(e,""),this.appStateManager.keepPeerSingle(0,"topMessage_"+e),this.appStateManager.keepPeerSingle(0,"dialog_"+e),this.storage.delete(e)),t}applyDialogs(e){Object(_.c)(e.dialogs,(t,s)=>{"dialogFolder"===t._&&e.dialogs.splice(s,1)}),this.appUsersManager.saveApiUsers(e.users),this.appChatsManager.saveApiChats(e.chats),this.appMessagesManager.saveMessages(e.messages),this.appMessagesManager.log("applyConversation",e);const t={};e.dialogs.forEach(e=>{const s=this.appPeersManager.getPeerId(e.peer);let i=e.top_message;const a=this.appMessagesManager.pendingTopMsgs[s];if(a&&(!i||this.appMessagesManager.getMessageByPeer(s,a).date>this.appMessagesManager.getMessageByPeer(s,i).date)&&(e.top_message=i=a,this.appMessagesManager.getHistoryStorage(s).maxId=a),i||e.draft&&"draftMessage"===e.draft._)this.saveDialog(e),t[s]=e;else{const e=this.dropDialog(s);e.length&&v.default.dispatchEvent("dialog_drop",{peerId:s,dialog:e[0]})}const n=this.appMessagesManager.newUpdatesAfterReloadToHandle[s];if(void 0!==n){for(const e of n)this.apiUpdatesManager.saveUpdate(e);delete this.appMessagesManager.newUpdatesAfterReloadToHandle[s]}}),Object.keys(t).length&&v.default.dispatchEvent("dialogs_multiupdate",t)}saveDialog(e,t=0){const s=this.appPeersManager.getPeerId(e.peer);if(!s)return console.error("saveConversation no peerId???",e,t),!1;"dialog"!==e._&&console.error("saveConversation not regular dialog",e,Object.assign({},e));const i=this.appPeersManager.isChannel(s)?-s:0;if(s<0){const e=this.appChatsManager.getChat(-s);if("channelForbidden"===e._||"chatForbidden"===e._||e.pFlags.left||e.pFlags.kicked)return!1}const a=this.appPeersManager.getPeerSearchText(s);let n,o;if(this.dialogsIndex.indexObject(s,a),e.top_message?(n=this.appMessagesManager.generateMessageId(e.top_message),o=this.appMessagesManager.getMessageByPeer(s,n)):(n=this.appMessagesManager.generateTempMessageId(s),o={_:"message",id:n,mid:n,from_id:this.appPeersManager.getOutputPeer(this.appUsersManager.getSelf().id),peer_id:this.appPeersManager.getOutputPeer(s),deleted:!0,pFlags:{out:!0},date:0,message:""},this.appMessagesManager.saveMessages([o],{isOutgoing:!0})),(null==o?void 0:o.pFlags)||this.appMessagesManager.log.error("saveConversation no message:",e,o),!i&&s<0){const e=this.appChatsManager.getChat(-s);if(e&&e.migrated_to&&e.pFlags.deactivated){const t=this.appPeersManager.getPeerId(e.migrated_to);return this.appMessagesManager.migratedFromTo[s]=t,void(this.appMessagesManager.migratedToFrom[t]=s)}}const r=this.getDialogOnly(s);e.top_message=n,e.read_inbox_max_id=this.appMessagesManager.generateMessageId(r&&!e.read_inbox_max_id?r.read_inbox_max_id:e.read_inbox_max_id),e.read_outbox_max_id=this.appMessagesManager.generateMessageId(r&&!e.read_outbox_max_id?r.read_outbox_max_id:e.read_outbox_max_id),e.hasOwnProperty("folder_id")||"dialog"===e._&&(e.folder_id=r?r.folder_id:t),e.draft=this.appDraftsManager.saveDraft(s,0,e.draft),e.peerId=s,o.pFlags.is_outgoing&&(n>e[o.pFlags.out?"read_outbox_max_id":"read_inbox_max_id"]?o.pFlags.unread=!0:delete o.pFlags.unread);const l=this.appMessagesManager.getHistoryStorage(s),c=l.history.slice;if(c.length){if(!c.isEnd(y.a.Bottom)){l.history.insertSlice([n]).setEnd(y.a.Bottom)}}else l.history.unshift(n);l.maxId=n,l.readMaxId=e.read_inbox_max_id,l.readOutboxMaxId=e.read_outbox_max_id,this.appNotificationsManager.savePeerSettings(s,e.notify_settings),i&&e.pts&&this.apiUpdatesManager.addChannelState(i,e.pts),this.generateIndexForDialog(e),r&&Object(d.i)(r,e),this.pushDialog(e,o.date)}getDialogs(e="",t,s=20,i=0){const a=i>1?0:i;let n=this.getFolder(i);if(e){if(!s||this.cachedResults.query!==e||this.cachedResults.folderId!==i){this.cachedResults.query=e,this.cachedResults.folderId=i;const t=this.dialogsIndex.search(e);this.cachedResults.dialogs=[];for(const e in this.dialogs){const s=this.dialogs[e];t.has(s.peerId)&&s.folder_id===i&&this.cachedResults.dialogs.push(s)}this.cachedResults.dialogs.sort((e,t)=>t.index-e.index),this.cachedResults.count=this.cachedResults.dialogs.length}n=this.cachedResults.dialogs}else this.cachedResults.query="";let o=0;if(t>0)for(;o<n.length&&!(t>n[o].index);o++);const r=this.isDialogsLoaded(a);return e||r||n.length>=o+s?Promise.resolve({dialogs:n.slice(o,o+s),count:r?n.length:null,isEnd:r&&o+s>=n.length}):this.appMessagesManager.getTopMessages(s,a).then(e=>{if(o=0,t>0)for(;o<n.length&&!(t>n[o].index);o++);return{dialogs:n.slice(o,o+s),count:"messages.dialogs"===e._?e.dialogs.length:e.count,isEnd:this.isDialogsLoaded(a)&&o+s>=n.length}})}}var M=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class w{constructor(e,t,s,i,a,n,o){this.appMessagesManager=e,this.appPeersManager=t,this.appUsersManager=s,this.appNotificationsManager=i,this.appStateManager=a,this.apiUpdatesManager=n,this.rootScope=o,this.filters={},this.orderIndex=1,this.onUpdateDialogFilter=e=>{e.filter?this.saveDialogFilter(e.filter):this.filters[e.id]&&(this.rootScope.dispatchEvent("filter_delete",this.filters[e.id]),delete this.filters[e.id]),this.appStateManager.pushToState("filters",this.filters)},this.onUpdateDialogFilterOrder=e=>{this.orderIndex=1,e.order.forEach((e,t)=>{const s=this.filters[e];delete s.orderIndex,this.setOrderIndex(s)}),this.rootScope.dispatchEvent("filter_order",e.order),this.appStateManager.pushToState("filters",this.filters)},this.appStateManager.getState().then(e=>{this.filters=e.filters;for(const e in this.filters){const t=this.filters[e];t.hasOwnProperty("orderIndex")&&t.orderIndex>=this.orderIndex&&(this.orderIndex=t.orderIndex+1)}}),o.addMultipleEventsListeners({updateDialogFilter:this.onUpdateDialogFilter,updateDialogFilters:e=>{const t=Object(d.a)(this.filters);this.getDialogFilters(!0).then(e=>{for(const s in t){const t=+s;e.find(e=>e.id===t)||this.onUpdateDialogFilter({_:"updateDialogFilter",id:t})}this.onUpdateDialogFilterOrder({_:"updateDialogFilterOrder",order:e.map(e=>e.id)})})},updateDialogFilterOrder:this.onUpdateDialogFilterOrder})}testDialogForFilter(e,t){for(const s of t.exclude_peers)if(s===e.peerId)return!1;for(const s of t.include_peers)if(s===e.peerId)return!0;const s=t.pFlags;if(s.exclude_archived&&1===e.folder_id)return!1;if(s.exclude_read&&!e.unread_count&&!e.pFlags.unread_mark)return!1;if(s.exclude_muted){if(this.appNotificationsManager.isPeerLocalMuted(e.peerId))return!1}const i=e.peerId;if(i<0){if(s.broadcasts&&this.appPeersManager.isBroadcast(i))return!0;if(s.groups&&this.appPeersManager.isAnyGroup(i))return!0}else{if(this.appPeersManager.isBot(i))return!!s.bots;if(s.non_contacts&&!this.appUsersManager.isContact(i))return!0;if(s.contacts&&this.appUsersManager.isContact(i))return!0}return!1}toggleDialogPin(e,t){const s=this.filters[t];return s.pinned_peers.findAndSplice(t=>t===e)||s.pinned_peers.unshift(e),this.updateDialogFilter(s)}createDialogFilter(e){let t=Math.max(1,...Object.keys(this.filters).map(e=>+e));return(e=Object(d.a)(e)).id=t+1,this.updateDialogFilter(e)}updateDialogFilter(e,t=!1){const s=t?0:1;return u.a.invokeApi("messages.updateDialogFilter",{flags:s,id:e.id,filter:t?void 0:this.getOutputDialogFilter(e)}).then(s=>(s&&this.onUpdateDialogFilter({_:"updateDialogFilter",id:e.id,filter:t?void 0:e}),s))}getOutputDialogFilter(e){const t=Object(d.a)(e);return["pinned_peers","exclude_peers","include_peers"].forEach(e=>{t[e]=t[e].map(e=>this.appPeersManager.getInputPeerById(e))}),Object(_.c)(t.include_peers,(e,s)=>{t.pinned_peers.includes(e)&&t.include_peers.splice(s,1)}),t}getDialogFilters(e=!1){return M(this,void 0,void 0,(function*(){const t=Object.keys(this.filters);if(t.length&&!e)return t.map(e=>this.filters[e]).sort((e,t)=>e.orderIndex-t.orderIndex);const s=yield u.a.invokeApi("messages.getDialogFilters");for(const t of s)this.saveDialogFilter(t,e);return s}))}saveDialogFilter(e,t=!0){["pinned_peers","exclude_peers","include_peers"].forEach(t=>{e[t]=e[t].map(e=>this.appPeersManager.getPeerId(e))}),Object(_.c)(e.include_peers,(t,s)=>{e.pinned_peers.includes(t)&&e.include_peers.splice(s,1)}),e.include_peers=e.pinned_peers.concat(e.include_peers),this.filters[e.id]?Object.assign(this.filters[e.id],e):this.filters[e.id]=e,this.setOrderIndex(e),t&&this.rootScope.dispatchEvent("filter_update",e)}setOrderIndex(e){e.hasOwnProperty("orderIndex")?e.orderIndex>=this.orderIndex&&(this.orderIndex=e.orderIndex+1):e.orderIndex=this.orderIndex++,this.appStateManager.pushToState("filters",this.filters)}}var I=s(52),S=s(32),C=s(49),P=s(37),E=s(30),D=s(35),k=s(91),j=s(21),A=s(20),F=s(106),x=s(98),T=s(76),L=s(58),O=s(9),U=s(68),R=s(42),N=s(107),B=s(97),H=s(96);const W={s:"Seconds",m:"Minutes",h:"Hours",d:"Days",w:"Weeks"};function G(e){const t=function(e,t=2){e||(e=1);let s=[];const i=[{m:1,t:"s"},{m:60,t:"m"},{m:60,t:"h"},{m:24,t:"d"},{m:7,t:"w"}];let a=1;return i.forEach((t,n)=>{if(a*=t.m,e<a)return;const o=i[n===i.length-1?n:n+1].m;s.push({duration:e/a%o|0,type:t.t})}),s.slice(-t).reverse()}(e,2).map(e=>Object(h.i18n)(W[e.type],[e.duration])),s=document.createElement("span");return s.append(...Object(h.join)(t,!1)),s}var z=s(100),q=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class V{constructor(){this.messagesStorageByPeerId={},this.groupedMessagesStorage={},this.scheduledMessagesStorage={},this.historiesStorage={},this.threadsStorage={},this.searchesStorage={},this.pinnedMessages={},this.threadsServiceMessagesIdsStorage={},this.threadsToReplies={},this.pendingByRandomId={},this.pendingByMessageId={},this.pendingAfterMsgs={},this.pendingTopMsgs={},this.tempNum=0,this.tempFinalizeCallbacks={},this.sendSmthLazyLoadQueue=new i.a(1),this.needSingleMessages={},this.fetchSingleMessagesPromise=null,this.maxSeenId=0,this.migratedFromTo={},this.migratedToFrom={},this.newMessagesHandleTimeout=0,this.newMessagesToHandle={},this.newDialogsToHandle={},this.newUpdatesAfterReloadToHandle={},this.notificationsHandlePromise=0,this.notificationsToHandle={},this.reloadConversationsPeers=new Set,this.log=Object(p.b)("MESSAGES",p.a.Error|p.a.Debug|p.a.Log|p.a.Warn),this.groupedTempId=0,this.typings={},this.handleNewMessages=()=>{clearTimeout(this.newMessagesHandleTimeout),this.newMessagesHandleTimeout=0,v.default.dispatchEvent("history_multiappend",this.newMessagesToHandle),this.newMessagesToHandle={}},this.handleNewDialogs=()=>{let e=0;const t=this.newDialogsToHandle;for(const s in t){const i=t[s];i?(this.dialogsStorage.pushDialog(i),E.a.isChannel(+s)||(e=Math.max(e,i.top_message||0))):(this.reloadConversation(+s),delete t[s])}0!==e&&this.incrementMaxSeenId(e),v.default.dispatchEvent("dialogs_multiupdate",t),this.newDialogsToHandle={}},this.handleNotifications=()=>{window.clearTimeout(this.notificationsHandlePromise),this.notificationsHandlePromise=0;for(const e in this.notificationsToHandle){const t=+e;if(v.default.peerId===t&&!v.default.idle.isIDLE)continue;const s=this.notificationsToHandle[t];Promise.all([U.a.getNotifyPeerTypeSettings(),U.a.getNotifySettings(E.a.getInputNotifyPeerById(t,!0))]).then(([e,i])=>{const a=s.topMessage;!U.a.isPeerLocalMuted(t,!0)&&a.pFlags.unread&&a.pFlags.unread&&this.notifyAboutMessage(a,{fwdCount:s.fwdCount,peerTypeNotifySettings:i})})}this.notificationsToHandle={}},this.onUpdateMessageId=e=>{const t=e.random_id,s=this.pendingByRandomId[t];if(s){const{peerId:i,tempId:a,threadId:n,storage:o}=s,r=this.generateMessageId(e.id);this.getMessageFromStorage(o,r).deleted?this.pendingByMessageId[r]=t:([this.getHistoryStorage(i),n?this.getHistoryStorage(i,n):void 0].filter(Boolean).forEach(e=>{e.history.delete(a)}),this.finalizePendingMessageCallbacks(o,a,r))}},this.onUpdateNewMessage=e=>{var t;const s=e.message,i=this.getMessagePeer(s),a=this.getMessagesStorage(i),n=this.getDialogOnly(i),o="updateNewDiscussionMessage"===e._;this.saveMessages([s],{storage:{}});const r=this.getThreadKey(s),d=r?+r.split("_")[1]:void 0;if(d&&!o&&this.threadsStorage[i]&&this.threadsStorage[i][d]){const e={_:"updateNewDiscussionMessage",message:s};this.onUpdateNewMessage(e)}if(!n&&!o){let s=!0;if(i<0&&(s=S.a.isInChat(-i)),s){const s=null!==(t=this.newUpdatesAfterReloadToHandle[i])&&void 0!==t?t:this.newUpdatesAfterReloadToHandle[i]=new Set;if(s.has(e))return void this.log.error("here we go again",i);this.scheduleHandleNewDialogs(i),s.add(e)}return}this.saveMessages([s],{storage:a});const l=this.checkPendingMessage(s),c=this.getHistoryStorage(i,o?d:void 0);if(o||this.updateMessageRepliesIfNeeded(s),c.history.findSlice(s.mid))return!1;const h=c.history.first;if(h.isEnd(y.a.Bottom)){let e=0;for(const t=h.length;e<t&&!(s.mid>h[e]);++e);h.splice(e,0,s.mid)}else c.history.unshift(s.mid);if(null!==c.count&&c.count++,this.mergeReplyKeyboard(c,s)&&v.default.dispatchEvent("history_reply_markup",{peerId:i}),s.fromId>0&&!s.pFlags.out&&s.from_id&&A.a.forceUserOnline(s.fromId,s.date),l||this.handleNewMessage(i,s.mid),o)return;const p=!s.pFlags.out&&s.pFlags.unread;if(n&&(this.setDialogTopMessage(s,n),p&&n.unread_count++),p){const e=s.peerId;let t=this.notificationsToHandle[e];void 0===t&&(t=this.notificationsToHandle[e]={fwdCount:0,fromId:0}),t.fromId!==s.fromId&&(t.fromId=s.fromId,t.fwdCount=0),s.fwd_from&&t.fwdCount++,t.topMessage=s,this.notificationsHandlePromise||(this.notificationsHandlePromise=window.setTimeout(this.handleNotifications,0))}},this.onUpdateDialogUnreadMark=e=>{const t=E.a.getPeerId(e.peer.peer),s=this.getDialogOnly(t);s?(e.pFlags.unread?s.pFlags.unread_mark=!0:delete s.pFlags.unread_mark,v.default.dispatchEvent("dialogs_multiupdate",{[t]:s}),this.dialogsStorage.setDialogToState(s)):this.scheduleHandleNewDialogs(t)},this.onUpdateEditMessage=e=>{const t=e.message,s=this.getMessagePeer(t),i=this.generateMessageId(t.id),a=this.getMessagesStorage(s);if(void 0===a[i])return;const n=this.getMessageFromStorage(a,i);this.saveMessages([t],{storage:a});const o=this.getMessageFromStorage(a,i);this.handleEditedMessage(n,o);const r=this.getDialogOnly(s),d=r&&r.top_message===i;if(t.clear_history)d&&v.default.dispatchEvent("dialog_flush",{peerId:s});else if(v.default.dispatchEvent("message_edit",{storage:a,peerId:s,mid:i}),d||t.grouped_id){const e={};e[s]=r,v.default.dispatchEvent("dialogs_multiupdate",e),this.dialogsStorage.setDialogToState(r)}},this.onUpdateReadHistory=e=>{const t=e.channel_id,s=this.generateMessageId(e.max_id||e.read_max_id),i=this.generateMessageId(e.top_msg_id),a=t?-t:E.a.getPeerId(e.peer),n="updateReadHistoryOutbox"===e._||"updateReadChannelOutbox"===e._||"updateReadChannelDiscussionOutbox"===e._||void 0,o=this.getMessagesStorage(a),r=Object(d.e)(o,"desc"),l=this.getDialogOnly(a),c=e.still_unread_count;let h=0,p=!1;const u=this.getHistoryStorage(a,i);if(a>0&&n&&A.a.forceUserOnline(a),i){const e=this.threadsToReplies[a+"_"+i];if(e){const[t,s]=e.split("_").map(e=>+e);this.updateMessage(t,s,"replies_updated")}}for(let e=0,t=r.length;e<t;e++){const t=r[e];if(t>s)continue;const a=o[t];if(a.pFlags.out===n){if(!a.pFlags.unread)break;if(i){const e=a.reply_to;if(!e||(e.reply_to_top_id||e.reply_to_msg_id)!==i)continue}a.pFlags.unread&&(delete a.pFlags.unread,p||(p=!0),a.pFlags.out||i||!l||void 0!==c||(h=--l.unread_count),U.a.cancel("msg"+t))}}if(n?u.readOutboxMaxId=s:u.readMaxId=s,!i&&l&&(n?l.read_outbox_max_id=s:l.read_inbox_max_id=s,n||(h<0||!this.getReadMaxIdIfUnread(a)?l.unread_count=0:h&&l.top_message>s&&(l.unread_count=h)),v.default.dispatchEvent("dialog_unread",{peerId:a}),this.dialogsStorage.setDialogToState(l)),p&&v.default.dispatchEvent("messages_read"),!i&&t){const e=a+"_";for(const t in this.threadsToReplies)if(0===t.indexOf(e)){const[e,s]=this.threadsToReplies[t].split("_").map(e=>+e);v.default.dispatchEvent("replies_updated",this.getMessageByPeer(e,s))}}},this.onUpdateReadMessagesContents=e=>{const t=e.channel_id,s=e.messages.map(e=>this.generateMessageId(e)),i=t?-t:this.getMessageById(s[0]).peerId;for(const e of s){const t=this.getMessageByPeer(i,e);t.deleted||(delete t.pFlags.media_unread,this.setDialogToStateIfMessageIsTop(t))}v.default.dispatchEvent("messages_media_read",{peerId:i,mids:s})},this.onUpdateChannelAvailableMessages=e=>{const t=e.channel_id,s=[],i=-t,a=this.getHistoryStorage(i).history.slice;a.length&&a.forEach(t=>{(!e.available_min_id||t<=e.available_min_id)&&s.push(t)}),e.messages=s,this.onUpdateDeleteMessages(e)},this.onUpdateDeleteMessages=e=>{const t=e.channel_id,s=e.messages.map(e=>this.generateMessageId(e)),i=t?-t:this.getMessageById(s[0]).peerId;if(!i)return;u.a.clearCache("messages.getSearchCounters",e=>E.a.getPeerId(e.peer)===i);const a=new Set;for(const e of s){const t=this.getMessageByPeer(i,e),s=this.getThreadKey(t);s&&this.threadsStorage[i]&&this.threadsStorage[i][+s.split("_")[1]]&&a.add(s)}const n=this.handleDeletedMessages(i,this.getMessagesStorage(i),s),o=Array.from(a).map(e=>{const t=e.split("_");return this.getHistoryStorage(+t[0],+t[1])});[this.getHistoryStorage(i)].concat(o).forEach(e=>{for(const t in n.msgs)e.history.delete(+t);n.count&&null!==e.count&&e.count>0&&(e.count-=n.count,e.count<0&&(e.count=0))}),v.default.dispatchEvent("history_delete",{peerId:i,msgs:n.msgs});const r=this.getDialogOnly(i);r&&(n.unread&&(r.unread_count-=n.unread,v.default.dispatchEvent("dialog_unread",{peerId:i})),n.msgs[r.top_message]&&this.reloadConversation(i))},this.onUpdateChannel=e=>{const t=e.channel_id,s=-t,i=S.a.getChat(t),a=S.a.isInChat(t);(!!i.username||!i.pFlags.left)!==(void 0!==this.historiesStorage[s])&&(delete this.historiesStorage[s],v.default.dispatchEvent("history_forbidden",s));const n=this.getDialogOnly(s);!!n!==a&&(a?this.reloadConversation(-t):n&&(this.dialogsStorage.dropDialog(s),v.default.dispatchEvent("dialog_drop",{peerId:s,dialog:n})))},this.onUpdateChannelReload=e=>{const t=e.channel_id,s=-t;this.dialogsStorage.dropDialog(s),delete this.historiesStorage[s],this.reloadConversation(-t).then(()=>{v.default.dispatchEvent("history_reload",s)})},this.onUpdateChannelMessageViews=e=>{const t=e.views,s=this.generateMessageId(e.id),i=this.getMessageByPeer(-e.channel_id,s);!i.deleted&&i.views&&i.views<t&&(i.views=t,v.default.dispatchEvent("message_views",{mid:s,views:t}))},this.onUpdateServiceNotification=e=>{const t=this.generateTempMessageId(777e3),s={_:"message",id:t,from_id:E.a.getOutputPeer(777e3),peer_id:E.a.getOutputPeer(777e3),pFlags:{unread:!0},date:(e.inbox_date||Object(o.h)(!0))+m.a.serverTimeOffset,message:e.message,media:e.media,entities:e.entities};A.a.hasUser(777e3)||A.a.saveApiUsers([{_:"user",id:777e3,pFlags:{verified:!0},access_hash:0,first_name:"Telegram",phone:"42777"}]),this.saveMessages([s],{isOutgoing:!0}),e.inbox_date&&(this.pendingTopMsgs[777e3]=t,this.onUpdateNewMessage({_:"updateNewMessage",message:s}))},this.onUpdatePinnedMessages=e=>{const t="updatePinnedChannelMessages"===e._?e.channel_id:void 0,s=t?-t:E.a.getPeerId(e.peer),i=e.messages.map(e=>this.generateMessageId(e)),a=this.getMessagesStorage(s),n=i.filter(e=>!a[e]);(n.length?Promise.all(n.map(e=>this.wrapSingleMessage(s,e))):Promise.resolve()).finally(()=>{var t;const n=null===(t=e.pFlags)||void 0===t?void 0:t.pinned;if(n)for(const e of i){a[e].pFlags.pinned=!0}else for(const e of i){delete a[e].pFlags.pinned}delete this.pinnedMessages[s],j.default.getState().then(e=>{delete e.hiddenPinnedMessages[s],v.default.dispatchEvent("peer_pinned_messages",{peerId:s,mids:i,pinned:n})})})},this.onUpdateNotifySettings=e=>{const{peer:t,notify_settings:s}=e;if("notifyPeer"===t._){const e=E.a.getPeerId(t.peer),i=this.getDialogOnly(e);i&&(i.notify_settings=s,v.default.dispatchEvent("dialog_notify_settings",i),this.dialogsStorage.setDialogToState(i))}},this.onUpdateNewScheduledMessage=e=>{const t=e.message,s=this.getMessagePeer(t),i=this.scheduledMessagesStorage[s];if(i){const e=this.generateMessageId(t.id),a=this.getMessageFromStorage(i,e);this.saveMessages([t],{storage:i,isScheduled:!0});const n=this.getMessageFromStorage(i,e);if(a.deleted){this.checkPendingMessage(t)||v.default.dispatchEvent("scheduled_new",{peerId:s,mid:t.mid})}else this.handleEditedMessage(a,n),v.default.dispatchEvent("message_edit",{storage:i,peerId:s,mid:t.mid})}},this.onUpdateDeleteScheduledMessages=e=>{const t=E.a.getPeerId(e.peer),s=this.scheduledMessagesStorage[t];if(s){const i=e.messages.map(e=>this.generateMessageId(e));this.handleDeletedMessages(t,s,i),v.default.dispatchEvent("scheduled_delete",{peerId:t,mids:i})}},v.default.addMultipleEventsListeners({updateMessageID:this.onUpdateMessageId,updateNewDiscussionMessage:this.onUpdateNewMessage,updateNewMessage:this.onUpdateNewMessage,updateNewChannelMessage:this.onUpdateNewMessage,updateDialogUnreadMark:this.onUpdateDialogUnreadMark,updateEditMessage:this.onUpdateEditMessage,updateEditChannelMessage:this.onUpdateEditMessage,updateReadChannelDiscussionInbox:this.onUpdateReadHistory,updateReadChannelDiscussionOutbox:this.onUpdateReadHistory,updateReadHistoryInbox:this.onUpdateReadHistory,updateReadHistoryOutbox:this.onUpdateReadHistory,updateReadChannelInbox:this.onUpdateReadHistory,updateReadChannelOutbox:this.onUpdateReadHistory,updateChannelReadMessagesContents:this.onUpdateReadMessagesContents,updateReadMessagesContents:this.onUpdateReadMessagesContents,updateChannelAvailableMessages:this.onUpdateChannelAvailableMessages,updateDeleteMessages:this.onUpdateDeleteMessages,updateDeleteChannelMessages:this.onUpdateDeleteMessages,updateChannel:this.onUpdateChannel,updateChannelReload:this.onUpdateChannelReload,updateChannelMessageViews:this.onUpdateChannelMessageViews,updateServiceNotification:this.onUpdateServiceNotification,updatePinnedMessages:this.onUpdatePinnedMessages,updatePinnedChannelMessages:this.onUpdatePinnedMessages,updateNotifySettings:this.onUpdateNotifySettings,updateNewScheduledMessage:this.onUpdateNewScheduledMessage,updateDeleteScheduledMessages:this.onUpdateDeleteScheduledMessages}),v.default.addEventListener("notify_peer_type_settings",({key:e,settings:t})=>{this.getConversationsAll().then(t=>{let s;s="notifyUsers"===e?e=>e.peerId>0:"notifyBroadcasts"===e?e=>S.a.isBroadcast(-e.peerId):e=>E.a.isAnyGroup(e.peerId),t.filter(s).forEach(e=>{v.default.dispatchEvent("dialog_notify_settings",e)})})}),v.default.addEventListener("webpage_updated",e=>{const t=e;t.msgs.forEach(e=>{const s=this.getMessageById(e);if(!s)return;s.media={_:"messageMediaWebPage",webpage:F.a.getWebPage(t.id)};const i=this.getMessagePeer(s),a=this.getMessagesStorage(i);v.default.dispatchEvent("message_edit",{storage:a,peerId:i,mid:e})})}),v.default.addEventListener("draft_updated",e=>{const{peerId:t,threadId:s,draft:i}=e;if(s)return;const a=this.getDialogOnly(t);a&&!s?(a.draft=i,this.dialogsStorage.generateIndexForDialog(a),this.dialogsStorage.pushDialog(a),v.default.dispatchEvent("dialog_draft",{peerId:t,draft:i,index:a.index})):this.reloadConversation(t)}),j.default.getState().then(e=>{e.maxSeenMsgId&&(this.maxSeenId=e.maxSeenMsgId)})}construct(){this.filtersStorage=new w(this,E.a,A.a,U.a,j.default,I.a,v.default),this.dialogsStorage=new b(this,S.a,E.a,A.a,x.a,U.a,j.default,I.a,m.a)}getInputEntities(e){const t=Object(d.a)(e);return t.forEach(e=>{"messageEntityMentionName"===e._&&(e._="inputMessageEntityMentionName",e.user_id=A.a.getUserInput(e.user_id))}),t}invokeAfterMessageIsSent(e,t,s){var i,a;const o=null!==(i=this.tempFinalizeCallbacks[e])&&void 0!==i?i:this.tempFinalizeCallbacks[e]={},r=null!==(a=o[t])&&void 0!==a?a:o[t]={deferred:Object(n.a)()};return r.callback=s,r.deferred}editMessage(e,t,s={}){const{mid:i,peerId:a}=e;if(e.pFlags.is_outgoing)return this.invokeAfterMessageIsSent(i,"edit",e=>this.editMessage(e,t,s));let n=s.entities||[];t&&(t=f.a.parseMarkdown(t,n));const o=s.scheduleDate||(e.pFlags.is_scheduled?e.date:void 0);return u.a.invokeApi("messages.editMessage",{peer:E.a.getInputPeerById(a),id:e.id,message:t,media:s.newMedia,entities:n.length?this.getInputEntities(n):void 0,no_webpage:s.noWebPage,schedule_date:o}).then(e=>{I.a.processUpdateMessage(e)},e=>{if(this.log.error("editMessage error:",e),!e||"MESSAGE_NOT_MODIFIED"!==e.type)return e&&"MESSAGE_EMPTY"===e.type&&(e.handled=!0),Promise.reject(e);e.handled=!0})}sendText(e,t,s={}){if("string"!=typeof t||!t.length)return;s.threadId&&!s.replyToMsgId&&(s.replyToMsgId=s.threadId);if(t.length>4096){const i=Object(c.g)(t,4096);t=i[0],i.length>1&&delete s.webPage;for(let t=1;t<i.length;++t)setTimeout(()=>{this.sendText(e,i[t],s)},t)}e=E.a.getPeerMigratedTo(e)||e;let i=s.entities||[];s.viaBotId||(t=f.a.parseMarkdown(t,i));let a=this.getInputEntities(i);a.length||(a=void 0);const n=this.generateOutgoingMessage(e,s);n.entities=i,n.message=t;const o=s.replyToMsgId?this.getServerMessageId(s.replyToMsgId):void 0,r=E.a.isChannel(e);s.webPage&&(n.media={_:"messageMediaWebPage",webpage:s.webPage});const d=e=>{e?n.error=!0:delete n.error,v.default.dispatchEvent("messages_pending")};n.send=()=>{d(!1);const i={};let l;this.pendingAfterMsgs[e]&&(i.afterMessageId=this.pendingAfterMsgs[e].messageId),l=s.viaBotId?u.a.invokeApiAfter("messages.sendInlineBotResult",{peer:E.a.getInputPeerById(e),random_id:n.random_id,reply_to_msg_id:o||void 0,query_id:s.queryId,id:s.resultId,clear_draft:s.clearDraft},i):u.a.invokeApiAfter("messages.sendMessage",{no_webpage:s.noWebPage,peer:E.a.getInputPeerById(e),message:t,random_id:n.random_id,reply_to_msg_id:o||void 0,entities:a,clear_draft:s.clearDraft,schedule_date:s.scheduleDate||void 0,silent:s.silent},i),l.then(e=>{"updateShortSentMessage"===e._?(n.date=e.date,n.id=e.id,n.media=e.media,n.entities=e.entities,this.wrapMessageEntities(n),e.pFlags.out&&(n.pFlags.out=!0),e={_:"updates",users:[],chats:[],seq:0,updates:[{_:"updateMessageID",random_id:n.random_id,id:e.id},{_:s.scheduleDate?"updateNewScheduledMessage":r?"updateNewChannelMessage":"updateNewMessage",message:n,pts:e.pts,pts_count:e.pts_count}]}):e.updates&&e.updates.forEach(e=>{"updateDraftMessage"===e._&&(e.local=!0)}),I.a.processUpdateMessage(e)},()=>{d(!0)}).finally(()=>{this.pendingAfterMsgs[e]===i&&delete this.pendingAfterMsgs[e]}),this.pendingAfterMsgs[e]=i},this.beforeMessageSending(n,{isScheduled:!!s.scheduleDate||void 0,threadId:s.threadId,clearDraft:s.clearDraft})}sendFile(e,t,s={}){e=E.a.getPeerMigratedTo(e)||e;const i=this.generateOutgoingMessage(e,s),o=s.replyToMsgId?this.getServerMessageId(s.replyToMsgId):void 0;let d,l;const c="mime_type"in t?t.mime_type:t.type,h=t instanceof File?t.name:"",p=!(t instanceof File||t instanceof Blob);let g=s.caption||"";this.log("sendFile",t,c);const m=s.entities||[];g&&(g=f.a.parseMarkdown(g,m));const X=[],_=["image/jpeg","image/png","image/bmp"].indexOf(c)>=0;let y,b,M;if(p)d="document",l="";else if(0===c.indexOf("audio/")||["video/ogg"].indexOf(c)>=0){d="audio",l="audio."+("ogg"===c.split("/")[1]?"ogg":"mp3"),M="sendMessageUploadAudioAction",s.isVoiceMessage&&(d="voice",i.pFlags.media_unread=!0);let e={_:"documentAttributeAudio",pFlags:{voice:s.isVoiceMessage},waveform:s.waveform,duration:s.duration||0};X.push(e)}else if(s.isMedia)if(_){d="photo",l="photo."+c.split("/")[1],M="sendMessageUploadPhotoAction";const e={_:"photoSize",w:s.width,h:s.height,type:"full",location:null,size:t.size};y={_:"photo",id:""+i.id,sizes:[e],w:s.width,h:s.height};const a=P.a.getCacheContext(y,e.type);a.downloaded=t.size,a.url=s.objectURL||"",y=D.a.savePhoto(y)}else if(0===c.indexOf("video/")){d="video",l="video.mp4",M="sendMessageUploadVideoAction";let e={_:"documentAttributeVideo",pFlags:{round_message:s.isRoundMessage},duration:s.duration,w:s.width,h:s.height};X.push(e)}else d="document",l="document."+c.split("/")[1],M="sendMessageUploadDocumentAction";else d="document",l="document."+c.split("/")[1],M="sendMessageUploadDocumentAction";if(X.push({_:"documentAttributeFilename",file_name:h||l}),-1!==["document","video","audio","voice"].indexOf(d)&&!p){const e=[];b={_:"document",id:""+i.id,duration:s.duration,attributes:X,w:s.width,h:s.height,thumbs:e,mime_type:c,size:t.size};const a=P.a.getCacheContext(b);let n;if(a.downloaded=t.size,a.url=s.objectURL||"",_)X.push({_:"documentAttributeImageSize",w:s.width,h:s.height}),n={_:"photoSize",w:s.width,h:s.height,type:"full",size:t.size};else if("video"===d&&s.thumbURL){n={_:"photoSize",w:s.width,h:s.height,type:"full",size:s.thumbBlob.size};const e=P.a.getCacheContext(b,n.type);e.downloaded=n.size,e.url=s.thumbURL}n&&e.push(n),b=C.a.saveDoc(b)}this.log("sendFile",d,l,t.type,s);const w=p?void 0:new a.a({attachMethod:"prepend",tryAgainOnFail:!1,isUpload:!0}),S=Object(n.a)();w&&(w.attachPromise(S),S.cancel=()=>{const e=new Error("Download canceled");e.name="AbortError",S.reject(e)},S.catch(t=>{"AbortError"!==t.name||A||(this.log("cancelling upload",k),S.reject(t),this.cancelPendingMessage(i.random_id),this.setTyping(e,{_:"sendMessageCancelAction"}),(null==F?void 0:F.cancel)&&F.cancel())}));const k=p?void 0:{_:y?"messageMediaPhoto":"messageMediaDocument",pFlags:{},preloader:w,photo:y,document:b,promise:S};i.entities=m,i.message=g,i.media=p?{_:"messageMediaDocument",pFlags:{},document:t}:k;const j=e=>{e?i.error=!0:delete i.error,v.default.dispatchEvent("messages_pending")};let A=!1,F=null;return i.send=()=>{if(p){const{id:e,access_hash:s,file_reference:i}=t,a={_:"inputMediaDocument",id:{_:"inputDocument",id:e,access_hash:s,file_reference:i}};S.resolve(a)}else if(t instanceof File||t instanceof Blob){const a=()=>{let a;return A&&!i.error||(A=!1,F=P.a.upload(t),S.notifyAll({done:0,total:t.size})),"video"===d&&s.objectURL&&(a=new Promise((e,t)=>{(s.thumbBlob?Promise.resolve(s.thumbBlob):Object(r.a)(s.objectURL)).then(s=>{s?P.a.upload(s).then(e,t):e(null)},t)})),F&&F.then(e=>q(this,void 0,void 0,(function*(){let t;switch(delete i.media.preloader,e.name=l,A=!0,d){case"photo":t={_:"inputMediaUploadedPhoto",file:e};break;default:t={_:"inputMediaUploadedDocument",file:e,mime_type:c,attributes:X}}if(a)try{const e=yield a;t.thumb=e}catch(e){this.log.error("sendFile thumb upload error:",e)}S.resolve(t)})),()=>{j(!0)}),F.addNotifyListener(t=>{const s=Math.max(1,Math.floor(100*t.done/t.total));M&&this.setTyping(e,{_:M,progress:0|s}),S.notifyAll(t)}),S};s.isGroupedItem?a():this.sendSmthLazyLoadQueue.push({load:a})}return S},this.beforeMessageSending(i,{isGroupedItem:s.isGroupedItem,isScheduled:!!s.scheduleDate||void 0,threadId:s.threadId,clearDraft:s.clearDraft}),s.isGroupedItem||S.then(t=>(this.setTyping(e,{_:"sendMessageCancelAction"}),u.a.invokeApi("messages.sendMedia",{background:s.background,peer:E.a.getInputPeerById(e),media:t,message:g,random_id:i.random_id,reply_to_msg_id:o,schedule_date:s.scheduleDate,silent:s.silent,entities:m,clear_draft:s.clearDraft}).then(e=>{I.a.processUpdateMessage(e)},e=>{if("photo"===d&&400===e.code&&("PHOTO_INVALID_DIMENSIONS"===e.type||"PHOTO_SAVE_FILE_INVALID"===e.type))return e.handled=!0,d="document",void i.send();j(!0)}))),{message:i,promise:S}}sendAlbum(e,t,s={}){return q(this,void 0,void 0,(function*(){if(s.threadId&&!s.replyToMsgId&&(s.replyToMsgId=s.threadId),1===t.length)return this.sendFile(e,t[0],Object.assign(Object.assign({},s),s.sendFileDetails[0]));e=E.a.getPeerMigratedTo(e)||e;const i=s.replyToMsgId?this.getServerMessageId(s.replyToMsgId):void 0;let a=s.caption||"",n=s.entities||[];a&&(a=f.a.parseMarkdown(a,n)),this.log("sendAlbum",t,s);const o=""+ ++this.groupedTempId,r=t.map((t,r)=>{const d=s.sendFileDetails[r],l=Object.assign({isGroupedItem:!0,isMedia:s.isMedia,scheduleDate:s.scheduleDate,silent:s.silent,replyToMsgId:i,threadId:s.threadId,groupId:o},d);return 0===r&&(l.caption=a,l.entities=n),this.sendFile(e,t,l).message});s.threadId?x.a.syncDraft(e,s.threadId):x.a.saveDraft(e,s.threadId,null,{notify:!0});const d=(e,t)=>{t?e.error=!0:delete e.error,v.default.dispatchEvent("messages_pending")},l=E.a.getInputPeerById(e),c=t=>{this.setTyping(e,{_:"sendMessageCancelAction"}),this.sendSmthLazyLoadQueue.push({load:()=>u.a.invokeApi("messages.sendMultiMedia",{peer:l,multi_media:t,reply_to_msg_id:i,schedule_date:s.scheduleDate,silent:s.silent,clear_draft:s.clearDraft}).then(e=>{I.a.processUpdateMessage(e)},e=>{r.forEach(e=>d(e,!0))})})},h=r.map((e,t)=>e.send().then(e=>u.a.invokeApi("messages.uploadMedia",{peer:l,media:e})).then(t=>{let s;if("messageMediaPhoto"===t._){const e=D.a.savePhoto(t.photo);s=D.a.getInput(e)}else if("messageMediaDocument"===t._){const e=C.a.saveDoc(t.document);s=C.a.getMediaInput(e)}const i={_:"inputSingleMedia",media:s,random_id:e.random_id,message:a,entities:n};return a&&(a="",n=[]),i}).catch(t=>{if("AbortError"===t.name)return null;throw this.log.error("sendAlbum upload item error:",t,e),d(e,!0),t}));Promise.all(h).then(e=>{c(e.filter(Boolean))})}))}sendOther(e,t,s={}){e=E.a.getPeerMigratedTo(e)||e;const i=this.generateOutgoingMessage(e,s),a=s.replyToMsgId?this.getServerMessageId(s.replyToMsgId):void 0;let n;switch(t._){case"inputMediaPoll":{t.poll.id=i.id,k.a.savePoll(t.poll,{_:"pollResults",flags:4,total_voters:0,pFlags:{}});const{poll:e,results:s}=k.a.getPoll(""+i.id);n={_:"messageMediaPoll",poll:e,results:s};break}}i.media=n;i.send=()=>{const n={};let o;this.pendingAfterMsgs[e]&&(n.afterMessageId=this.pendingAfterMsgs[e].messageId),o=s.viaBotId?u.a.invokeApiAfter("messages.sendInlineBotResult",{peer:E.a.getInputPeerById(e),random_id:i.random_id,reply_to_msg_id:a||void 0,query_id:s.queryId,id:s.resultId,clear_draft:s.clearDraft},n):u.a.invokeApiAfter("messages.sendMedia",{peer:E.a.getInputPeerById(e),media:t,random_id:i.random_id,reply_to_msg_id:a||void 0,message:"",clear_draft:s.clearDraft,schedule_date:s.scheduleDate,silent:s.silent},n),o.then(e=>{e.updates&&e.updates.forEach(e=>{"updateDraftMessage"===e._&&(e.local=!0)}),I.a.processUpdateMessage(e)},e=>{v.default.dispatchEvent("messages_pending")}).finally(()=>{this.pendingAfterMsgs[e]===n&&delete this.pendingAfterMsgs[e]}),this.pendingAfterMsgs[e]=n},this.beforeMessageSending(i,{isScheduled:!!s.scheduleDate||void 0,threadId:s.threadId,clearDraft:s.clearDraft})}beforeMessageSending(e,t={}){const s=e.id,i=this.getMessagePeer(e),a=t.isScheduled?this.getScheduledMessagesStorage(i):this.getMessagesStorage(i);if(t.isScheduled)this.saveMessages([e],{storage:a,isScheduled:!0,isOutgoing:!0}),setTimeout(()=>{v.default.dispatchEvent("scheduled_new",{peerId:i,mid:s})},0);else{const n=[this.getHistoryStorage(i),t.threadId?this.getHistoryStorage(i,t.threadId):void 0];for(const e of n)e&&e.history.unshift(s);this.saveMessages([e],{storage:a,isOutgoing:!0}),setTimeout(()=>{this.setDialogTopMessage(e),v.default.dispatchEvent("history_append",{storage:a,peerId:i,mid:s})},0)}!t.isGroupedItem&&t.clearDraft&&(t.threadId?x.a.syncDraft(i,t.threadId):x.a.saveDraft(i,t.threadId,null,{notify:!0})),this.pendingByRandomId[e.random_id]={peerId:i,tempId:s,threadId:t.threadId,storage:a},!t.isGroupedItem&&e.send&&setTimeout(e.send,0)}generateOutgoingMessage(e,t){t.threadId&&!t.replyToMsgId&&(t.replyToMsgId=t.threadId);return{_:"message",id:this.generateTempMessageId(e),from_id:this.generateFromId(e),peer_id:E.a.getOutputPeer(e),pFlags:this.generateFlags(e),date:t.scheduleDate||Object(o.h)(!0)+m.a.serverTimeOffset,message:"",grouped_id:t.groupId,random_id:Object(l.b)(),reply_to:this.generateReplyHeader(t.replyToMsgId,t.threadId),via_bot_id:t.viaBotId,reply_markup:t.reply_markup,replies:this.generateReplies(e),views:E.a.isBroadcast(e)&&1,pending:!0}}generateReplyHeader(e,t){const s={_:"messageReplyHeader",reply_to_msg_id:e||t};return t&&s.reply_to_msg_id!==t&&(s.reply_to_top_id=t),s}generateReplies(e){let t;if(E.a.isBroadcast(e)){const s=L.default.chatsFull[-e];(null==s?void 0:s.linked_chat_id)&&(t={_:"messageReplies",flags:1,pFlags:{comments:!0},channel_id:s.linked_chat_id,replies:0,replies_pts:0})}return t}generateFromId(e){var t,s;return e<0&&(E.a.isBroadcast(e)||(null===(s=null===(t=E.a.getPeer(e).admin_rights)||void 0===t?void 0:t.pFlags)||void 0===s?void 0:s.anonymous))?void 0:E.a.getOutputPeer(A.a.getSelf().id)}generateFlags(e){const t={};return e!==A.a.getSelf().id&&(t.out=!0,E.a.isChannel(e)||A.a.isBot(e)||(t.unread=!0)),E.a.isBroadcast(e)&&(t.post=!0),t}generateForwardHeader(e,t){const s=A.a.getSelf().id;if(t.fromId===s&&t.peerId===s&&!t.fwd_from)return;const i={_:"messageFwdHeader",flags:0,date:t.date};return t.fwd_from?(i.from_id=t.fwd_from.from_id,i.from_name=t.fwd_from.from_name,i.post_author=t.fwd_from.post_author):(i.from_id=E.a.getOutputPeer(t.fromId),i.post_author=t.post_author),E.a.isBroadcast(t.peerId)&&(t.post_author&&(i.post_author=t.post_author),i.channel_post=t.id),e===s&&(i.saved_from_msg_id=t.id,i.saved_from_peer=E.a.getOutputPeer(t.peerId)),i}generateFakeAvatarMessage(e,t){const s=Number.MAX_SAFE_INTEGER,i={_:"messageService",action:{_:"messageActionChannelEditPhoto",photo:t},mid:s,peerId:e,date:t.date,fromId:e};return this.getMessagesStorage(e)[s]=i,i}setDialogTopMessage(e,t=this.getDialogOnly(e.peerId)){if(t){t.top_message=e.mid;this.getHistoryStorage(e.peerId).maxId=e.mid,this.dialogsStorage.generateIndexForDialog(t,!1,e),this.scheduleHandleNewDialogs(e.peerId,t)}}cancelPendingMessage(e){const t=this.pendingByRandomId[e];if(t){const{peerId:s,tempId:i,storage:a}=t,n=this.getHistoryStorage(s);return I.a.processUpdateMessage({_:"updateShort",update:{_:"updateDeleteMessages",messages:[i]}}),n.history.delete(i),delete this.pendingByRandomId[e],delete a[i],!0}return!1}refreshConversations(){return q(this,void 0,void 0,(function*(){const e=[];for(let t=0;t<2;++t){let s=0;for(;;){const{dialogs:i}=yield Y.getTopMessages(200,t,s);if(!i.length)break;{e.push(...i);const t=i[i.length-1],a=E.a.getPeerId(t.peer),n=this.generateMessageId(t.top_message);if(s=this.getMessageByPeer(a,n).date,!s){console.error("refreshConversations: got no offsetDate",t);break}}}}let t={};return e.forEach(e=>{t[e.peerId]=e}),v.default.dispatchEvent("dialogs_multiupdate",t),e}))}getConversationsAll(e="",t=0){return q(this,void 0,void 0,(function*(){const s=[];for(;t<2;++t){let i=0;for(;;){const{dialogs:a}=yield Y.getConversations(e,i,200,t);if(!a.length)break;s.push(...a),i=a[a.length-1].index||0}}return s}))}getConversations(e="",t,s=20,i=0){return this.dialogsStorage.getDialogs(e,t,s,i)}getReadMaxIdIfUnread(e,t){var s;const i=this.getHistoryStorage(e,t);if(t){const t=this.getHistoryStorage(e),a=Math.max(null!==(s=t.readMaxId)&&void 0!==s?s:0,i.readMaxId);return!this.getMessageByPeer(e,i.maxId).pFlags.out&&a<i.maxId?a:0}{const t=this.getMessageByPeer(e,i.maxId),s=e>0?Math.max(i.readMaxId,i.readOutboxMaxId):i.readMaxId;return!t.pFlags.out&&s<i.maxId?s:0}}getTopMessages(e,t,s){const i=this.dialogsStorage.getFolder(t);let a=0;return void 0===s&&(s=this.dialogsStorage.getOffsetDate(t)),s&&(a=65536*s,s+=m.a.serverTimeOffset),u.a.invokeApiSingle("messages.getDialogs",{folder_id:t,offset_date:s,offset_id:0,offset_peer:E.a.getInputPeerById(0),limit:e,hash:0},{noErrorBox:!0}).then(n=>{if("messages.dialogsNotModified"===n._)return null;O.b&&this.log("messages.getDialogs result:",n.dialogs,Object.assign({},n.dialogs[0])),s||this.dialogsStorage.resetPinnedOrder(t),A.a.saveApiUsers(n.users),S.a.saveApiChats(n.chats),this.saveMessages(n.messages);let o=!!s,r=!1;const d={};Object(_.c)(n.dialogs,e=>{var s;this.dialogsStorage.saveDialog(e,null!==(s=e.folder_id)&&void 0!==s?s:t),o||E.a.isChannel(E.a.getPeerId(e.peer))||(this.incrementMaxSeenId(e.top_message),o=!0),void 0!==e.peerId&&(a&&e.index>a&&(this.scheduleHandleNewDialogs(e.peerId,e),r=!0),this.getServerMessageId(e.read_inbox_max_id)||this.getServerMessageId(e.read_outbox_max_id)||(d[e.peerId]=e,this.log.error("noIdsDialogs",e)))}),Object.keys(d).length&&this.reloadConversation(Object.keys(d).map(e=>+e)).then(()=>{v.default.dispatchEvent("dialogs_multiupdate",d);for(let e in d)v.default.dispatchEvent("dialog_unread",{peerId:+e})});const l=n.count;return(e>n.dialogs.length||!l||i.length>=l)&&this.dialogsStorage.setDialogsLoaded(t,!0),r?this.scheduleHandleNewDialogs():v.default.dispatchEvent("dialogs_multiupdate",{}),n})}forwardMessages(e,t,s,i={}){e=E.a.getPeerMigratedTo(e)||e,s=s.slice().sort((e,t)=>e-t);const a={},n=s.map(s=>{var n,o;const r=this.getMessageByPeer(t,s),d=this.generateOutgoingMessage(e,i);d.fwd_from=this.generateForwardHeader(e,r),["entities","forwards","message","media","reply_markup","views"].forEach(e=>{d[e]=r[e]});const l=null===(n=d.media)||void 0===n?void 0:n.document;if(l){["round","voice"].includes(l.type)&&(d.pFlags.media_unread=!0)}if(r.grouped_id){(null!==(o=a[r.grouped_id])&&void 0!==o?o:a[r.grouped_id]={tempId:""+ ++this.groupedTempId,messages:[]}).messages.push(d)}return d});for(const e in a){const t=a[e];t.messages.length>1&&t.messages.forEach(e=>{e.grouped_id=t.tempId})}n.forEach(e=>{this.beforeMessageSending(e,{isScheduled:!!i.scheduleDate||void 0})});const o={};this.pendingAfterMsgs[e]&&(o.afterMessageId=this.pendingAfterMsgs[e].messageId);const r=u.a.invokeApiAfter("messages.forwardMessages",{from_peer:E.a.getInputPeerById(t),id:s.map(e=>this.getServerMessageId(e)),random_id:n.map(e=>e.random_id),to_peer:E.a.getInputPeerById(e),with_my_score:i.withMyScore,silent:i.silent,schedule_date:i.scheduleDate},o).then(e=>{this.log("forwardMessages updates:",e),I.a.processUpdateMessage(e)}).finally(()=>{this.pendingAfterMsgs[e]===o&&delete this.pendingAfterMsgs[e]});return this.pendingAfterMsgs[e]=o,r}getMessageFromStorage(e,t){return e&&e[t]||{_:"messageEmpty",id:t,deleted:!0,pFlags:{}}}createMessageStorage(){return{}}getMessagesStorage(e){var t;return null!==(t=this.messagesStorageByPeerId[e])&&void 0!==t?t:this.messagesStorageByPeerId[e]=this.createMessageStorage()}getMessageById(e){for(const t in this.messagesStorageByPeerId){if(E.a.isChannel(+t))continue;const s=this.messagesStorageByPeerId[t][e];if(s)return s}return this.getMessageFromStorage(null,e)}getMessageByPeer(e,t){return e?this.getMessageFromStorage(this.getMessagesStorage(e),t):this.getMessageById(t)}getMessagePeer(e){return e.peer_id&&E.a.getPeerId(e.peer_id)||0}getDialogByPeerId(e){return this.dialogsStorage.getDialog(e)}getDialogOnly(e){return this.dialogsStorage.getDialogOnly(e)}reloadConversation(e){return[].concat(e).forEach(e=>{this.reloadConversationsPeers.has(e)||this.reloadConversationsPeers.add(e)}),this.reloadConversationsPromise?this.reloadConversationsPromise:this.reloadConversationsPromise=new Promise((e,t)=>{setTimeout(()=>{const s=Array.from(this.reloadConversationsPeers).map(e=>E.a.getInputDialogPeerById(e));this.reloadConversationsPeers.clear(),u.a.invokeApi("messages.getPeerDialogs",{peers:s}).then(t=>{this.dialogsStorage.applyDialogs(t),e()},t).finally(()=>{this.reloadConversationsPromise=null})},0)})}doFlushHistory(e,t,s){return u.a.invokeApi("messages.deleteHistory",{just_clear:t,revoke:s,peer:e,max_id:0}).then(s=>(I.a.processUpdateMessage({_:"updateShort",update:{_:"updatePts",pts:s.pts,pts_count:s.pts_count}}),!s.offset||this.doFlushHistory(e,t)))}flushHistory(e,t,s){return q(this,void 0,void 0,(function*(){if(E.a.isChannel(e)){const t=this.getHistory(e,0,1),s=t instanceof Promise?yield t:t,i=-e,a=s.history[0]||0;return u.a.invokeApi("channels.deleteHistory",{channel:S.a.getChannelInput(i),max_id:a}).then(()=>(I.a.processUpdateMessage({_:"updateShort",update:{_:"updateChannelAvailableMessages",channel_id:i,available_min_id:a}}),!0))}return this.doFlushHistory(E.a.getInputPeerById(e),t,s).then(()=>{delete this.historiesStorage[e],delete this.messagesStorageByPeerId[e],t?v.default.dispatchEvent("dialog_flush",{peerId:e}):(this.dialogsStorage.dropDialog(e),v.default.dispatchEvent("dialog_drop",{peerId:e}))})}))}hidePinnedMessages(e){return Promise.all([j.default.getState(),this.getPinnedMessage(e)]).then(([t,s])=>{t.hiddenPinnedMessages[e]=s.maxId,v.default.dispatchEvent("peer_pinned_hidden",{peerId:e,maxId:s.maxId})})}getPinnedMessage(e){var t;const s=null!==(t=this.pinnedMessages[e])&&void 0!==t?t:this.pinnedMessages[e]={};return s.promise?s.promise:s.maxId?Promise.resolve(s):s.promise=this.getSearch({peerId:e,inputFilter:{_:"inputMessagesFilterPinned"},maxId:0,limit:1}).then(e=>{var t;return s.count=e.count,s.maxId=null===(t=e.history[0])||void 0===t?void 0:t.mid,s}).finally(()=>{delete s.promise})}updatePinnedMessage(e,t,s,i,a){return u.a.invokeApi("messages.updatePinnedMessage",{peer:E.a.getInputPeerById(e),unpin:s,silent:i,pm_oneside:a,id:this.getServerMessageId(t)}).then(e=>{I.a.processUpdateMessage(e)})}unpinAllMessages(e){return u.a.invokeApi("messages.unpinAllMessages",{peer:E.a.getInputPeerById(e)}).then(t=>{if(I.a.processUpdateMessage({_:"updateShort",update:{_:"updatePts",pts:t.pts,pts_count:t.pts_count}}),!t.offset){const t=this.getMessagesStorage(e);for(const e in t){const s=t[e];s.pFlags.pinned&&delete s.pFlags.pinned}return v.default.dispatchEvent("peer_pinned_messages",{peerId:e,unpinAll:!0}),delete this.pinnedMessages[e],!0}return this.unpinAllMessages(e)})}getAlbumText(e){const t=this.groupedMessagesStorage[e];let s,i,a,n=0;for(const e in t){const o=t[e];if(o.message){if(++n>1)break;s=o.message,i=o.totalEntities,a=o.entities}}return n>1&&(s=void 0,i=void 0,a=void 0),{message:s,entities:a,totalEntities:i}}getMidsByAlbum(e){return Object(d.e)(this.groupedMessagesStorage[e],"asc")}getMidsByMessage(e){return(null==e?void 0:e.grouped_id)?this.getMidsByAlbum(e.grouped_id):[e.mid]}filterMessages(e,t){const s=[];if(e.grouped_id){const i=this.groupedMessagesStorage[e.grouped_id];for(const e in i){const a=i[e];t(a)&&s.push(a)}}else t(e)&&s.push(e);return s}generateTempMessageId(e){const t=this.getDialogOnly(e);return this.generateMessageId((null==t?void 0:t.top_message)||0,!0)}generateMessageId(e,t=!1){const s=V.MESSAGE_ID_OFFSET,i=t?++this.tempNum:0;return e>=s?t?e+(i&V.MESSAGE_ID_INCREMENT-1):e:s+(e*V.MESSAGE_ID_INCREMENT+(i&V.MESSAGE_ID_INCREMENT-1))}getServerMessageId(e){const t=V.MESSAGE_ID_OFFSET;if(e<t)return e;const s=V.MESSAGE_ID_INCREMENT-1,i=e&s;return i!==s&&(e-=i+1),(e-t)/V.MESSAGE_ID_INCREMENT}incrementMessageId(e,t){return this.generateMessageId(this.getServerMessageId(e)+t)}saveMessages(e,t={}){e.forEach(e=>{var s;if(void 0===e.pFlags&&(e.pFlags={}),"messageEmpty"===e._)return;const i=this.getMessagePeer(e),a=t.storage||this.getMessagesStorage(i),n="peerChannel"===e.peer_id._,o=n?-i:0,r=n&&S.a.isBroadcast(o);t.isScheduled&&(e.pFlags.is_scheduled=!0),t.isOutgoing&&(e.pFlags.is_outgoing=!0);const d=this.generateMessageId(e.id);if(e.mid=d,e.grouped_id){(null!==(s=this.groupedMessagesStorage[e.grouped_id])&&void 0!==s?s:this.groupedMessagesStorage[e.grouped_id]={})[d]=e}const l=this.getDialogOnly(i);l&&d&&d>l[e.pFlags.out?"read_outbox_max_id":"read_inbox_max_id"]&&(e.pFlags.unread=!0),e.reply_to&&(e.reply_to.reply_to_msg_id&&(e.reply_to.reply_to_msg_id=e.reply_to_mid=this.generateMessageId(e.reply_to.reply_to_msg_id)),e.reply_to.reply_to_top_id&&(e.reply_to.reply_to_top_id=this.generateMessageId(e.reply_to.reply_to_top_id))),e.replies&&(e.replies.max_id&&(e.replies.max_id=this.generateMessageId(e.replies.max_id)),e.replies.read_max_id&&(e.replies.read_max_id=this.generateMessageId(e.replies.read_max_id)));const c=!!e.peerId;c||(e.date-=m.a.serverTimeOffset);const h=A.a.getSelf().id;e.peerId=i,e.peerId===h?e.fromId=e.fwd_from?e.fwd_from.from_id?E.a.getPeerId(e.fwd_from.from_id):0:h:e.fromId=e.pFlags.post||!e.from_id?i:E.a.getPeerId(e.from_id);const p=e.fwd_from;if(p){p.saved_from_msg_id&&(p.saved_from_msg_id=this.generateMessageId(p.saved_from_msg_id)),p.channel_post&&(p.channel_post=this.generateMessageId(p.channel_post));const t=p.saved_from_peer||p.from_id,s=p.saved_from_msg_id||p.channel_post;if(t&&s){const i=E.a.getPeerId(t),a=this.generateMessageId(s);e.savedFrom=i+"_"+a}e.fwdFromId=E.a.getPeerId(p.from_id),c||(p.date-=m.a.serverTimeOffset)}e.via_bot_id>0&&(e.viaBotId=e.via_bot_id);const u={type:"message",peerId:i,messageId:d};if(e.media)switch(e.media._){case"messageMediaEmpty":delete e.media;break;case"messageMediaPhoto":e.media.ttl_seconds?e.media={_:"messageMediaUnsupportedWeb"}:e.media.photo=D.a.savePhoto(e.media.photo,u),e.media.photo||delete e.media;break;case"messageMediaPoll":e.media.poll=k.a.savePoll(e.media.poll,e.media.results);break;case"messageMediaDocument":e.media.ttl_seconds?e.media={_:"messageMediaUnsupportedWeb"}:e.media.document=C.a.saveDoc(e.media.document,u);break;case"messageMediaWebPage":e.media.webpage=F.a.saveWebPage(e.media.webpage,e.mid,u);break;case"messageMediaInvoice":e.media={_:"messageMediaUnsupportedWeb"}}if(e.action){const t=e.action;let s,i;const a=e.fromId===A.a.getSelf().id?"You":"";switch(t._){case"messageActionChatEditPhoto":t.photo=D.a.savePhoto(t.photo,u),t.photo.video_sizes?t._=r?"messageActionChannelEditVideo":"messageActionChatEditVideo":r&&(t._="messageActionChannelEditPhoto");break;case"messageActionGroupCall":{let s;void 0===t.duration?(s="started",e.peerId!==e.fromId&&(s+="_by"+a)):s="ended_by"+a,t.type=s;break}case"messageActionChatEditTitle":r&&(t._="messageActionChannelEditTitle");break;case"messageActionChatDeletePhoto":r&&(t._="messageActionChannelDeletePhoto");break;case"messageActionChatAddUser":1===t.users.length?(t.user_id=t.users[0],e.fromId===t.user_id&&(t._=n?"messageActionChatJoined"+a:"messageActionChatReturn"+a)):t.users.length>1&&(t._="messageActionChatAddUsers");break;case"messageActionChatDeleteUser":e.fromId===t.user_id&&(t._="messageActionChatLeave"+a);break;case"messageActionChannelMigrateFrom":s=-t.chat_id,i=-o;break;case"messageActionChatMigrateTo":s=-o,i=-t.channel_id;break;case"messageActionHistoryClear":e.clear_history=!0,delete e.pFlags.out,delete e.pFlags.unread;break;case"messageActionPhoneCall":t.type=(e.pFlags.out?"out_":"in_")+("phoneCallDiscardReasonMissed"===t.reason._||"phoneCallDiscardReasonBusy"===t.reason._?"missed":"ok")}s&&i&&!this.migratedFromTo[s]&&!this.migratedToFrom[i]&&this.migrateChecks(s,i)}e.message&&e.message.length&&!e.totalEntities&&this.wrapMessageEntities(e),a[d]=e})}wrapMessageEntities(e){const t=e.entities?e.entities.slice():[];e.message=f.a.fixEmoji(e.message,t);const s=f.a.parseEntities(e.message);e.totalEntities=f.a.mergeEntities(t,s)}wrapMessageForReply(e,t=e.message,s,i,a){const n=[],o=(e,t,s)=>{if(e&&(t=i?h.default.format(e,!0):Object(h.i18n)(e)),i)n.push(t);else{const e=document.createElement("i");"string"==typeof t?e.innerHTML=t:e.append(t),n.push(e)}s&&n.push(", ")};if(e.media){let a=!0;if(e.grouped_id){if(s){const t=this.getMidsByMessage(e);if(s.length===t.length){for(const e of t)if(!s.includes(e)){a=!1;break}}else a=!1}a&&o("AttachAlbum",void 0,t=this.getAlbumText(e.grouped_id).message)}else a=!1;if(!a){const s=e.media;switch(s._){case"messageMediaPhoto":o("AttachPhoto",void 0,e.message);break;case"messageMediaDice":o(void 0,i?s.emoticon:f.a.wrapEmojiText(s.emoticon));break;case"messageMediaVenue":{const e=i?s.title:f.a.wrapEmojiText(s.title);o("AttachLocation",void 0,e),n.push(Object(N.a)(e));break}case"messageMediaGeo":o("AttachLocation");break;case"messageMediaGeoLive":o("AttachLiveLocation");break;case"messageMediaPoll":o(void 0,i?"📊 "+(s.poll.question||"poll"):s.poll.rReply);break;case"messageMediaContact":o("AttachContact");break;case"messageMediaGame":{const e="🎮 ";o(void 0,i?e+s.game.title:f.a.wrapEmojiText(e+s.game.title));break}case"messageMediaDocument":let a=s.document;"video"===a.type?o("AttachVideo",void 0,e.message):"voice"===a.type?o("AttachAudio",void 0,e.message):"gif"===a.type?o("AttachGif",void 0,e.message):"round"===a.type?o("AttachRound",void 0,e.message):"sticker"===a.type?(o(void 0,((i?a.stickerEmojiRaw:a.stickerEmoji)||"")+"Sticker"),t=""):o(a.file_name,void 0,e.message)}}}if(e.action){const t=this.wrapMessageActionTextNew(e,i);t&&o(void 0,t)}if(t)if(t=Object(c.f)(t,100),i)n.push(t);else{let e=f.a.parseEntities(t.replace(/\n/g," "));if(a){a=a.trim(),e||(e=[]);let s,i=!1,n=new RegExp(Object(c.e)(a),"gi");for(;null!==(s=n.exec(t));)e.push({_:"messageEntityHighlight",length:a.length,offset:s.index}),i=!0;i&&e.sort((e,t)=>e.offset-t.offset)}const s=f.a.wrapRichText(t,{noLinebreaks:!0,entities:e,noLinks:!0,noTextFormat:!0});n.push(Object(N.a)(s))}if(i)return n.join("");{const e=document.createDocumentFragment();return e.append(...n),e}}getSenderToPeerText(e){let t,s="";return s=e.pFlags.out?"You":E.a.getPeerTitle(e.fromId,!1,!1),t=E.a.isAnyGroup(e.peerId)||e.pFlags.out&&e.peerId!==v.default.myId?E.a.getPeerTitle(e.peerId,!1,!1):"",t&&(s+=" ➝ "+t),s}wrapMessageActionTextNew(e,t){const s=t?void 0:document.createElement("span"),i=e.action;if(i.message)return t?f.a.wrapPlainText(e.message):(s.innerHTML=f.a.wrapRichText(i.message,{noLinebreaks:!0}),s);{let a,n,r=i._;const d=(e,t)=>t?E.a.getPeerTitle(e,t)+" ":new R.a({peerId:e}).element;switch(i._){case"messageActionPhoneCall":r+="."+i.type,n=[G(i.duration)];break;case"messageActionGroupCall":r+="."+i.type,n=[],r.endsWith("You")||n.push(d(e.fromId,t)),n.push(G(i.duration));break;case"messageActionInviteToGroupCall":{const s=[e.fromId,i.users[0]];let o="ActionGroupCall";const r=A.a.getSelf().id;s[0]===r&&(o+="You"),o+="Invited",s[1]===r&&(o+="You"),s.findAndSplice(e=>e===r),a=o,n=s.map(e=>d(e,t));break}case"messageActionGroupCallScheduled":{const t=new Date,s=new Date(1e3*i.schedule_date),r=(s.getTime()-t.getTime())/864e5,d=new Date(t);d.setDate(d.getDate()+1),a="ChatList.Service.VoiceChatScheduled";const l=A.a.getSelf().id;e.fromId===l&&(a+="You");let c,p=[];r<1&&s.getDate()===t.getDate()?c="TodayAtFormattedWithToday":r<2&&s.getDate()===d.getDate()?c="Time.TomorrowAt":(c="formatDateAtTime",p.push(new h.default.IntlDateElement({date:s,options:{day:"2-digit",month:"2-digit",year:"2-digit"}}).element)),p.push(Object(o.e)(s));n=[Object(h.i18n)(c,p)];break}case"messageActionPinMessage":case"messageActionContactSignUp":case"messageActionChatReturn":case"messageActionChatLeave":case"messageActionChatJoined":case"messageActionChatCreate":case"messageActionChatEditPhoto":case"messageActionChatDeletePhoto":case"messageActionChatEditVideo":case"messageActionChatJoinedByLink":case"messageActionChannelEditVideo":case"messageActionChannelDeletePhoto":n=[d(e.fromId,t)];break;case"messageActionChannelEditTitle":case"messageActionChatEditTitle":n=[],"messageActionChatEditTitle"===i._&&n.push(d(e.fromId,t)),n.push(t?i.title:Object(B.a)(f.a.wrapEmojiText(i.title)));break;case"messageActionChatDeleteUser":case"messageActionChatAddUsers":case"messageActionChatAddUser":{const s=i.users||[i.user_id];if(n=[d(e.fromId,t)],s.length>1)if(t)n.push(...s.map(e=>d(e,!0).trim()).join(", "));else{const e=document.createElement("span");e.append(...Object(h.join)(s.map(e=>d(e,!1)),!1)),n.push(e)}else n.push(d(s[0],t));break}case"messageActionBotAllowed":{const e=f.a.wrapRichText(i.domain,{entities:[{_:"messageEntityUrl",length:i.domain.length,offset:0}]});n=[Object(B.a)(e)];break}default:a=h.langPack[r]||`[${i._}]`}return a||(a=h.langPack[r],void 0===a&&(a="["+r+"]")),t?h.default.format(a,!0,n):Object(h._i18n)(s,a,n)}}editPeerFolders(e,t){u.a.invokeApi("folders.editPeerFolders",{folder_peers:e.map(e=>({_:"inputFolderPeer",peer:E.a.getInputPeerById(e),folder_id:t}))}).then(e=>{I.a.processUpdateMessage(e)})}toggleDialogPin(e,t){var s;if(t>1)return this.filtersStorage.toggleDialogPin(e,t);const i=this.getDialogOnly(e);if(!i)return Promise.reject();const a=!(null===(s=i.pFlags)||void 0===s?void 0:s.pinned)||void 0;return u.a.invokeApi("messages.toggleDialogPin",{peer:E.a.getInputDialogPeerById(e),pinned:a}).then(s=>{if(s){const s=a?{pinned:a}:{};I.a.saveUpdate({_:"updateDialogPinned",peer:E.a.getDialogPeer(e),folder_id:t,pFlags:s})}})}markDialogUnread(e,t){var s;const i=this.getDialogOnly(e);if(!i)return Promise.reject();const a=!t&&!(null===(s=i.pFlags)||void 0===s?void 0:s.unread_mark)||void 0;return u.a.invokeApi("messages.markDialogUnread",{peer:E.a.getInputDialogPeerById(e),unread:a}).then(t=>{if(t){const t=a?{unread:a}:{};this.onUpdateDialogUnreadMark({_:"updateDialogUnreadMark",peer:E.a.getDialogPeer(e),pFlags:t})}})}migrateChecks(e,t){if(!this.migratedFromTo[e]&&!this.migratedToFrom[t]&&S.a.hasChat(-t)){const s=S.a.getChat(-e);if(s&&s.migrated_to&&s.migrated_to.channel_id===-t){this.migratedFromTo[e]=t,this.migratedToFrom[t]=e,v.default.dispatchEvent("dialog_migrate",{migrateFrom:e,migrateTo:t});const s=this.dialogsStorage.dropDialog(e);s.length&&v.default.dispatchEvent("dialog_drop",{peerId:e,dialog:s[0]})}}}canMessageBeEdited(e,t){if(e.pFlags.is_outgoing)return!1;const s=["messageMediaPhoto","messageMediaDocument","messageMediaWebPage"];return"poll"===t&&s.push("messageMediaPoll"),!("message"!==e._||e.deleted||e.fwd_from||e.via_bot_id||e.media&&-1===s.indexOf(e.media._)||e.fromId&&A.a.isBot(e.fromId))&&(!e.media||"messageMediaDocument"!==e.media._||!e.media.document.sticker&&"round"!==e.media.document.type)}canEditMessage(e,t="text"){var s;return!(!e||!this.canMessageBeEdited(e,t))&&(!(!e.pFlags.out&&this.getMessagePeer(e)!==A.a.getSelf().id)||!(e.date<Object(o.h)(!0)-172800&&"messageMediaPoll"!==(null===(s=e.media)||void 0===s?void 0:s._)||!e.pFlags.out))}canDeleteMessage(e){return e&&(e.peerId>0||e.fromId===v.default.myId||"chat"===S.a.getChat(e.peerId)._||S.a.hasRights(e.peerId,"delete_messages"))&&!e.pFlags.is_outgoing}mergeReplyKeyboard(e,t){var s;if(!t.reply_markup&&!(null===(s=t.pFlags)||void 0===s?void 0:s.out)&&!t.action)return!1;if(t.reply_markup&&"replyInlineMarkup"===t.reply_markup._)return!1;var i=t.reply_markup,a=e.reply_markup;if(i)return!(a&&a.mid>=t.mid)&&(!i.pFlags.selective&&(e.maxOutId&&t.mid<e.maxOutId&&i.pFlags.single_use&&(i.pFlags.hidden=!0),"replyKeyboardHide"!==(i=Object.assign({mid:t.mid},i))._&&(i.fromId=E.a.getPeerId(t.from_id)),e.reply_markup=i,!0));if(t.pFlags.out)if(a){if(a.pFlags.single_use&&!a.pFlags.hidden&&(t.mid>a.mid||t.pFlags.is_outgoing)&&t.message)return a.pFlags.hidden=!0,!0}else(!e.maxOutId||t.mid>e.maxOutId)&&(e.maxOutId=t.mid);return!(!t.action||"messageActionChatDeleteUser"!==t.action._||!(a?t.action.user_id===a.fromId:A.a.isBot(t.action.user_id)))&&(e.reply_markup={_:"replyKeyboardHide",mid:t.mid,pFlags:{}},!0)}getSearchStorage(e,t){return this.searchesStorage[e]||(this.searchesStorage[e]={}),this.searchesStorage[e][t]||(this.searchesStorage[e][t]={history:[]}),this.searchesStorage[e][t]}getSearchCounters(e,t,s=!0){return(s?u.a.invokeApiCacheable:u.a.invokeApi).bind(u.a)("messages.getSearchCounters",{peer:E.a.getInputPeerById(e),filters:t})}getSearch({peerId:e,query:t,inputFilter:s,maxId:i,limit:a,nextRate:n,backLimit:o,threadId:r,folderId:d,minDate:l,maxDate:c}){e||(e=0),t||(t=""),s||(s={_:"inputMessagesFilterEmpty"}),void 0===a&&(a=20),n||(n=0),o||(o=0),l=l?l/1e3|0:0,c=c?c/1e3|0:0;const h=[];o&&(a+=o);let p;if(e&&!o&&!i&&!t&&1!==a&&!r){p=this.getHistoryStorage(e);let t=!0;const i=p.history;if(void 0!==p&&i.length){const n={},o=[],r=[];switch(s._){case"inputMessagesFilterPhotos":n.messageMediaPhoto=!0;break;case"inputMessagesFilterPhotoVideo":n.messageMediaPhoto=!0,n.messageMediaDocument=!0,o.push("video");break;case"inputMessagesFilterVideo":n.messageMediaDocument=!0,o.push("video");break;case"inputMessagesFilterDocument":n.messageMediaDocument=!0,r.push("video");break;case"inputMessagesFilterVoice":n.messageMediaDocument=!0,o.push("voice");break;case"inputMessagesFilterRoundVoice":n.messageMediaDocument=!0,o.push("round","voice");break;case"inputMessagesFilterRoundVideo":n.messageMediaDocument=!0,o.push("round");break;case"inputMessagesFilterMusic":n.messageMediaDocument=!0,o.push("audio");break;case"inputMessagesFilterUrl":n.url=!0;break;case"inputMessagesFilterChatPhotos":n.avatar=!0;break;default:t=!1}if(t){const t=this.getMessagesStorage(e);for(let e=0,s=i.length;e<s;e++){const s=t[i.slice[e]];if(!s)continue;let d=!1;if(s.media&&n[s.media._]&&!s.fwd_from){if("messageMediaDocument"===s.media._&&(o.length&&!o.includes(s.media.document.type)||r.includes(s.media.document.type)))continue;d=!0}else if(n.url&&s.message){const e=["messageEntityTextUrl","messageEntityUrl"];(s.totalEntities.find(t=>e.includes(t._))||f.a.matchUrl(s.message))&&(d=!0)}else n.avatar&&s.action&&["messageActionChannelEditPhoto","messageActionChatEditPhoto","messageActionChannelEditVideo","messageActionChatEditVideo"].includes(s.action._)&&(d=!0);if(d&&(h.push(s),h.length>=a))break}}}}if(h.length){if(!(h.length<a))return Promise.resolve({count:0,next_rate:0,offset_id_offset:0,history:h});i=h[h.length-1].mid,a-=h.length}else 0;const g=u.a.invokeApi.bind(u.a);let m;if(e&&!n&&void 0===d)m=g("messages.search",{peer:E.a.getInputPeerById(e),q:t||"",filter:s,min_date:l,max_date:c,limit:a,offset_id:this.getServerMessageId(i)||0,add_offset:o?-o:0,max_id:0,min_id:0,hash:0,top_msg_id:this.getServerMessageId(r)||0},{noErrorBox:!0});else{let o=0,r=0,h=i&&this.getMessageByPeer(e,i);h&&h.date&&(r=h.id,o=this.getMessagePeer(h)),m=g("messages.searchGlobal",{q:t,filter:s,min_date:l,max_date:c,offset_rate:n,offset_peer:E.a.getInputPeerById(o),offset_id:r,limit:a,folder_id:d},{noErrorBox:!0})}return m.then(e=>{A.a.saveApiUsers(e.users),S.a.saveApiChats(e.chats),this.saveMessages(e.messages),O.b&&this.log("getSearch result:",s,e);const t=e.count||h.length+e.messages.length;return e.messages.forEach(e=>{const t=this.getMessagePeer(e);if(t<0){const e=S.a.getChat(-t);e.migrated_to&&this.migrateChecks(t,-e.migrated_to.channel_id)}h.push(e)}),{count:t,offset_id_offset:e.offset_id_offset||0,next_rate:e.next_rate,history:h}})}subscribeRepliesThread(e,t){const s=e+"_"+t;for(const e in this.threadsToReplies)if(this.threadsToReplies[e]===s)return;this.getDiscussionMessage(e,t)}generateThreadServiceStartMessage(e){const t=e.peerId+"_"+e.mid;if(this.threadsServiceMessagesIdsStorage[t])return;const s=this.getServerMessageId(Math.max(...this.getMidsByMessage(e))),i={_:"messageService",pFlags:{is_single:!0},id:this.generateMessageId(s,!0),date:e.date,from_id:{_:"peerUser",user_id:0},peer_id:e.peer_id,action:{_:"messageActionCustomAction",message:"Discussion started"},reply_to:this.generateReplyHeader(e.id)};this.saveMessages([i],{isOutgoing:!0}),this.threadsServiceMessagesIdsStorage[t]=i.mid}getDiscussionMessage(e,t){return u.a.invokeApiSingle("messages.getDiscussionMessage",{peer:E.a.getInputPeerById(e),msg_id:this.getServerMessageId(t)}).then(s=>{var i;S.a.saveApiChats(s.chats),A.a.saveApiUsers(s.users),this.saveMessages(s.messages);const a=this.filterMessages(s.messages[0],e=>!!e.replies)[0],n=a.peerId+"_"+a.mid;this.generateThreadServiceStartMessage(a);const o=this.getHistoryStorage(a.peerId,a.mid);return s.max_id=o.maxId=this.generateMessageId(s.max_id)||0,s.read_inbox_max_id=o.readMaxId=this.generateMessageId(null!==(i=s.read_inbox_max_id)&&void 0!==i?i:a.mid),s.read_outbox_max_id=o.readOutboxMaxId=this.generateMessageId(s.read_outbox_max_id)||0,this.threadsToReplies[n]=e+"_"+t,a})}handleNewMessage(e,t){void 0===this.newMessagesToHandle[e]&&(this.newMessagesToHandle[e]=new Set),this.newMessagesToHandle[e].add(t),this.newMessagesHandleTimeout||(this.newMessagesHandleTimeout=window.setTimeout(this.handleNewMessages,0))}scheduleHandleNewDialogs(e,t){return void 0!==e&&(this.newDialogsToHandle[e]=t),this.newDialogsHandlePromise?this.newDialogsHandlePromise:this.newDialogsHandlePromise=new Promise(e=>{setTimeout(()=>{this.newDialogsHandlePromise=void 0,this.handleNewDialogs()},0)})}deleteMessages(e,t,s){let i;const a=t.map(e=>this.getServerMessageId(e));if(e<0&&E.a.isChannel(e)){const s=-e,n=S.a.getChat(s);if(!(n.pFlags.creator||n.pFlags.editor&&n.pFlags.megagroup)){const s=[];if((n.pFlags.editor||n.pFlags.megagroup)&&t.forEach((i,a)=>{this.getMessageByPeer(e,t[a]).pFlags.out&&s.push(i)}),!s.length)return;t=s}i=u.a.invokeApi("channels.deleteMessages",{channel:S.a.getChannelInput(s),id:a}).then(e=>{I.a.processUpdateMessage({_:"updateShort",update:{_:"updateDeleteChannelMessages",channel_id:s,messages:t,pts:e.pts,pts_count:e.pts_count}})})}else i=u.a.invokeApi("messages.deleteMessages",{revoke:s,id:a}).then(e=>{I.a.processUpdateMessage({_:"updateShort",update:{_:"updateDeleteMessages",messages:t,pts:e.pts,pts_count:e.pts_count}})});return i}readHistory(e,t=0,s,i=!1){if(this.log("readHistory:",e,t,s),!this.getReadMaxIdIfUnread(e,s)&&!i)return this.log("readHistory: isn't unread"),Promise.resolve();const a=this.getHistoryStorage(e,s);if(a.triedToReadMaxId>=t)return Promise.resolve();let n;return s?(a.readPromise||(n=u.a.invokeApi("messages.readDiscussion",{peer:E.a.getInputPeerById(e),msg_id:this.getServerMessageId(s),read_max_id:this.getServerMessageId(t)})),I.a.processUpdateMessage({_:"updateShort",update:{_:"updateReadChannelDiscussionInbox",channel_id:-e,top_msg_id:s,read_max_id:t}})):E.a.isChannel(e)?(a.readPromise||(n=u.a.invokeApi("channels.readHistory",{channel:S.a.getChannelInput(-e),max_id:this.getServerMessageId(t)})),I.a.processUpdateMessage({_:"updateShort",update:{_:"updateReadChannelInbox",max_id:t,channel_id:-e}})):(a.readPromise||(n=u.a.invokeApi("messages.readHistory",{peer:E.a.getInputPeerById(e),max_id:this.getServerMessageId(t)}).then(e=>{I.a.processUpdateMessage({_:"updateShort",update:{_:"updatePts",pts:e.pts,pts_count:e.pts_count}})})),I.a.processUpdateMessage({_:"updateShort",update:{_:"updateReadHistoryInbox",max_id:t,peer:E.a.getOutputPeer(e)}})),U.a.soundReset(E.a.getPeerString(e)),a.readPromise?a.readPromise:(a.triedToReadMaxId=t,n.finally(()=>{delete a.readPromise,this.log("readHistory: promise finally",t,a.readMaxId),a.readMaxId>t&&this.readHistory(e,a.readMaxId,s,!0)}),a.readPromise=n)}readAllHistory(e,t,s=!1){const i=this.getHistoryStorage(e,t);i.maxId&&this.readHistory(e,i.maxId,t,s)}readMessages(e,t){if(t=t.map(e=>this.getServerMessageId(e)),e<0&&E.a.isChannel(e)){const s=-e;u.a.invokeApi("channels.readMessageContents",{channel:S.a.getChannelInput(s),id:t}).then(()=>{I.a.processUpdateMessage({_:"updateShort",update:{_:"updateChannelReadMessagesContents",channel_id:s,messages:t}})})}else u.a.invokeApi("messages.readMessageContents",{id:t}).then(e=>{I.a.processUpdateMessage({_:"updateShort",update:{_:"updateReadMessagesContents",messages:t,pts:e.pts,pts_count:e.pts_count}})})}getHistoryStorage(e,t){var s,i;return t?(this.threadsStorage[e]||(this.threadsStorage[e]={}),null!==(s=this.threadsStorage[e][t])&&void 0!==s?s:this.threadsStorage[e][t]={count:null,history:new y.b}):null!==(i=this.historiesStorage[e])&&void 0!==i?i:this.historiesStorage[e]={count:null,history:new y.b}}setDialogToStateIfMessageIsTop(e){const t=this.getDialogOnly(e.peerId);t&&t.top_message===e.mid&&this.dialogsStorage.setDialogToState(t)}updateMessageRepliesIfNeeded(e){try{const t=this.getThreadKey(e);if(t){const e=this.threadsToReplies[t];if(e){const[t,s]=e.split("_").map(e=>+e);this.updateMessage(t,s,"replies_updated")}}}catch(t){this.log.error("incrementMessageReplies err",t,e)}}getThreadKey(e){let t="";if(e.peerId<0&&e.reply_to){const s=e.reply_to.reply_to_top_id||e.reply_to.reply_to_msg_id;t=e.peerId+"_"+s}return t}updateMessage(e,t,s){return this.wrapSingleMessage(e,t,!0).then(()=>{const i=this.getMessageByPeer(e,t);return s&&v.default.dispatchEvent(s,i),i})}checkPendingMessage(e){const t=this.pendingByMessageId[e.mid];let s;if(t){const i=this.pendingByRandomId[t];(s=this.finalizePendingMessage(t,e))&&v.default.dispatchEvent("history_update",{storage:i.storage,peerId:e.peerId,mid:e.mid}),delete this.pendingByMessageId[e.mid]}return s}mutePeer(e,t){const s={_:"inputPeerNotifySettings"};return void 0===t&&(t=!U.a.isPeerLocalMuted(e,!1)),s.mute_until=t?2147483647:0,U.a.updateNotifySettings({_:"inputNotifyPeer",peer:E.a.getInputPeerById(e)},s)}canWriteToPeer(e,t){if(e<0){const s=E.a.isChannel(e),i=s&&S.a.hasRights(-e,"send_messages",void 0,!!t);return!s||i}return A.a.canSendToUser(e)}finalizePendingMessage(e,t){const s=this.pendingByRandomId[e];if(s){const{peerId:i,tempId:a,threadId:n,storage:o}=s;[this.getHistoryStorage(i),n?this.getHistoryStorage(i,n):void 0].filter(Boolean).forEach(e=>{e.history.delete(a)});const r=this.getMessageFromStorage(o,a);return r.deleted||(delete r.pFlags.is_outgoing,delete r.pending,delete r.error,delete r.random_id,delete r.send,v.default.dispatchEvent("messages_pending")),delete this.pendingByRandomId[e],this.finalizePendingMessageCallbacks(o,a,t.mid),r}return!1}finalizePendingMessageCallbacks(e,t,s){const i=this.getMessageFromStorage(e,s),a=this.tempFinalizeCallbacks[t];if(void 0!==a){for(const e in a){const{deferred:t,callback:s}=a[e];s(i).then(t.resolve,t.reject)}delete this.tempFinalizeCallbacks[t]}if(i.media)if(i.media.photo){const e=D.a.getPhoto(""+t);if(e){const t=i.media.photo,s=t.sizes[t.sizes.length-1],a=P.a.getCacheContext(t,s.type),n=P.a.getCacheContext(e,"full");Object.assign(a,n);const o=t.sizes[t.sizes.length-1],r=D.a.getPhotoDownloadOptions(t,o),d=Object(T.a)(r.location);P.a.fakeDownload(d,n.url)}}else if(i.media.document){const e=C.a.getDoc(""+t);if(e&&e.type&&"sticker"!==e.type){const t=i.media.document,s=P.a.getCacheContext(t),a=P.a.getCacheContext(e);Object.assign(s,a);const n=C.a.getInputFileName(t);P.a.fakeDownload(n,a.url)}}else i.media.poll&&(delete k.a.polls[t],delete k.a.results[t]);const n=this.getMessageFromStorage(e,t);delete e[t],v.default.dispatchEvent("message_sent",{storage:e,tempId:t,tempMessage:n,mid:s})}incrementMaxSeenId(e){if(!e||this.maxSeenId&&!(e>this.maxSeenId))return!1;this.maxSeenId=e,j.default.pushToState("maxSeenMsgId",e),u.a.invokeApi("messages.receivedMessages",{max_id:this.getServerMessageId(e)})}notifyAboutMessage(e,t={}){const s=this.getMessagePeer(e),i={},a=E.a.getPeerString(s);let n;n=t.peerTypeNotifySettings.show_previews?"message"===e._&&e.fwd_from&&t.fwdCount?h.default.format("Notifications.Forwarded",!0,[t.fwdCount]):this.wrapMessageForReply(e,void 0,void 0,!0):h.default.format("Notifications.New",!0),i.title=E.a.getPeerTitle(s,!0),s<0&&e.fromId!==e.peerId&&(i.title=E.a.getPeerTitle(e.fromId,!0)+" @ "+i.title),i.title=f.a.wrapPlainText(i.title),i.onclick=()=>{v.default.dispatchEvent("history_focus",{peerId:s,mid:e.mid})},i.message=n,i.key="msg"+e.mid,i.tag=a,i.silent=!0;const o=E.a.getPeerPhoto(s);o?z.a.loadAvatar(s,o,"photo_small").loadPromise.then(t=>{e.pFlags.unread&&(i.image=t,U.a.notify(i))}):U.a.notify(i)}getScheduledMessagesStorage(e){var t;return null!==(t=this.scheduledMessagesStorage[e])&&void 0!==t?t:this.scheduledMessagesStorage[e]=this.createMessageStorage()}getScheduledMessages(e){if(!this.canWriteToPeer(e))return Promise.resolve([]);const t=this.getScheduledMessagesStorage(e);return Object.keys(t).length?Promise.resolve(Object.keys(t).map(e=>+e)):u.a.invokeApiSingle("messages.getScheduledHistory",{peer:E.a.getInputPeerById(e),hash:0}).then(t=>{if("messages.messagesNotModified"!==t._){A.a.saveApiUsers(t.users),S.a.saveApiChats(t.chats);const s=this.getScheduledMessagesStorage(e);return this.saveMessages(t.messages,{storage:s,isScheduled:!0}),Object.keys(s).map(e=>+e)}return[]})}sendScheduledMessages(e,t){return u.a.invokeApi("messages.sendScheduledMessages",{peer:E.a.getInputPeerById(e),id:t.map(e=>this.getServerMessageId(e))}).then(e=>{I.a.processUpdateMessage(e)})}deleteScheduledMessages(e,t){return u.a.invokeApi("messages.deleteScheduledMessages",{peer:E.a.getInputPeerById(e),id:t.map(e=>this.getServerMessageId(e))}).then(e=>{I.a.processUpdateMessage(e)})}getMessageWithReplies(e){if(e.peerId===H.a||(e=this.filterMessages(e,e=>!!e.replies)[0])&&e.replies&&e.replies.pFlags.comments&&777!==e.replies.channel_id)return e}isFetchIntervalNeeded(e){return e<0&&!S.a.isInChat(e)}getNewHistory(e,t){var s;return q(this,void 0,void 0,(function*(){if(!this.isFetchIntervalNeeded(e))return;const i=this.getHistoryStorage(e,t),a=i.history.slice;if(!a.isEnd(y.a.Bottom))return;delete i.maxId,a.unsetEnd(y.a.Bottom);let n=this.getHistory(e,null!==(s=a[0])&&void 0!==s?s:1,0,50,t);n instanceof Promise&&(n=yield n);for(let t=0,s=n.history.length;t<s;++t)this.handleNewMessage(e,n.history[t]);return i}))}getHistory(e,t=0,s,i,a){const n=this.getHistoryStorage(e,a);let o=0;i&&(o=-i,s+=i);const r=n.history.sliceMe(t,o,s);return!r||r.slice.length!==s&&(r.fulfilled&y.a.Both)!==y.a.Both?this.fillHistoryStorage(e,t,s,o,n,a).then(()=>{const e=n.history.sliceMe(t,o,s);return{count:n.count,history:(null==e?void 0:e.slice)||n.history.constructSlice(),offsetIdOffset:(null==e?void 0:e.offsetIdOffset)||n.count}}):{count:n.count,history:r.slice,offsetIdOffset:r.offsetIdOffset}}fillHistoryStorage(e,t,s,i,a,n){return this.requestHistory(e,t,s,i,void 0,n).then(n=>{const{offset_id_offset:o,count:r,messages:d}=n;a.count=r||d.length;const l=o||0,c=i<0?s+i:s,h=l>=a.count-c||a.count<c,p=!l||i<0&&l+i<=0,u=d.map(t=>(this.mergeReplyKeyboard(a,t)&&v.default.dispatchEvent("history_reply_markup",{peerId:e}),t.mid));if(t&&!u.includes(t)&&l<a.count){let e=0;for(const s=u.length;e<s&&!(t>u[e]);++e);u.splice(e,0,t)}const g=a.history.insertSlice(u)||a.history.slice;h&&g.setEnd(y.a.Top),p&&(g.setEnd(y.a.Bottom),a.maxId=g[0])})}requestHistory(e,t,s=0,i=0,a=0,n=0){const o={peer:E.a.getInputPeerById(e),offset_id:this.getServerMessageId(t)||0,offset_date:a,add_offset:i,limit:s,max_id:0,min_id:0,hash:0};n&&(o.msg_id=this.getServerMessageId(n)||0);return u.a.invokeApiSingle(n?"messages.getReplies":"messages.getHistory",o,{noErrorBox:!0}).then(o=>{O.b&&this.log("requestHistory result:",e,o,t,s,i),A.a.saveApiUsers(o.users),S.a.saveApiChats(o.chats),this.saveMessages(o.messages),E.a.isChannel(e)&&I.a.addChannelState(-e,o.pts);let r=o.messages.length,d=o.count;r&&o.messages[r-1].deleted&&(o.messages.splice(r-1,1),r--,d--);const l=this.getHistoryStorage(e,n),c=o.messages[r-1];if(r&&c.grouped_id){const t=l.history.findSlice(c.mid);if(t&&t.slice.length+o.messages.length<d)return this.requestHistory(e,c.mid,10,0,a,n).then(e=>o)}return o},t=>{switch(t.type){case"CHANNEL_PRIVATE":let t=S.a.getChat(-e);t={_:"channelForbidden",access_hash:t.access_hash,title:t.title},I.a.processUpdateMessage({_:"updates",updates:[{_:"updateChannel",channel_id:-e}],chats:[t],users:[]})}throw t})}fetchSingleMessages(){return this.fetchSingleMessagesPromise?this.fetchSingleMessagesPromise:this.fetchSingleMessagesPromise=new Promise(e=>{setTimeout(()=>{let t=[];for(const e in this.needSingleMessages){const s=this.needSingleMessages[e];delete this.needSingleMessages[e];const i=s.map(e=>({_:"inputMessageID",id:this.getServerMessageId(e)}));let a;a=+e<0&&E.a.isChannel(+e)?u.a.invokeApiSingle("channels.getMessages",{channel:S.a.getChannelInput(-+e),id:i}):u.a.invokeApiSingle("messages.getMessages",{id:i}),t.push(a.then(t=>{"messages.messagesNotModified"!==t._&&(A.a.saveApiUsers(t.users),S.a.saveApiChats(t.chats),this.saveMessages(t.messages)),v.default.dispatchEvent("messages_downloaded",{peerId:+e,mids:s})}))}Promise.all(t).finally(()=>{this.fetchSingleMessagesPromise=null,Object.keys(this.needSingleMessages).length&&this.fetchSingleMessages(),e()})},0)})}wrapSingleMessage(e,t,s=!1){var i;return this.getMessageByPeer(e,t).deleted||s?this.needSingleMessages[e]&&-1!==this.needSingleMessages[e].indexOf(t)?this.fetchSingleMessagesPromise?this.fetchSingleMessagesPromise:void 0:((null!==(i=this.needSingleMessages[e])&&void 0!==i?i:this.needSingleMessages[e]=[]).push(t),this.fetchSingleMessages()):(v.default.dispatchEvent("messages_downloaded",{peerId:e,mids:[t]}),Promise.resolve())}setTyping(e,t){let s=this.typings[e];return v.default.myId&&e&&this.canWriteToPeer(e)&&e!==v.default.myId&&(null==s?void 0:s.type)!==t._?((null==s?void 0:s.timeout)&&clearTimeout(s.timeout),s=this.typings[e]={type:t._},u.a.invokeApi("messages.setTyping",{peer:E.a.getInputPeerById(e),action:t}).finally(()=>{s===this.typings[e]&&(s.timeout=window.setTimeout(()=>{delete this.typings[e]},6e3))})):Promise.resolve(!1)}handleDeletedMessages(e,t,s){const i={count:0,unread:0,msgs:{}};for(const a of s){const s=this.getMessageFromStorage(t,a);if(s.deleted)continue;if(s.media){const t=s.media.webpage||s.media,i=t.photo||t.document;(null==i?void 0:i.file_reference)&&g.a.deleteContext(i.file_reference,{type:"message",peerId:e,messageId:a}),s.media.webpage&&F.a.deleteWebPageFromPending(s.media.webpage,a)}if(this.updateMessageRepliesIfNeeded(s),s.pFlags.out||s.pFlags.is_outgoing||!s.pFlags.unread||(i.unread++,U.a.cancel("msg"+a)),i.count++,i.msgs[a]=!0,s.deleted=!0,"messageService"!==s._&&s.grouped_id){const e=this.groupedMessagesStorage[s.grouped_id];e&&(delete e[a],i.albums||(i.albums={}),(i.albums[s.grouped_id]||(i.albums[s.grouped_id]=new Set)).add(a),Object.keys(e).length||(delete i.albums,delete this.groupedMessagesStorage[s.grouped_id]))}delete t[a];const n=this.newMessagesToHandle[e];n&&n.has(a)&&n.delete(a)}if(i.albums)for(const t in i.albums)v.default.dispatchEvent("album_edit",{peerId:e,groupId:t,deletedMids:[...i.albums[t]]});return i}handleEditedMessage(e,t){var s;(null===(s=e.media)||void 0===s?void 0:s.webpage)&&F.a.deleteWebPageFromPending(e.media.webpage,e.mid)}}V.MESSAGE_ID_INCREMENT=65536,V.MESSAGE_ID_OFFSET=4294967295;const Y=new V;O.a.appMessagesManager=Y;t.a=Y},,,,function(e,t,s){"use strict";function i(){return new Worker(s.p+"rlottie.worker.86bed2789739b353d39d.bundle.worker.js")}s.d(t,"a",(function(){return m}));var a=s(45),n=s(9),o=s(38),r=s(23),d=s(46),l=s(17),c=s(0),h=s(24),p=s(13),u=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};let g=e=>Math.round(255*Math.min(Math.max(e,0),1));class m extends o.a{constructor({el:e,worker:t,options:s}){super(!0),this.reqId=0,this.width=0,this.height=0,this.paused=!0,this.direction=1,this.speed=1,this.autoplay=!0,this.loop=!0,this.group="",this.frames={},this.cachingDelta=0,this.reqId=++m.reqId,this.el=e,this.worker=t;for(let e in s)this.hasOwnProperty(e)&&(this[e]=s[e]);let i;this._loop=this.loop,this._autoplay=this.autoplay,void 0!==s.skipRatio?i=s.skipRatio:(c.isAndroid||c.isAppleMobile||c.isApple&&!c.isSafari)&&this.width<100&&this.height<100&&(i=.5),this.skipDelta=void 0!==i?1/i|0:1;const a=Object(d.a)(window.devicePixelRatio,1,2);a>1&&(s.needUpscale?(this.width=Math.round(this.width*a),this.height=Math.round(this.height*a)):a>1&&(this.width>100&&this.height>100?c.isApple||!r.b.isMobile?(this.width=Math.round(this.width*a),this.height=Math.round(this.height*a)):a>2.5&&(this.width=Math.round(this.width*(a-1.5)),this.height=Math.round(this.height*(a-1.5))):(this.width=Math.round(this.width*Math.max(1.5,a-1.5)),this.height=Math.round(this.height*Math.max(1.5,a-1.5))))),s.noCache||(c.isApple&&this.width>100&&this.height>100?this.cachingDelta=2:this.width<100&&this.height<100?this.cachingDelta=1/0:this.cachingDelta=4),this.canvas=document.createElement("canvas"),this.canvas.classList.add("rlottie"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.clamped=new Uint8ClampedArray(this.width*this.height*4),this.imageData=new ImageData(this.width,this.height)}clearCache(){this.frames={}}sendQuery(e,...t){this.worker.sendQuery(e,this.reqId,...t)}loadFromData(e){this.sendQuery("loadFromData",e,this.width,this.height)}play(){this.paused&&(this.paused=!1,this.setMainLoop())}pause(e=!0){this.paused||(this.paused=!0,e&&clearTimeout(this.rafId))}stop(e=!0){this.pause(),this.curFrame=1===this.direction?0:this.frameCount,e&&this.requestFrame(this.curFrame)}restart(){this.stop(!1),this.play()}setSpeed(e){this.speed=e,this.paused||this.setMainLoop()}setDirection(e){this.direction=e,this.paused||this.setMainLoop()}remove(){X.onDestroy(this.reqId),this.pause(),this.sendQuery("destroy")}renderFrame2(e,t){try{this.imageData.data.set(e),this.context.putImageData(this.imageData,0,0)}catch(e){return console.error("RLottiePlayer renderFrame error:",e,this.width,this.height),this.autoplay=!1,void this.pause()}this.dispatchEvent("enterFrame",t)}renderFrame(e,t){if(this.cachingDelta&&(t%this.cachingDelta||!t)&&!this.frames[t]&&(this.frames[t]=new Uint8ClampedArray(e)),this.frInterval){const s=Date.now()-this.frThen;if(s<0)return this.rafId&&clearTimeout(this.rafId),this.rafId=window.setTimeout(()=>{this.renderFrame2(e,t)},this.frInterval>-s?-s%this.frInterval:this.frInterval)}this.renderFrame2(e,t)}requestFrame(e){this.frames[e]?this.renderFrame(this.frames[e],e):c.isSafari?this.sendQuery("renderFrame",e):(this.clamped.length||(this.clamped=new Uint8ClampedArray(this.width*this.height*4)),this.sendQuery("renderFrame",e,this.clamped))}mainLoopForwards(){const e=this.curFrame+this.skipDelta>=this.frameCount?this.curFrame=0:this.curFrame+=this.skipDelta;return this.requestFrame(e),!(e+this.skipDelta>=this.frameCount&&!this.loop)||(this.pause(!1),!1)}mainLoopBackwards(){const e=this.curFrame-this.skipDelta<0?this.curFrame=this.frameCount-1:this.curFrame-=this.skipDelta;return this.requestFrame(e),!(e-this.skipDelta<0&&!this.loop)||(this.pause(!1),!1)}setMainLoop(){clearTimeout(this.rafId),this.frInterval=1e3/this.fps/this.speed*this.skipDelta,this.frThen=Date.now()-this.frInterval;const e=(1===this.direction?this.mainLoopForwards:this.mainLoopBackwards).bind(this);this.currentMethod=e,this.frameListener&&this.listenerResults.hasOwnProperty("enterFrame")&&this.frameListener()}onLoad(e,t){return u(this,void 0,void 0,(function*(){if(this.curFrame=1===this.direction?0:e-1,this.frameCount=e,this.fps=t,this.fps<60&&1!==this.skipDelta){const e=60/t;this.skipDelta=this.skipDelta/e|0}this.frInterval=1e3/this.fps/this.speed*this.skipDelta,this.frThen=Date.now()-this.frInterval,this.requestFrame(0),this.dispatchEvent("ready"),this.addEventListener("enterFrame",()=>{this.dispatchEvent("firstFrame"),this.el.appendChild(this.canvas),this.frameListener=()=>{if(this.paused)return;const e=Date.now();this.frThen=e+this.frInterval;this.currentMethod()||this.loop||!this.autoplay||(this.autoplay=!1)},this.addEventListener("enterFrame",this.frameListener)},!0)}))}}m.reqId=0;class f extends o.a{constructor(e,t=(()=>{}),s){super(),this.worker=e,this.defaultListener=t,s&&(this.worker.onerror=s),this.worker.onmessage=e=>{e.data instanceof Object&&e.data.hasOwnProperty("queryMethodListener")&&e.data.hasOwnProperty("queryMethodArguments")?this.dispatchEvent(e.data.queryMethodListener,...e.data.queryMethodArguments):this.defaultListener.call(this,e.data)}}postMessage(e){this.worker.postMessage(e)}terminate(){this.worker.terminate()}sendQuery(e,...t){if(c.isSafari)this.worker.postMessage({queryMethod:e,queryMethodArguments:t});else{const s=[];t.forEach(e=>{e instanceof ArrayBuffer&&s.push(e),e.buffer&&e.buffer instanceof ArrayBuffer&&s.push(e.buffer)}),this.worker.postMessage({queryMethod:e,queryMethodArguments:t},s)}}}class v{constructor(){this.isWebAssemblySupported="undefined"!=typeof WebAssembly,this.loadPromise=this.isWebAssemblySupported?void 0:Promise.reject(),this.loaded=!1,this.workersLimit=4,this.players={},this.workers=[],this.curWorkerNum=0,this.log=Object(h.b)("LOTTIE",h.a.Error),this.onPlayerLoaded=(e,t,s)=>{const i=this.players[e];i?(this.log.debug("onPlayerLoaded"),i.onLoad(t,s)):this.log.warn("onPlayerLoaded on destroyed player:",e,t)},this.onFrame=(e,t,s)=>{const i=this.players[e];i?(i.clamped=s,i.renderFrame(s,t)):this.log.warn("onFrame on destroyed player:",e,t)},this.onPlayerError=(e,t)=>{const s=this.players[e];if(s){a.a.getAnimations(s.el).forEach(e=>{a.a.checkAnimation(e,!0,!0)})}}}getAnimation(e){for(const t in this.players)if(this.players[t].el===e)return this.players[t];return null}setLoop(e){for(const t in this.players){const s=this.players[t];s.loop=e,s.autoplay=s._autoplay}}loadLottieWorkers(){return this.loadPromise?this.loadPromise:this.loadPromise=new Promise((e,t)=>{let s=this.workersLimit;for(let t=0;t<this.workersLimit;++t){const a=this.workers[t]=new f(new i);a.addEventListener("ready",()=>{this.log("worker #"+t+" ready"),a.addEventListener("frame",this.onFrame),a.addEventListener("loaded",this.onPlayerLoaded),a.addEventListener("error",this.onPlayerError),--s,s||(this.log("workers ready"),e(),this.loaded=!0)})}})}applyReplacements(e,t){const s=v.COLORREPLACEMENTS[Math.max(t-1,0)],i=e=>{switch(e.ty){case"st":case"fl":(e=>{const t=e.c.k,i=g(t[2])|g(t[1])<<8|g(t[0])<<16,a=s.find(e=>e[0]===i);a&&(t[0]=(a[1]>>16&255)/255,t[1]=(a[1]>>8&255)/255,t[2]=(255&a[1])/255)})(e)}e.hasOwnProperty("it")&&a(e.it)},a=e=>{for(const t of e)i(t)};try{for(const t of e.layers)if(t.shapes)for(const e of t.shapes)e.it?a(e.it):i(e)}catch(s){this.log.warn("cant apply replacements",s,e,t)}}loadAnimationFromURL(e,t){return this.isWebAssemblySupported?(this.loaded||this.loadLottieWorkers(),fetch(t).then(e=>e.arrayBuffer()).then(e=>p.a.gzipUncompress(e,!0)).then(t=>this.loadAnimationWorker(Object.assign(e,{animationData:t,needUpscale:!0})))):this.loadPromise}waitForFirstFrame(e){return Promise.race([new Promise(t=>{e.addEventListener("firstFrame",t,!0)}),Object(l.d)(2500)])}loadAnimationWorker(e,t="",s=-1){return u(this,void 0,void 0,(function*(){if(!this.isWebAssemblySupported)return this.loadPromise;if(s>=1&&s<=5){const t=JSON.parse(e.animationData);this.applyReplacements(t,s),e.animationData=JSON.stringify(t)}if(this.loaded||(yield this.loadLottieWorkers()),e.width&&e.height||(e.width=parseInt(e.container.style.width),e.height=parseInt(e.container.style.height)),!e.width||!e.height)throw new Error("No size for sticker!");e.group=t;const i=this.initPlayer(e.container,e);return a.a.addAnimation(i,t),i}))}onDestroy(e){delete this.players[e]}destroyWorkers(){this.workers.forEach((e,t)=>{e.terminate(),this.log("worker #"+t+" terminated")}),this.log("workers destroyed"),this.workers.length=0}initPlayer(e,t){const s=new m({el:e,worker:this.workers[this.curWorkerNum++],options:t});return this.players[s.reqId]=s,this.curWorkerNum>=this.workers.length&&(this.curWorkerNum=0),s.loadFromData(t.animationData),s}}v.COLORREPLACEMENTS=[[[16219713,13335381],[16757049,16168585],[16765248,16764327],[16768889,16768965]],[[16219713,10771e3],[16757049,14653547],[16765248,15577475],[16768889,16040864]],[[16219713,7354903],[16757049,11233085],[16765248,12812110],[16768889,14194279]],[[16219713,4858889],[16757049,8207886],[16765248,9852201],[16768889,11100983]],[[16219713,2101002],[16757049,4270372],[16765248,5848375],[16768889,6505791]]];const X=new v;n.a.lottieLoader=X;t.b=X},,function(e,t,s){"use strict";var i=s(63),a=s(76),n=s(15),o=s(0),r=s(13),d=s(74),l=s(37),c=s(20),h=s(92),p=s(9),u=s(62),g=s(72),m=s(23);class f{constructor(){this.photos={},this.windowW=0,this.windowH=0;const e="visualViewport"in window?window.visualViewport:window,t=()=>{this.windowW=e.width||e.innerWidth,this.windowH=e.height||e.innerHeight};e.addEventListener("resize",t),t()}savePhoto(e,t){var s;if("photoEmpty"===e._)return;const i=this.photos[e.id];if(e.file_reference&&(Object(n.h)("file_reference",i,e),d.a.saveContext(e.file_reference,t)),null===(s=e.sizes)||void 0===s?void 0:s.length){const t=e.sizes[e.sizes.length-1];"photoSizeProgressive"===t._&&(t.size=t.sizes[t.sizes.length-1])}return i?Object.assign(i,e):this.photos[e.id]=e}choosePhotoSize(e,t=0,s=0,i=!1){window.devicePixelRatio>1&&(t*=2,s*=2);let a={_:"photoSizeEmpty",type:""};const n=e.sizes||e.thumbs;if(null==n?void 0:n.length){for(let e=0,i=n.length;e<i;++e){const i=n[e];if(!("w"in i)&&!("h"in i))continue;a=i;const o=Object(g.a)(i.w,i.h,t,s);if(o.width>=t||o.height>=s)break}i&&"photoSizeEmpty"===a._&&"photoStrippedSize"===n[0]._&&(a=n[0])}return a}getUserPhotos(e,t="0",s=20){const i=c.a.getUserInput(e);return r.a.invokeApiCacheable("photos.getUserPhotos",{user_id:i,offset:0,limit:s,max_id:t},{cacheSeconds:60}).then(t=>{c.a.saveApiUsers(t.users);const s=t.photos.map((s,i)=>(t.photos[i]=this.savePhoto(s,{type:"profilePhoto",peerId:e}),s.id));return{count:t.count||t.photos.length,photos:s}})}getPreviewURLFromBytes(e,t=!1){let s,i;t?s=e instanceof Uint8Array?e:new Uint8Array(e):(s=new Uint8Array(f.jpegHeader.concat(Array.from(e.slice(3)),f.jpegTail)),s[164]=e[1],s[166]=e[2]),i=t?o.isSafari?"image/png":"image/webp":"image/jpeg";const a=new Blob([s],{type:i});return URL.createObjectURL(a)}getPathFromPhotoPathSize(e){const t=e.bytes;let s="M";for(let e=0,i=t.length;e<i;++e){const i=t[e];i>=192?s+="AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,"[i-128-64]:(i>=128?s+=",":i>=64&&(s+="-"),s+=""+(63&i))}return s+="z",s}getPreviewURLFromThumb(e,t,s=!1){const i=l.a.getCacheContext(e,t.type);return i.url||(i.url=this.getPreviewURLFromBytes(t.bytes,s))}getImageFromStrippedThumb(e,t,s){const i=this.getPreviewURLFromThumb(e,t,!1),a=new Image;a.classList.add("thumbnail");const n=(s?Object(h.a)(i):Promise.resolve(i)).then(e=>new Promise(t=>{Object(u.a)(a,e,t)}));return{image:a,loadPromise:n}}setAttachmentSize(e,t,s,i,a=!0,n){const o=this.choosePhotoSize(e,s,i);let r;r="document"===e._?Object(m.c)(e.w||512,e.h||512):Object(m.c)("w"in o?o.w:100,"h"in o?o.h:100);let d=Object(m.c)(s,i);d=r=r.aspect(d,a);let l=!0;return("photo"===e._||["video","gif"].includes(e.type))&&(d.width<200&&d.height<200&&(d=r=r.aspectCovered(Object(m.c)(200,200))),n&&(n.message||n.reply_to_mid||n.media.webpage||n.replies&&n.replies.pFlags.comments&&777!==n.replies.channel_id)&&d.width<320&&(d=Object(m.c)(320,d.height),l=!1),l&&d.width<120&&(d=Object(m.c)(120,d.height),l=!1)),t.style.width=d.width+"px",t.style.height=d.height+"px",{photoSize:o,size:r,isFit:l}}getStrippedThumbIfNeeded(e,t,s,i=!1){if(!t.downloaded||["video","gif"].includes(e.type)||i){if("document"===e._&&t.downloaded&&!i)return null;const a=e.sizes||e.thumbs,n=(null==a?void 0:a.length)?a.find(e=>"photoStrippedSize"===e._):null;if(n&&"bytes"in n)return this.getImageFromStrippedThumb(e,n,s)}return null}getPhotoDownloadOptions(e,t,s,i){const a="document"===e._;if(!t||"photoSizeEmpty"===t._)throw new Error("photoSizeEmpty!");const n=("photoSize"===t._||"photoSizeProgressive"===t._)&&e.access_hash&&e.file_reference,o={_:a?"inputDocumentFileLocation":"inputPhotoFileLocation",id:e.id,access_hash:e.access_hash,file_reference:e.file_reference,thumb_size:t.type};return{dcId:e.dc_id,location:o,size:n?t.size:void 0,queueId:s,onlyCache:i}}preloadPhoto(e,t,s,i){const n=this.getPhoto(e);if(!n||"photoEmpty"===n._)throw new Error("preloadPhoto photoEmpty!");if(!t){const e=this.windowW,s=this.windowH;t=this.choosePhotoSize(n,e,s)}const o=l.a.getCacheContext(n,t.type);if(o.downloaded>=("size"in t?t.size:0)&&o.url)return Promise.resolve();const r=this.getPhotoDownloadOptions(n,t,s,i),d=Object(a.a)(r.location);let c=l.a.getDownload(d);return c||(c=l.a.download(r),c.then(e=>{if(!o.downloaded||o.downloaded<e.size){const t=URL.createObjectURL(e);o.downloaded=e.size,o.url=t}return e}).catch(()=>{}),c)}getPhoto(e){return Object(n.f)(e)?e:this.photos[e]}getInput(e){return{_:"inputMediaPhoto",id:{_:"inputPhoto",id:e.id,access_hash:e.access_hash,file_reference:e.file_reference},ttl_seconds:0}}savePhotoFile(e,t){const s=this.choosePhotoSize(e,65535,65535);if("photoSize"!==s._&&"photoSizeProgressive"!==s._)return;const i=this.getPhotoDownloadOptions(e,s,t);i.fileName="photo"+e.id+".jpg",l.a.downloadToDisc(i,i.fileName)}}f.jpegHeader=Object(i.c)("ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00"),f.jpegTail=Object(i.c)("ffd9");const v=new f;p.a&&(p.a.appPhotosManager=v),t.a=v},function(e,t,s){"use strict";var i=s(9),a=s(0),n=s(24),o=s(17),r=s(2),d=s(12);const l=new class{constructor(){this.navigations=[],this.id=Date.now(),this.manual=!1,this.log=Object(n.b)("NC"),this.debug=!0,this.currentHash=window.location.hash;let e=!1;if(window.addEventListener("popstate",t=>{if(this.debug&&this.log("popstate",t,e),window.location.hash!==this.currentHash)return this.onHashChange&&this.onHashChange(),void this.replaceState();this.currentHash=window.location.hash;if(t.state!==this.id)return void this.pushState();const s=this.navigations.pop();s?(this.manual=!e,this.handleItem(s)):this.pushState()}),window.addEventListener("keydown",e=>{const t=this.navigations[this.navigations.length-1];t&&("Escape"!==e.key||t.onEscape&&!t.onEscape()||(Object(d.a)(e),this.back(t.type)))},{capture:!0,passive:!1}),a.isMobileSafari){const t={passive:!0};window.addEventListener("touchstart",s=>{if(s.touches.length>1)return;this.debug&&this.log("touchstart");const i=()=>{window.removeEventListener("touchend",r),window.removeEventListener("touchmove",n)};let a=!1;const n=e=>{this.debug&&this.log("touchmove"),e.touches.length>1?i():a=!0},r=t=>{this.debug&&this.log("touchend"),t.touches.length>1||!a||(e=!0,Object(o.b)().then(()=>{e=!1})),i()};window.addEventListener("touchend",r,t),window.addEventListener("touchmove",n,t)},t)}history.scrollRestoration="manual",this.pushState()}handleItem(e){const t=e.onPop(!!this.manual&&void 0);this.debug&&this.log("popstate, navigation:",e,this.navigations),!1===t?this.pushItem(e):e.noBlurOnPop||Object(r.a)(),this.manual=!1}findItemByType(e){for(let t=this.navigations.length-1;t>=0;--t){const s=this.navigations[t];if(s.type===e)return{item:s,index:t}}}back(e){if(e){const t=this.findItemByType(e);if(t)return this.manual=!0,this.navigations.splice(t.index,1),void this.handleItem(t.item)}history.back()}pushItem(e){this.navigations.push(e),this.debug&&this.log("pushstate",e,this.navigations),e.noHistory||this.pushState()}pushState(){this.manual=!1,history.pushState(this.id,"")}replaceState(){history.replaceState(this.id,"",location.origin+location.pathname)}removeItem(e){this.navigations.findAndSplice(t=>t===e)}removeByType(e,t=!1){for(let s=this.navigations.length-1;s>=0;--s){if(this.navigations[s].type===e&&(this.navigations.splice(s,1),t))break}}};i.a.appNavigationController=l,t.a=l},function(e,t,s){"use strict";var i=s(10),a=s(13),n=s(26),o=s(74),r=s(76),d=s(77),l=s(9);const c=new class{constructor(){this.cacheStorage=new d.a("cachedFiles"),this.downloads={},this.progress={},this.progressCallbacks={},this.uploadId=0,this.thumbsCache={photo:{},document:{}},i.default.addEventListener("download_progress",e=>{const t=e;this.progress[t.fileName]=t;const s=this.progressCallbacks[t.fileName];s&&s.forEach(e=>e(t));const i=this.downloads[t.fileName];i&&i.notifyAll(t)})}getNewDeferred(e){const t=Object(n.a)();return t.cancel=()=>{const s=new Error("Download canceled");s.name="AbortError",a.a.cancelDownload(e),t.reject(s),t.cancel=()=>{}},t.finally(()=>{delete this.progress[e],delete this.progressCallbacks[e]}),t.catch(()=>{this.clearDownload(e)}),this.downloads[e]=t}clearDownload(e){delete this.downloads[e]}fakeDownload(e,t){const s=this.getNewDeferred(e);return"string"==typeof t?fetch(t).then(e=>e.blob()).then(e=>s.resolve(e)):s.resolve(t),s}download(e){const t=Object(r.a)(e.location,{fileName:e.fileName});if(this.downloads.hasOwnProperty(t))return this.downloads[t];const s=this.getNewDeferred(t),i=t=>{var i;switch(t.type){case"FILE_REFERENCE_EXPIRED":{const t=null===(i=null==e?void 0:e.location)||void 0===i?void 0:i.file_reference;if(t){o.a.refreshReference(t).then(n);break}console.warn("FILE_REFERENCE_EXPIRED: no context for bytes:",t)}default:s.reject(t)}},n=()=>{if(!a.a.worker||e.onlyCache){const n=this.cacheStorage.getFile(t).then(t=>{if(t.size<e.size)throw"wrong size";s.resolve(t)});return e.onlyCache?n.catch(i):n.catch(()=>a.a.downloadFile(e).then(s.resolve,i))}return a.a.downloadFile(e).then(s.resolve,i)};return n(),s}upload(e,t){if(!t){const s=null==e?void 0:e.type;if(s){const e=this.uploadId+++"."+s.split("/")[1];t=["image/jpeg","image/png","image/bmp"].indexOf(s)>=0?"photo"+e:0===s.indexOf("audio/")||["video/ogg"].indexOf(s)>=0?"audio"+e:0===s.indexOf("video/")?"video"+e:"document"+e}else t="upload-"+this.uploadId++}const s=this.getNewDeferred(t);return a.a.uploadFile({file:e,fileName:t}).then(s.resolve,s.reject),s.finally(()=>{this.clearDownload(t)}),s}getDownload(e){return this.downloads[e]}addProgressCallback(e,t){var s;const i=this.progress[e];(null!==(s=this.progressCallbacks[e])&&void 0!==s?s:this.progressCallbacks[e]=[]).push(t),i&&t(i)}createDownloadAnchor(e,t,s){const i=document.createElement("a");i.href=e,i.download=t,i.target="_blank",i.style.position="absolute",i.style.top="1px",i.style.left="1px",document.body.append(i);try{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(a)}catch(t){console.error("Download click error",t);try{i.click()}catch(t){window.open(e,"_blank")}}setTimeout(()=>{i.remove(),s&&s()},100)}downloadToDisc(e,t){const s=this.download(e);return s.then(e=>{const s=URL.createObjectURL(e);this.createDownloadAnchor(s,t,()=>{URL.revokeObjectURL(s)})}),s}getCacheContext(e,t="full"){var s,i;const a=null!==(s=this.thumbsCache[e._][e.id])&&void 0!==s?s:this.thumbsCache[e._][e.id]={};return null!==(i=a[t])&&void 0!==i?i:a[t]={downloaded:0,url:""}}};l.a&&(l.a.appDownloadManager=c),t.a=c},,function(e,t,s){"use strict";s.d(t,"b",(function(){return h})),s.d(t,"d",(function(){return u})),s.d(t,"c",(function(){return g}));var i=s(26),a=s(17),n=s(10),o=s(9);let r=!1,d=Object(i.a)(),l=0;d.resolve();const c=console.log.bind(console.log,"[HEAVY-ANIMATION]:");function h(e,t){r||(d=Object(i.a)(),n.default.dispatchEvent("event-heavy-animation-start"),r=!0,o.b&&c("start")),++l,o.b&&c("attach promise, length:",l,t);const s=[void 0!==t?Object(a.d)(t):void 0,e.finally(()=>{})].filter(Boolean),h=performance.now(),u=d;return Promise.race(s).then(()=>{d!==u||d.isFulfilled||(--l,o.b&&c("promise end, length:",l,performance.now()-h),l<=0&&p())}),d}function p(){d.isFulfilled||(r=!1,l=0,n.default.dispatchEvent("event-heavy-animation-end"),d.resolve(),o.b&&c("end"))}function u(){p()}function g(){return d}t.a=function(e,t,s){r&&e();const i=s?s.add.bind(s,n.default):n.default.addEventListener.bind(n.default),a=s?s.removeManual.bind(s,n.default):n.default.removeEventListener.bind(n.default);return i("event-heavy-animation-start",e),i("event-heavy-animation-end",t),()=>{a("event-heavy-animation-end",t),a("event-heavy-animation-start",e)}}},function(e,t,s){"use strict";function i(e){return null==e?void 0:e.isConnected}s.d(t,"a",(function(){return i}))},,function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s(9),a=s(30),n=s(10),o=s(11),r=s(25),d=s(20);const l=new WeakMap;i.a.peerTitleWeakMap=l,n.default.addEventListener("peer_title_edit",e=>{Array.from(document.querySelectorAll(`.peer-title[data-peer-id="${e}"]`)).forEach(e=>{const t=l.get(e);t&&t.update()})});class c{constructor(e){this.plainText=!1,this.onlyFirstName=!1,this.dialog=!1,this.element=document.createElement("span"),this.element.classList.add("peer-title"),this.element.setAttribute("dir","auto"),this.update(e),l.set(this.element,this)}update(e){if(e)for(let t in e)this.element.dataset[t]=e[t]?""+("boolean"==typeof e[t]?+e[t]:e[t]):"0",this[t]=e[t];this.peerId===n.default.myId&&this.dialog?Object(r.a)(this.element,Object(o.i18n)(this.onlyFirstName?"Saved":"SavedMessages")):this.peerId>0&&d.a.getUser(this.peerId).pFlags.deleted?Object(r.a)(this.element,Object(o.i18n)(this.onlyFirstName?"Deleted":"HiddenName")):this.element.innerHTML=a.a.getPeerTitle(this.peerId,this.plainText,this.onlyFirstName)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return l}));var i=s(39),a=s(17),n=s(84),o=s(10),r=s(40);var d;function l(e,t,s,n=0,l=1500,h,p,u="y"){if(o.default.settings.animationsEnabled||(h=d.Static),h===d.Static)return c(e,t,s,n,p=0,u);if("y"===u&&t!==e&&Object(r.a)(t)&&e.getBoundingClientRect){const s=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=s.top-i.top;void 0===h?a<-l?e.scrollTop+=a+l:a>l&&(e.scrollTop+=a-l):h===d.Up?e.scrollTop=a+e.scrollTop+l:h===d.Down&&(e.scrollTop=Math.max(0,a+e.scrollTop-l))}const g=new Promise(i=>{Object(a.c)(()=>{c(e,t,s,n,p,u).then(i)})});return"y"===u?Object(i.b)(g):g}function c(e,t,s,i=0,a,o="y"){if(!Object(r.a)(t))return Object(n.b)(e),Promise.resolve();const d="y"===o?"top":"left",l="y"===o?"bottom":"right",c="y"===o?"height":"width",h="y"===o?"scrollHeight":"scrollWidth",p="y"===o?"scrollTop":"scrollLeft",u=t.getBoundingClientRect(),g=e.getBoundingClientRect?e.getBoundingClientRect():document.body.getBoundingClientRect(),m=u[d]-g[d],f=t[h],v=g[c],X=e[p],_=e[h];let y;switch(s){case"start":y=m-i;break;case"end":y=u[l]+(f-u[c])-g[l];break;case"nearest":case"center":y=f<v?m+f/2-v/2:m-i}if(y<0){const e=-X;y=Math.max(y,e)}else if(y>0){const e=_-(X+v);y=Math.min(y,e)}const b=e[p]+y,M=null!=a?a:250+Math.abs(y)/1500*350,w=Date.now(),I=()=>{const t=M?Math.min((Date.now()-w)/M,1):1,s=y*(1-function(e){return 1-Math.pow(1-e,3.5)}(t));return e[p]=Math.round(b-s),t<1};return M&&y?Object(n.a)(I,e):(Object(n.b)(e),I(),Promise.resolve())}!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Static=2]="Static"}(d||(d={}))},,function(e,t,s){"use strict";var i=s(33),a=s(10),n=s(0),o=s(9),r=s(40);const d=new class{constructor(){this.visible=new Set,this.byGroups={},this.lockedGroups={},this.onlyOnePlayableGroup="",this.intersectionLockedGroups={},this.videosLocked=!1,this.observer=new IntersectionObserver(e=>{if(!a.default.idle.isIDLE)for(const t of e){const e=t.target;for(const s in this.byGroups){if(this.intersectionLockedGroups[s])continue;const a=this.byGroups[s].find(t=>t.el===e);if(a){t.isIntersecting?(this.visible.add(a),this.checkAnimation(a,!1)):(this.visible.delete(a),this.checkAnimation(a,!0),a.animation instanceof i.a&&a.animation.clearCache());break}}}}),a.default.addEventListener("audio_play",({doc:e})=>{"round"===e.type&&(this.videosLocked=!0,this.checkAnimations())}),a.default.addEventListener("audio_pause",()=>{this.videosLocked&&(this.videosLocked=!1,this.checkAnimations())})}getAnimations(e){const t=[];for(const s in this.byGroups)for(const i of this.byGroups[s])i.el===e&&t.push(i);return t}removeAnimation(e){const{el:t,animation:s}=e;s.remove(),s instanceof HTMLVideoElement&&n.isSafari&&setTimeout(()=>{s.src="",s.load()},1e3);for(const t in this.byGroups)this.byGroups[t].findAndSplice(t=>t===e);this.observer.unobserve(t),this.visible.delete(e)}addAnimation(e,t=""){var s;const n={el:e instanceof i.a?e.el:e,animation:e,group:t};e instanceof i.a&&!a.default.settings.stickers.loop&&e.loop&&(e.loop=a.default.settings.stickers.loop),(null!==(s=this.byGroups[t])&&void 0!==s?s:this.byGroups[t]=[]).push(n),this.observer.observe(n.el)}checkAnimations(e,t,s=!1){if(a.default.idle.isIDLE)return;const i=t?[t]:Object.keys(this.byGroups);if(!t||this.byGroups[t])for(const t of i){this.byGroups[t].forEach(t=>{this.checkAnimation(t,e,s)})}else this.byGroups[t]=[]}checkAnimation(e,t=!1,s=!1){const{el:i,animation:a,group:n}=e;s||!Object(r.a)(i)&&!this.lockedGroups[n]?this.removeAnimation(e):t||this.onlyOnePlayableGroup&&this.onlyOnePlayableGroup!==n||a instanceof HTMLVideoElement&&this.videosLocked?a.paused||a.pause():a.paused&&this.visible.has(e)&&a.autoplay&&(!this.onlyOnePlayableGroup||this.onlyOnePlayableGroup===n)&&a.play()}setOnlyOnePlayableGroup(e){this.onlyOnePlayableGroup=e}lockGroup(e){this.lockedGroups[e]=!0}unlockGroup(e){delete this.lockedGroups[e],this.checkAnimations(void 0,e)}refreshGroup(e){const t=this.byGroups[e];t&&t.length&&(t.forEach(e=>{this.observer.unobserve(e.el)}),window.requestAnimationFrame(()=>{t.forEach(e=>{this.observer.observe(e.el)})}))}lockIntersectionGroup(e){this.intersectionLockedGroups[e]=!0}unlockIntersectionGroup(e){delete this.intersectionLockedGroups[e],this.refreshGroup(e)}};o.a&&(o.a.animationIntersector=d),t.a=d},function(e,t,s){"use strict";function i(e,t=" "){const s=e.toString().split(".");return s[0]=s[0].replace(/\B(?=(\d{3})+(?!\d))/g,t),s.join(".")}function a(e,t=2){if(0===e)return"0 Bytes";const s=t<0?0:t,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(s))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]}function n(e,t=2){if(0===e)return"0";const s=t<0?0:t,i=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,i)).toFixed(s))+["","K","M","B","T"][i]}function o(e,t,s){return e<t?t:e>s?s:e}s.d(t,"d",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return n})),s.d(t,"a",(function(){return o}))},function(e,t,s){"use strict";function i(e){if(!e.parentNode)return-1;let t=0;for(;null!==(e=e.previousElementSibling);)++t;return t}s.d(t,"a",(function(){return i}))},,function(e,t,s){"use strict";var i=s(76),a=s(15),n=s(74),o=s(105),r=s(16),d=s(109),l=s(37),c=s(35),h=s(92),p=s(13),u=s(9),g=s(28),m=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const f=new class{constructor(){this.docs={},this.savingLottiePreview={},this.onServiceWorkerFail=()=>{for(const e in this.docs){const t=this.docs[e];if(t.supportsStreaming){delete t.supportsStreaming;delete l.a.getCacheContext(t).url}}},p.a.onServiceWorkerFail=this.onServiceWorkerFail}saveDoc(e,t){if("documentEmpty"===e._)return;const s=this.docs[e.id];if(e.file_reference&&(Object(a.h)("file_reference",s,e),n.a.saveContext(e.file_reference,t)),s)return e.thumbs&&(s.thumbs||(s.thumbs=e.thumbs)),s;if(this.docs[e.id]=e,e.attributes.forEach(t=>{switch(t._){case"documentAttributeFilename":e.file_name=r.a.wrapPlainText(t.file_name);break;case"documentAttributeAudio":e.duration=t.duration,e.audioTitle=t.title,e.audioPerformer=t.performer,e.type=t.pFlags.voice&&"audio/ogg"===e.mime_type?"voice":"audio";break;case"documentAttributeVideo":e.duration=t.duration,e.w=t.w,e.h=t.h,t.pFlags.round_message?e.type="round":e.type="video";break;case"documentAttributeSticker":void 0!==t.alt&&(e.stickerEmojiRaw=t.alt,e.stickerEmoji=r.a.wrapRichText(e.stickerEmojiRaw,{noLinks:!0,noLinebreaks:!0})),t.stickerset&&("inputStickerSetEmpty"===t.stickerset._?delete t.stickerset:"inputStickerSetID"===t.stickerset._&&(e.stickerSetInput=t.stickerset)),"image/webp"===e.mime_type&&(e.thumbs||d.a.isWebpSupported())&&(e.type="sticker",e.sticker=1);break;case"documentAttributeImageSize":e.type="photo",e.w=t.w,e.h=t.h;break;case"documentAttributeAnimated":"image/gif"!==e.mime_type&&"video/mp4"!==e.mime_type||(e.type="gif"),e.animated=!0}}),!e.mime_type)switch(e.type){case"gif":case"video":case"round":e.mime_type="video/mp4";break;case"sticker":e.mime_type="image/webp";break;case"audio":e.mime_type="audio/mpeg";break;case"voice":e.mime_type="audio/ogg";break;default:e.mime_type="application/octet-stream"}if("application/pdf"===e.mime_type&&(e.type="pdf"),"voice"!==e.type&&"round"!==e.type||(e.file_name=e.type+"_"+Object(g.f)(new Date(1e3*e.date),{monthAsNumber:!0,leadingZero:!0}).replace(/[:\.]/g,"-").replace(", ","_")),p.a.isServiceWorkerOnline()&&("gif"===e.type&&e.size>8e6||"audio"===e.type||"video"===e.type)){e.supportsStreaming=!0;const t=l.a.getCacheContext(e);t.url||(t.url=this.getFileURL(e))}return e.file_name||(e.file_name=""),"application/x-tgsticker"===e.mime_type&&"AnimatedSticker.tgs"===e.file_name&&(e.type="sticker",e.animated=!0,e.sticker=2),e}getDoc(e){return Object(a.f)(e)&&"string"!=typeof e?e:this.docs[e]}getMediaInput(e){return{_:"inputMediaDocument",id:{_:"inputDocument",id:e.id,access_hash:e.access_hash,file_reference:e.file_reference},ttl_seconds:0}}getInput(e,t){return{_:"inputDocumentFileLocation",id:e.id,access_hash:e.access_hash,file_reference:e.file_reference,thumb_size:t}}getFileDownloadOptions(e,t,s,i){const a=this.getInput(e,null==t?void 0:t.type);let n;return n=t?e.sticker?"image/webp":"image/jpeg":e.mime_type||"application/octet-stream",{dcId:e.dc_id,location:a,size:t?t.size:e.size,mimeType:n,fileName:e.file_name,queueId:s,onlyCache:i}}getFileURL(e,t=!1,s){let a;return a=t?"download":s?"thumb":e.supportsStreaming?"stream":"document",Object(i.b)(a,this.getFileDownloadOptions(e,s))}getThumbURL(e,t){let s=Promise.resolve();const i=l.a.getCacheContext(e,t.type);return i.url||(s="bytes"in t?Object(h.a)(c.a.getPreviewURLFromBytes(t.bytes,!!e.sticker)).then(e=>{i.url=e}):c.a.preloadPhoto(e,t)),{thumb:t,cacheContext:i,promise:s}}getThumb(e,t=!0){const s=c.a.choosePhotoSize(e,0,0,!t);return"photoSizeEmpty"===s._?null:this.getThumbURL(e,s)}getInputFileName(e,t){return Object(i.a)(this.getInput(e,t),{fileName:e.file_name})}downloadDoc(e,t,s){const i=this.getInputFileName(e);let a=l.a.getDownload(i);if(a)return a;const n=this.getFileDownloadOptions(e,void 0,t,s);a=l.a.download(n);const r=l.a.getCacheContext(e),d=a;return d.then(e=>{r.url=URL.createObjectURL(e),r.downloaded=e.size},()=>{}),"voice"!==e.type||o.a.isPlaySupported()||(a=d.then(e=>m(this,void 0,void 0,(function*(){const t=new FileReader;return yield new Promise((s,i)=>{t.onloadend=e=>{const t=new Uint8Array(e.target.result);o.a.decode(t).then(e=>{r.url=e.url,s()},e=>{delete r.downloaded,i(e)})},t.readAsArrayBuffer(e)}),e})))),a}saveLottiePreview(e,t,s){const i=e.id+"-"+s;if(this.savingLottiePreview[i])return;e.stickerCachedThumbs||(Object(a.c)(e,["stickerCachedThumbs"]),e.stickerCachedThumbs={});const n=e.stickerCachedThumbs[s];n&&n.w>=t.width&&n.h>=t.height||(this.savingLottiePreview[i]=!0,t.toBlob(a=>{const n={url:URL.createObjectURL(a),w:t.width,h:t.height};e.stickerCachedThumbs[s]=n,delete this.savingLottiePreview[i]}))}saveDocFile(e,t){const s=this.downloadDoc(e,t);return s.then(()=>{const t=l.a.getCacheContext(e);l.a.createDownloadAnchor(t.url,e.file_name)}),s}};u.a.appDocsManager=f,t.a=f},function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var i=s(33),a=s(78),n=s(9),o=s(43),r=s(47);const d=new class{constructor(){this.pageId=-1,this.pagesDiv=document.getElementById("auth-pages"),this.scrollableDiv=this.pagesDiv.querySelector(".scrollable"),this.selectTab=Object(a.a)(null,this.scrollableDiv.querySelector(".tabs-container"),null,()=>{var e;(null===(e=this.page)||void 0===e?void 0:e.onShown)&&this.page.onShown()})}setPage(e){if(e.isAuthPage){this.pagesDiv.style.display="";let t=Object(r.a)(e.pageEl);if(this.pageId===t)return;this.selectTab(t),-1!==this.pageId&&t>1&&i.b.loadLottieWorkers(),this.pageId=t,this.scrollableDiv&&Object(o.b)(this.scrollableDiv,this.scrollableDiv.firstElementChild,"start")}else this.pagesDiv.style.display="none",e.pageEl.style.display="",this.pageId=-1;this.page=e}};n.a.pagesManager=d;var l=d,c=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class h{constructor(e,t,s,i,a){this.isAuthPage=t,this.onFirstMount=s,this.onMount=i,this.onShown=a,this.installed=!1,this.pageEl=document.body.querySelector("."+e)}mount(...e){return c(this,void 0,void 0,(function*(){if(this.onMount&&this.onMount(...e),!this.installed){if(this.onFirstMount)try{const t=this.onFirstMount(...e);t instanceof Promise&&(yield t)}catch(e){console.error("PAGE MOUNT ERROR:",e)}this.installed=!0}l.setPage(this)}))}}},,,function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return o}));const i=(e,t)=>e.reduce((e,t)=>e+t,t);function a(e,t){const s=[];let i=-1;for(;-1!==(i=e.findIndex(t));)s.push(e.splice(i,1)[0]);return s}function n(e,t){for(let s=e.length-1;s>=0;--s)t(e[s],s,e)}function o(e,t,s,i){void 0===i&&-1!==(i=e.indexOf(t))&&e.splice(i,1);const a=t[s],n=e.length;if(!n||a<=e[n-1][s])return e.push(t)-1;if(a>=e[0][s])return e.unshift(t),0;for(let i=0;i<n;i++)if(a>e[i][s])return e.splice(i,0,t),i;return console.error("wtf",e,t),e.indexOf(t)}},,,function(e,t,s){"use strict";var i=s(17),a=s(26),n=s(9),o=s(40);const r=new class{constructor(){this.promises={},this.raf=i.c.bind(null),this.scheduled=!1}do(e,t){let s=this.promises[e];return s||(this.scheduleFlush(),s=this.promises[e]=Object(a.a)()),void 0!==t&&s.then(()=>t()),s}measure(e){return this.do("read",e)}mutate(e){return this.do("write",e)}mutateElement(e,t){const s=Object(o.a)(e)?this.mutate():Promise.resolve();return void 0!==t&&s.then(()=>t()),s}scheduleFlush(){this.scheduled||(this.scheduled=!0,this.raf(()=>{this.promises.read&&this.promises.read.resolve(),this.promises.write&&this.promises.write.resolve(),this.scheduled=!1,this.promises={}}))}};n.a&&(n.a.sequentialDom=r),t.a=r},function(e,t,s){"use strict";var i=s(9),a=s(28),n=s(54);const o=new class{constructor(){this.timestampNow=Object(a.h)(!0),this.midnightNoOffset=this.timestampNow-this.timestampNow%86400,this.midnightOffseted=new Date,this.midnightOffset=this.midnightNoOffset-Math.floor(+this.midnightOffseted/1e3),this.serverTimeOffset=0,this.timeParams={midnightOffset:this.midnightOffset,serverTimeOffset:this.serverTimeOffset},this.midnightOffseted.setHours(0,0,0,0),n.a.get("server_time_offset").then(e=>{e&&(this.serverTimeOffset=e,this.timeParams.serverTimeOffset=e)})}};i.a&&(i.a.serverTimeManager=o),t.a=o},function(e,t,s){"use strict";s.r(t),s.d(t,"AppProfileManager",(function(){return X}));var i=s(9),a=s(28),n=s(46),o=s(11),r=s(13),d=s(16),l=s(10),c=s(86),h=s(52),p=s(32),u=s(68),g=s(30),m=s(35),f=s(20),v=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class X{constructor(){this.usersFull={},this.chatsFull={},this.fullPromises={},this.onUpdateUserTyping=e=>{var t;const s=e.user_id||g.a.getPeerId(e.from_id);if(l.default.myId===s||"speakingInGroupCallAction"===e.action._)return;const i="updateUserTyping"===e._?s:-(e.chat_id||e.channel_id),a=null!==(t=this.typingsInPeer[i])&&void 0!==t?t:this.typingsInPeer[i]=[];let n=a.find(e=>e.userId===s);const o=()=>{delete n.timeout;const e=a.indexOf(n);-1!==e&&a.splice(e,1),l.default.dispatchEvent("peer_typings",{peerId:i,typings:a}),a.length||delete this.typingsInPeer[i]};if(n&&void 0!==n.timeout&&clearTimeout(n.timeout),"sendMessageCancelAction"===e.action._){if(!n)return;return void o()}n||(n={userId:s},a.push(n)),n.action=e.action;const r=f.a.hasUser(s);r?f.a.forceUserOnline(s):"updateChatUserTyping"===e._&&e.chat_id&&p.a.hasChat(e.chat_id)&&!p.a.isChannel(e.chat_id)&&_.getChatFull(e.chat_id).then(()=>{void 0!==n.timeout&&f.a.hasUser(s)&&l.default.dispatchEvent("peer_typings",{peerId:i,typings:a})}),n.timeout=window.setTimeout(o,6e3),r&&l.default.dispatchEvent("peer_typings",{peerId:i,typings:a})},l.default.addMultipleEventsListeners({updateChatParticipants:e=>{const t=e.participants;if("chatParticipants"===t._){const e=t.chat_id,s=this.chatsFull[e];void 0!==s&&(s.participants=t,l.default.dispatchEvent("chat_full_update",e))}},updateChatParticipantAdd:e=>{const t=this.chatsFull[e.chat_id];if(void 0!==t){const s=t.participants,i=s.participants||[];for(let t=0,s=i.length;t<s;t++)if(i[t].user_id===e.user_id)return;i.push({_:"chatParticipant",user_id:e.user_id,inviter_id:e.inviter_id,date:Object(a.h)(!0)}),s.version=e.version,l.default.dispatchEvent("chat_full_update",e.chat_id)}},updateChatParticipantDelete:e=>{const t=this.chatsFull[e.chat_id];if(void 0!==t){const s=t.participants,i=s.participants||[];for(let t=0,a=i.length;t<a;t++)if(i[t].user_id===e.user_id)return i.splice(t,1),s.version=e.version,void l.default.dispatchEvent("chat_full_update",e.chat_id)}},updateUserTyping:this.onUpdateUserTyping,updateChatUserTyping:this.onUpdateUserTyping,updateChannelUserTyping:this.onUpdateUserTyping}),l.default.addEventListener("chat_update",e=>{var t;const s=this.chatsFull[e],i=p.a.getChat(e);if(!i.photo||!s)return;const a="chatPhotoEmpty"===i.photo._;if(s.chat_photo&&a!==("photoEmpty"===s.chat_photo._))return delete this.chatsFull[e],void l.default.dispatchEvent("chat_full_update",e);if(a)return;const n=i.photo.photo_id;(null===(t=s.chat_photo)||void 0===t?void 0:t.id)!==n&&(delete this.chatsFull[e],l.default.dispatchEvent("chat_full_update",e))}),l.default.addEventListener("invalidate_participants",e=>{this.invalidateChannelParticipants(e)}),this.megagroupOnlines={},this.typingsInPeer={}}getProfile(e,t){return this.usersFull[e]&&!t?Promise.resolve(this.usersFull[e]):this.fullPromises[e]?this.fullPromises[e]:this.fullPromises[e]=r.a.invokeApi("users.getFullUser",{id:f.a.getUserInput(e)}).then(t=>{const s=t.user;return f.a.saveApiUser(s,!0),t.profile_photo&&(t.profile_photo=m.a.savePhoto(t.profile_photo,{type:"profilePhoto",peerId:e})),void 0!==t.about&&(t.rAbout=d.a.wrapRichText(t.about,{noLinebreaks:!0})),u.a.savePeerSettings(e,t.notify_settings),delete this.fullPromises[e],this.usersFull[e]=t})}getProfileByPeerId(e,t){return e<0?this.getChatFull(-e,t):this.getProfile(e,t)}getFullPhoto(e){return this.getProfileByPeerId(e).then(e=>{switch(e._){case"userFull":return e.profile_photo;case"channelFull":case"chatFull":return e.chat_photo}})}getChatFull(e,t){if(p.a.isChannel(e))return this.getChannelFull(e,t);const s=this.chatsFull[e];if(s&&!t){const t=p.a.getChat(e);if(t.version===s.participants.version||t.pFlags.left)return Promise.resolve(s)}const i=-e;return void 0!==this.fullPromises[i]?this.fullPromises[i]:this.fullPromises[i]=r.a.invokeApi("messages.getFullChat",{chat_id:e}).then(t=>{p.a.saveApiChats(t.chats,!0),f.a.saveApiUsers(t.users);const s=t.full_chat;return s&&s.chat_photo&&s.chat_photo.id&&(s.chat_photo=m.a.savePhoto(s.chat_photo,{type:"profilePhoto",peerId:i})),u.a.savePeerSettings(i,s.notify_settings),delete this.fullPromises[i],this.chatsFull[e]=s,l.default.dispatchEvent("chat_full_update",e),s})}getChatInviteLink(e,t){return this.getChatFull(e).then(s=>!t&&s.exported_invite&&"chatInviteExported"==s.exported_invite._?s.exported_invite.link:r.a.invokeApi("messages.exportChatInvite",{peer:g.a.getInputPeerById(-e)}).then(t=>(void 0!==this.chatsFull[e]&&(this.chatsFull[e].exported_invite=t),t.link)))}getChannelParticipants(e,t={_:"channelParticipantsRecent"},s=200,i=0){if("channelParticipantsRecent"===t._){const t=p.a.getChat(e);if(t&&t.pFlags&&(t.pFlags.kicked||t.pFlags.broadcast&&!t.pFlags.creator&&!t.admin_rights))return Promise.reject()}return r.a.invokeApiCacheable("channels.getParticipants",{channel:p.a.getChannelInput(e),filter:t,offset:i,limit:s,hash:0},{cacheSeconds:60}).then(e=>(f.a.saveApiUsers(e.users),e))}getChannelParticipant(e,t){return r.a.invokeApiSingle("channels.getParticipant",{channel:p.a.getChannelInput(e),participant:g.a.getInputPeerById(t)}).then(e=>(f.a.saveApiUsers(e.users),e.participant))}getChannelFull(e,t){if(void 0!==this.chatsFull[e]&&!t)return Promise.resolve(this.chatsFull[e]);const s=-e;return void 0!==this.fullPromises[s]?this.fullPromises[s]:this.fullPromises[s]=r.a.invokeApi("channels.getFullChannel",{channel:p.a.getChannelInput(e)}).then(t=>{p.a.saveApiChats(t.chats,!0),f.a.saveApiUsers(t.users);const i=t.full_chat;return i&&i.chat_photo.id&&(i.chat_photo=m.a.savePhoto(i.chat_photo,{type:"profilePhoto",peerId:s})),u.a.savePeerSettings(s,i.notify_settings),delete this.fullPromises[s],this.chatsFull[e]=i,l.default.dispatchEvent("chat_full_update",e),i},t=>{switch(t.type){case"CHANNEL_PRIVATE":let t=p.a.getChat(e);t={_:"channelForbidden",access_hash:t.access_hash,title:t.title},h.a.processUpdateMessage({_:"updates",updates:[{_:"updateChannel",channel_id:e}],chats:[t],users:[]})}return Promise.reject(t)})}getMentions(e,t,s){const i=e=>{const s=new c.a(!0,!0);return e.forEach(e=>{s.indexObject(e,f.a.getUserSearchText(e))}),Array.from(s.search(t))};return p.a.isChannel(e)?this.getChannelParticipants(e,{_:"channelParticipantsMentions",q:t,top_msg_id:s},50,0).then(e=>i(e.participants.map(e=>p.a.getParticipantPeerId(e)))):this.getChatFull(e).then(e=>i(e.participants.participants.map(e=>e.user_id)))}invalidateChannelParticipants(e){delete this.chatsFull[e],delete this.fullPromises[-e],r.a.clearCache("channels.getParticipants",t=>t.channel.channel_id===e),l.default.dispatchEvent("chat_full_update",e)}updateProfile(e,t,s){return r.a.invokeApi("account.updateProfile",{first_name:e,last_name:t,about:s}).then(e=>(f.a.saveApiUser(e),this.getProfile(l.default.myId,!0)))}uploadProfilePhoto(e){return r.a.invokeApi("photos.uploadProfilePhoto",{file:e}).then(e=>{f.a.saveApiUsers(e.users);const t=l.default.myId;m.a.savePhoto(e.photo,{type:"profilePhoto",peerId:t}),h.a.processUpdateMessage({_:"updateShort",update:{_:"updateUserPhoto",user_id:t,date:Object(a.h)(!0),photo:f.a.getUser(t).photo,previous:!0}})})}getChatMembersString(e){var t,s;const i=p.a.getChat(e),a=this.chatsFull[e];let r;r=a?"channelFull"===a._?a.participants_count:null===(t=a.participants.participants)||void 0===t?void 0:t.length:i.participants_count||(null===(s=i.participants)||void 0===s?void 0:s.participants.length);r=r||1;let d=p.a.isBroadcast(e)?"Peer.Status.Subscribers":"Peer.Status.Member";return Object(o.i18n)(d,[Object(n.d)(r)])}getOnlines(e){var t,s;return v(this,void 0,void 0,(function*(){if(p.a.isMegagroup(e)){const i=Date.now()/1e3|0,a=null!==(t=this.megagroupOnlines[e])&&void 0!==t?t:this.megagroupOnlines[e]={timestamp:0,onlines:1};if(i-a.timestamp<60)return a.onlines;const n=yield r.a.invokeApi("messages.getOnlines",{peer:p.a.getChannelInputPeer(e)}),o=null!==(s=n.onlines)&&void 0!==s?s:1;return a.timestamp=i,a.onlines=o,o}if(p.a.isBroadcast(e))return 1;const i=(yield this.getChatFull(e)).participants;if(i&&i.participants){return i.participants.reduce((e,t)=>{const s=f.a.getUser(t.user_id);return s&&s.status&&"userStatusOnline"===s.status._?e+1:e},0)}return 1}))}getPeerTypings(e){return this.typingsInPeer[e]}}const _=new X;i.a.appProfileManager=_,t.default=_},function(e,t,s){"use strict";s.d(t,"b",(function(){return c})),s.d(t,"a",(function(){return h}));var i=s(10),a=s(27),n=s(45),o=s(36),r=s(11),d=s(1),l=s(2);class c{constructor(e,t,s={}){if(this.element=document.createElement("div"),this.container=document.createElement("div"),this.header=document.createElement("div"),this.title=document.createElement("div"),this.onEscape=()=>!0,this.hide=()=>{o.a.back("popup")},this.destroy=()=>{this.onClose&&this.onClose(),this.element.classList.add("hiding"),this.element.classList.remove("active"),this.btnClose&&this.btnClose.removeEventListener("click",this.hide),i.default.overlayIsActive=!1,o.a.removeItem(this.navigationItem),this.navigationItem=void 0,setTimeout(()=>{this.element.remove(),this.onCloseAfterTimeout&&this.onCloseAfterTimeout(),n.a.checkAnimations(!1)},150)},this.element.classList.add("popup"),this.element.className="popup"+(e?" "+e:""),this.container.classList.add("popup-container","z-depth-1"),this.header.classList.add("popup-header"),this.title.classList.add("popup-title"),this.header.append(this.title),s.closable&&(this.btnClose=document.createElement("span"),this.btnClose.classList.add("btn-icon","popup-close","tgico-close"),this.header.prepend(this.btnClose),this.btnClose.addEventListener("click",this.hide,{once:!0})),s.overlayClosable){const e=t=>{Object(d.a)(t.target,"popup-container")||(this.hide(),this.element.removeEventListener("click",e))};this.element.addEventListener("click",e)}if(s.withConfirm&&(this.btnConfirm=document.createElement("button"),this.btnConfirm.classList.add("btn-primary","btn-color-primary"),!0!==s.withConfirm&&this.btnConfirm.append(Object(r.i18n)(s.withConfirm)),this.header.append(this.btnConfirm),Object(a.ripple)(this.btnConfirm)),this.container.append(this.header),s.body&&(this.body=document.createElement("div"),this.body.classList.add("popup-body"),this.container.append(this.body)),t&&t.length){const e=document.createElement("div");e.classList.add("popup-buttons"),2===t.length&&e.classList.add("popup-buttons-row");const s=t.map(e=>{const t=document.createElement("button");return t.className="btn"+(e.isDanger?" danger":" primary"),Object(a.ripple)(t),e.text?t.innerHTML=e.text:t.append(Object(r.i18n)(e.langKey,e.langArgs)),e.callback?t.addEventListener("click",()=>{e.callback(),this.destroy()},{once:!0}):e.isCancel&&t.addEventListener("click",()=>{this.destroy()},{once:!0}),t});e.append(...s),this.container.append(e)}this.element.append(this.container)}show(){this.navigationItem={type:"popup",onPop:this.destroy,onEscape:this.onEscape},o.a.pushItem(this.navigationItem),Object(l.a)(),document.body.append(this.element),this.element.offsetWidth,this.element.classList.add("active"),i.default.overlayIsActive=!0,n.a.checkAnimations(!0)}}const h=e=>(e.find(e=>e.isCancel)||e.push({langKey:"Cancel",isCancel:!0}),e)},,,function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const a={},n=(e,t)=>{e instanceof HTMLImageElement||e instanceof HTMLVideoElement?e.src=t:e instanceof SVGImageElement?e.setAttributeNS(null,"href",t):e.style.backgroundImage="url("+t+")"};function o(e,t,s,o=!0){return i(this,void 0,void 0,(function*(){if(!t)return console.error("renderImageFromUrl: no url?",e,t),void(s&&s());if(a[t]&&o||e instanceof HTMLVideoElement)e&&n(e,t),s&&s();else{const i=e instanceof HTMLImageElement,o=i?e:new Image;o.src=t,o.addEventListener("load",()=>{!i&&e&&n(e,t),a[t]=!0,s&&s()}),s&&o.addEventListener("error",s)}}))}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s(9);const a=[{phoneCode:"7 840",code:"AB",name:"Abkhazia",pattern:"",emoji:""},{phoneCode:"93",code:"AF",name:"Afghanistan",pattern:"93 XXX XXX XXX",emoji:"🇦🇫"},{phoneCode:"358 18",code:"AX",name:"Aland Islands",pattern:"",emoji:"🇦🇽"},{phoneCode:"355",code:"AL",name:"Albania",pattern:"355 XX XXX XXXX",emoji:"🇦🇱"},{phoneCode:"213",code:"DZ",name:"Algeria",pattern:"213 XXX XX XX XX",emoji:"🇩🇿"},{phoneCode:"1 684",code:"AS",name:"American Samoa",pattern:"1684 XXX XXXX",emoji:"🇦🇸"},{phoneCode:"376",code:"AD",name:"Andorra",pattern:"376 XX XX XX",emoji:"🇦🇩"},{phoneCode:"244",code:"AO",name:"Angola",pattern:"244 XXX XXX XXX",emoji:"🇦🇴"},{phoneCode:"1 264",code:"AI",name:"Anguilla",pattern:"1264 XXX XXXX",emoji:"🇦🇮"},{phoneCode:"1 268",code:"AG",name:"Antigua & Barbuda",pattern:"1268 XXX XXXX",emoji:"🇦🇬"},{phoneCode:"54",code:"AR",name:"Argentina",pattern:"",emoji:"🇦🇷"},{phoneCode:"374",code:"AM",name:"Armenia",pattern:"374 XX XXX XXX",emoji:"🇦🇲"},{phoneCode:"297",code:"AW",name:"Aruba",pattern:"297 XXX XXXX",emoji:"🇦🇼"},{phoneCode:"247",code:"SH",name:"Ascension",pattern:"290 XX XXX",emoji:"🇸🇭"},{phoneCode:"61",code:"AU",name:"Australia",pattern:"61 XXX XXX XXX",emoji:"🇦🇺"},{phoneCode:"672",code:"AU",name:"Australian External Territories",pattern:"61 XXX XXX XXX",emoji:"🇦🇺"},{phoneCode:"43",code:"AT",name:"Austria",pattern:"",emoji:"🇦🇹"},{phoneCode:"994",code:"AZ",name:"Azerbaijan",pattern:"994 XX XXX XX XX",emoji:"🇦🇿"},{phoneCode:"1 242",code:"BS",name:"Bahamas",pattern:"1242 XXX XXXX",emoji:"🇧🇸"},{phoneCode:"973",code:"BH",name:"Bahrain",pattern:"973 XXXX XXXX",emoji:"🇧🇭"},{phoneCode:"880",code:"BD",name:"Bangladesh",pattern:"",emoji:"🇧🇩"},{phoneCode:"1 246",code:"BB",name:"Barbados",pattern:"1246 XXX XXXX",emoji:"🇧🇧"},{phoneCode:"1 268",code:"AG",name:"Barbuda",pattern:"1268 XXX XXXX",emoji:"🇦🇬"},{phoneCode:"375",code:"BY",name:"Belarus",pattern:"375 XX XXX XXXX",emoji:"🇧🇾"},{phoneCode:"32",code:"BE",name:"Belgium",pattern:"32 XXX XX XX XX",emoji:"🇧🇪"},{phoneCode:"501",code:"BZ",name:"Belize",pattern:"",emoji:"🇧🇿"},{phoneCode:"229",code:"BJ",name:"Benin",pattern:"229 XX XXX XXX",emoji:"🇧🇯"},{phoneCode:"1 441",code:"BM",name:"Bermuda",pattern:"1441 XXX XXXX",emoji:"🇧🇲"},{phoneCode:"975",code:"BT",name:"Bhutan",pattern:"",emoji:"🇧🇹"},{phoneCode:"591",code:"BO",name:"Bolivia",pattern:"591 X XXX XXXX",emoji:"🇧🇴"},{phoneCode:"599 7",code:"BQ",name:"Caribbean Netherlands",pattern:"",emoji:"🇧🇶"},{phoneCode:"387",code:"BA",name:"Bosnia & Herzegovina",pattern:"",emoji:"🇧🇦"},{phoneCode:"267",code:"BW",name:"Botswana",pattern:"267 XX XXX XXX",emoji:"🇧🇼"},{phoneCode:"55",code:"BR",name:"Brazil",pattern:"55 XX XXXXX XXXX",emoji:"🇧🇷"},{phoneCode:"246",code:"IO",name:"British Indian Ocean Territory",pattern:"246 XXX XXXX",emoji:"🇮🇴"},{phoneCode:"1 284",code:"VG",name:"British Virgin Islands",pattern:"1284 XXX XXXX",emoji:"🇻🇬"},{phoneCode:"673",code:"BN",name:"Brunei",pattern:"673 XXX XXXX",emoji:"🇧🇳"},{phoneCode:"359",code:"BG",name:"Bulgaria",pattern:"",emoji:"🇧🇬"},{phoneCode:"226",code:"BF",name:"Burkina Faso",pattern:"226 XX XX XX XX",emoji:"🇧🇫"},{phoneCode:"95",code:"MM",name:"Myanmar (Burma)",pattern:"",emoji:"🇲🇲"},{phoneCode:"257",code:"BI",name:"Burundi",pattern:"257 XX XX XXXX",emoji:"🇧🇮"},{phoneCode:"855",code:"KH",name:"Cambodia",pattern:"",emoji:"🇰🇭"},{phoneCode:"237",code:"CM",name:"Cameroon",pattern:"237 XXXX XXXX",emoji:"🇨🇲"},{phoneCode:"1",code:"CA",name:"Canada",pattern:"1 XXX XXX XXXX",emoji:"🇨🇦"},{phoneCode:"238",code:"CV",name:"Cape Verde",pattern:"238 XXX XXXX",emoji:"🇨🇻"},{phoneCode:"1 345",code:"KY",name:"Cayman Islands",pattern:"1345 XXX XXXX",emoji:"🇰🇾"},{phoneCode:"236",code:"CF",name:"Central African Republic",pattern:"236 XX XX XX XX",emoji:"🇨🇫"},{phoneCode:"235",code:"TD",name:"Chad",pattern:"235 XX XX XX XX",emoji:"🇹🇩"},{phoneCode:"56",code:"CL",name:"Chile",pattern:"56 X XXXX XXXX",emoji:"🇨🇱"},{phoneCode:"86",code:"CN",name:"China",pattern:"86 XXX XXXX XXXX",emoji:"🇨🇳"},{phoneCode:"61",code:"CX",name:"Christmas Island",pattern:"",emoji:"🇨🇽"},{phoneCode:"61",code:"CC",name:"Cocos (Keeling) Islands",pattern:"",emoji:"🇨🇨"},{phoneCode:"57",code:"CO",name:"Colombia",pattern:"57 XXX XXX XXXX",emoji:"🇨🇴"},{phoneCode:"269",code:"KM",name:"Comoros",pattern:"269 XXX XXXX",emoji:"🇰🇲"},{phoneCode:"242",code:"CG",name:"Congo - Brazzaville",pattern:"242 XX XXX XXXX",emoji:"🇨🇬"},{phoneCode:"243",code:"CD",name:"Congo - Kinshasa",pattern:"243 XX XXX XXXX",emoji:"🇨🇩"},{phoneCode:"682",code:"CK",name:"Cook Islands",pattern:"",emoji:"🇨🇰"},{phoneCode:"506",code:"CR",name:"Costa Rica",pattern:"",emoji:"🇨🇷"},{phoneCode:"225",code:"CI",name:"Cote d’Ivoire",pattern:"225 XX XXX XXX",emoji:"🇨🇮"},{phoneCode:"385",code:"HR",name:"Croatia",pattern:"",emoji:"🇭🇷"},{phoneCode:"53",code:"CU",name:"Cuba",pattern:"53 XXXX XXXX",emoji:"🇨🇺"},{phoneCode:"599 9",code:"CW",name:"Curacao",pattern:"",emoji:"🇨🇼"},{phoneCode:"357",code:"CY",name:"Cyprus",pattern:"357 XXXX XXXX",emoji:"🇨🇾"},{phoneCode:"420",code:"CZ",name:"Czech Republic",pattern:"",emoji:"🇨🇿"},{phoneCode:"45",code:"DK",name:"Denmark",pattern:"45 XXXX XXXX",emoji:"🇩🇰"},{phoneCode:"246",code:"DG",name:"Diego Garcia",pattern:"",emoji:"🇩🇬"},{phoneCode:"253",code:"DJ",name:"Djibouti",pattern:"253 XX XX XX XX",emoji:"🇩🇯"},{phoneCode:"1 767",code:"DM",name:"Dominica",pattern:"1767 XXX XXXX",emoji:"🇩🇲"},{phoneCode:"1 809 and 1 829",code:"DO",name:"Dominican Republic",pattern:"1 XXX XXX XXXX",emoji:"🇩🇴"},{phoneCode:"670",code:"TL",name:"Timor-Leste",pattern:"",emoji:"🇹🇱"},{phoneCode:"593",code:"EC",name:"Ecuador",pattern:"",emoji:"🇪🇨"},{phoneCode:"20",code:"EG",name:"Egypt",pattern:"20 XX XXX XXXX",emoji:"🇪🇬"},{phoneCode:"503",code:"SV",name:"El Salvador",pattern:"503 XXXX XXXX",emoji:"🇸🇻"},{phoneCode:"240",code:"GQ",name:"Equatorial Guinea",pattern:"240 XXX XXX XXX",emoji:"🇬🇶"},{phoneCode:"291",code:"ER",name:"Eritrea",pattern:"291 X XXX XXX",emoji:"🇪🇷"},{phoneCode:"372",code:"EE",name:"Estonia",pattern:"",emoji:"🇪🇪"},{phoneCode:"251",code:"ET",name:"Ethiopia",pattern:"251 XX XXX XXXX",emoji:"🇪🇹"},{phoneCode:"500",code:"FK",name:"Falkland Islands",pattern:"",emoji:"🇫🇰"},{phoneCode:"298",code:"FO",name:"Faroe Islands",pattern:"298 XXX XXX",emoji:"🇫🇴"},{phoneCode:"679",code:"FJ",name:"Fiji",pattern:"",emoji:"🇫🇯"},{phoneCode:"358",code:"FI",name:"Finland",pattern:"",emoji:"🇫🇮"},{phoneCode:"33",code:"FR",name:"France",pattern:"33 X XX XX XX XX",emoji:"🇫🇷"},{phoneCode:"594",code:"GF",name:"French Guiana",pattern:"",emoji:"🇬🇫"},{phoneCode:"689",code:"PF",name:"French Polynesia",pattern:"",emoji:"🇵🇫"},{phoneCode:"241",code:"GA",name:"Gabon",pattern:"241 X XX XX XX",emoji:"🇬🇦"},{phoneCode:"220",code:"GM",name:"Gambia",pattern:"220 XXX XXXX",emoji:"🇬🇲"},{phoneCode:"995",code:"GE",name:"Georgia",pattern:"",emoji:"🇬🇪"},{phoneCode:"49",code:"DE",name:"Germany",pattern:"49 XXX XXXXXXXX",emoji:"🇩🇪"},{phoneCode:"233",code:"GH",name:"Ghana",pattern:"",emoji:"🇬🇭"},{phoneCode:"350",code:"GI",name:"Gibraltar",pattern:"350 XXXX XXXX",emoji:"🇬🇮"},{phoneCode:"30",code:"GR",name:"Greece",pattern:"30 XX XXXX XXXX",emoji:"🇬🇷"},{phoneCode:"299",code:"GL",name:"Greenland",pattern:"299 XXX XXX",emoji:"🇬🇱"},{phoneCode:"1 473",code:"GD",name:"Grenada",pattern:"1473 XXX XXXX",emoji:"🇬🇩"},{phoneCode:"590",code:"GP",name:"Guadeloupe",pattern:"",emoji:"🇬🇵"},{phoneCode:"1 671",code:"GU",name:"Guam",pattern:"1671 XXX XXXX",emoji:"🇬🇺"},{phoneCode:"502",code:"GT",name:"Guatemala",pattern:"502 X XXX XXXX",emoji:"🇬🇹"},{phoneCode:"44",code:"GG",name:"Guernsey",pattern:"",emoji:"🇬🇬"},{phoneCode:"224",code:"GN",name:"Guinea",pattern:"224 XXX XXX XXX",emoji:"🇬🇳"},{phoneCode:"245",code:"GW",name:"Guinea-Bissau",pattern:"245 XXX XXXX",emoji:"🇬🇼"},{phoneCode:"592",code:"GY",name:"Guyana",pattern:"",emoji:"🇬🇾"},{phoneCode:"509",code:"HT",name:"Haiti",pattern:"",emoji:"🇭🇹"},{phoneCode:"504",code:"HN",name:"Honduras",pattern:"504 XXXX XXXX",emoji:"🇭🇳"},{phoneCode:"852",code:"HK",name:"Hong Kong SAR China",pattern:"",emoji:"🇭🇰"},{phoneCode:"36",code:"HU",name:"Hungary",pattern:"36 XX XXX XXXX",emoji:"🇭🇺"},{phoneCode:"354",code:"IS",name:"Iceland",pattern:"354 XXX XXXX",emoji:"🇮🇸"},{phoneCode:"91",code:"IN",name:"India",pattern:"91 XXXXX XXXXX",emoji:"🇮🇳"},{phoneCode:"62",code:"ID",name:"Indonesia",pattern:"",emoji:"🇮🇩"},{phoneCode:"98",code:"IR",name:"Iran",pattern:"98 XXX XXX XXXX",emoji:"🇮🇷"},{phoneCode:"964",code:"IQ",name:"Iraq",pattern:"964 XXX XXX XXXX",emoji:"🇮🇶"},{phoneCode:"353",code:"IE",name:"Ireland",pattern:"353 XX XXX XXXX",emoji:"🇮🇪"},{phoneCode:"972",code:"IL",name:"Israel",pattern:"972 XX XXX XXXX",emoji:"🇮🇱"},{phoneCode:"39",code:"IT",name:"Italy",pattern:"39 XXX XXX XXXX",emoji:"🇮🇹"},{phoneCode:"1 876",code:"JM",name:"Jamaica",pattern:"1876 XXX XXXX",emoji:"🇯🇲"},{phoneCode:"47 79",code:"SJ",name:"Svalbard & Jan Mayen",pattern:"",emoji:"🇸🇯"},{phoneCode:"81",code:"JP",name:"Japan",pattern:"81 XX XXXX XXXX",emoji:"🇯🇵"},{phoneCode:"44",code:"JE",name:"Jersey",pattern:"",emoji:"🇯🇪"},{phoneCode:"962",code:"JO",name:"Jordan",pattern:"962 X XXXX XXXX",emoji:"🇯🇴"},{phoneCode:"7 7",code:"KZ",name:"Kazakhstan",pattern:"7 XXX XXX XX XX",emoji:"🇰🇿"},{phoneCode:"254",code:"KE",name:"Kenya",pattern:"254 XXX XXX XXX",emoji:"🇰🇪"},{phoneCode:"686",code:"KI",name:"Kiribati",pattern:"",emoji:"🇰🇮"},{phoneCode:"850",code:"KP",name:"North Korea",pattern:"",emoji:"🇰🇵"},{phoneCode:"82",code:"KR",name:"South Korea",pattern:"",emoji:"🇰🇷"},{phoneCode:"965",code:"KW",name:"Kuwait",pattern:"965 XXXX XXXX",emoji:"🇰🇼"},{phoneCode:"996",code:"KG",name:"Kyrgyzstan",pattern:"",emoji:"🇰🇬"},{phoneCode:"856",code:"LA",name:"Laos",pattern:"",emoji:"🇱🇦"},{phoneCode:"371",code:"LV",name:"Latvia",pattern:"371 XXX XXXXX",emoji:"🇱🇻"},{phoneCode:"961",code:"LB",name:"Lebanon",pattern:"",emoji:"🇱🇧"},{phoneCode:"266",code:"LS",name:"Lesotho",pattern:"266 XX XXX XXX",emoji:"🇱🇸"},{phoneCode:"231",code:"LR",name:"Liberia",pattern:"",emoji:"🇱🇷"},{phoneCode:"218",code:"LY",name:"Libya",pattern:"218 XX XXX XXXX",emoji:"🇱🇾"},{phoneCode:"423",code:"LI",name:"Liechtenstein",pattern:"",emoji:"🇱🇮"},{phoneCode:"370",code:"LT",name:"Lithuania",pattern:"370 XXX XXXXX",emoji:"🇱🇹"},{phoneCode:"352",code:"LU",name:"Luxembourg",pattern:"",emoji:"🇱🇺"},{phoneCode:"853",code:"MO",name:"Macau SAR China",pattern:"",emoji:"🇲🇴"},{phoneCode:"389",code:"MK",name:"Macedonia",pattern:"",emoji:"🇲🇰"},{phoneCode:"261",code:"MG",name:"Madagascar",pattern:"261 XX XX XXX XX",emoji:"🇲🇬"},{phoneCode:"265",code:"MW",name:"Malawi",pattern:"",emoji:"🇲🇼"},{phoneCode:"60",code:"MY",name:"Malaysia",pattern:"",emoji:"🇲🇾"},{phoneCode:"960",code:"MV",name:"Maldives",pattern:"",emoji:"🇲🇻"},{phoneCode:"223",code:"ML",name:"Mali",pattern:"223 XXXX XXXX",emoji:"🇲🇱"},{phoneCode:"356",code:"MT",name:"Malta",pattern:"356 XX XX XX XX",emoji:"🇲🇹"},{phoneCode:"692",code:"MH",name:"Marshall Islands",pattern:"",emoji:"🇲🇭"},{phoneCode:"596",code:"MQ",name:"Martinique",pattern:"",emoji:"🇲🇶"},{phoneCode:"222",code:"MR",name:"Mauritania",pattern:"222 XXXX XXXX",emoji:"🇲🇷"},{phoneCode:"230",code:"MU",name:"Mauritius",pattern:"",emoji:"🇲🇺"},{phoneCode:"262",code:"YT",name:"Mayotte",pattern:"",emoji:"🇾🇹"},{phoneCode:"52",code:"MX",name:"Mexico",pattern:"",emoji:"🇲🇽"},{phoneCode:"691",code:"FM",name:"Micronesia",pattern:"",emoji:"🇫🇲"},{phoneCode:"373",code:"MD",name:"Moldova",pattern:"373 XX XXX XXX",emoji:"🇲🇩"},{phoneCode:"377",code:"MC",name:"Monaco",pattern:"377 XXXX XXXX",emoji:"🇲🇨"},{phoneCode:"976",code:"MN",name:"Mongolia",pattern:"",emoji:"🇲🇳"},{phoneCode:"382",code:"ME",name:"Montenegro",pattern:"",emoji:"🇲🇪"},{phoneCode:"1 664",code:"MS",name:"Montserrat",pattern:"1664 XXX XXXX",emoji:"🇲🇸"},{phoneCode:"212",code:"MA",name:"Morocco",pattern:"212 XX XXX XXXX",emoji:"🇲🇦"},{phoneCode:"258",code:"MZ",name:"Mozambique",pattern:"258 XX XXX XXXX",emoji:"🇲🇿"},{phoneCode:"264",code:"NA",name:"Namibia",pattern:"264 XX XXX XXXX",emoji:"🇳🇦"},{phoneCode:"674",code:"NR",name:"Nauru",pattern:"",emoji:"🇳🇷"},{phoneCode:"977",code:"NP",name:"Nepal",pattern:"",emoji:"🇳🇵"},{phoneCode:"31",code:"NL",name:"Netherlands",pattern:"31 X XX XX XX XX",emoji:"🇳🇱"},{phoneCode:"687",code:"NC",name:"New Caledonia",pattern:"",emoji:"🇳🇨"},{phoneCode:"64",code:"NZ",name:"New Zealand",pattern:"",emoji:"🇳🇿"},{phoneCode:"505",code:"NI",name:"Nicaragua",pattern:"505 XXXX XXXX",emoji:"🇳🇮"},{phoneCode:"227",code:"NE",name:"Niger",pattern:"227 XX XX XX XX",emoji:"🇳🇪"},{phoneCode:"234",code:"NG",name:"Nigeria",pattern:"",emoji:"🇳🇬"},{phoneCode:"683",code:"NU",name:"Niue",pattern:"",emoji:"🇳🇺"},{phoneCode:"672",code:"NF",name:"Norfolk Island",pattern:"",emoji:"🇳🇫"},{phoneCode:"1 670",code:"MP",name:"Northern Mariana Islands",pattern:"1670 XXX XXXX",emoji:"🇲🇵"},{phoneCode:"47",code:"NO",name:"Norway",pattern:"47 XXXX XXXX",emoji:"🇳🇴"},{phoneCode:"968",code:"OM",name:"Oman",pattern:"968 XXXX XXXX",emoji:"🇴🇲"},{phoneCode:"92",code:"PK",name:"Pakistan",pattern:"92 XXX XXX XXXX",emoji:"🇵🇰"},{phoneCode:"680",code:"PW",name:"Palau",pattern:"",emoji:"🇵🇼"},{phoneCode:"970",code:"PS",name:"Palestinian Territories",pattern:"970 XXX XX XXXX",emoji:"🇵🇸"},{phoneCode:"507",code:"PA",name:"Panama",pattern:"507 XXXX XXXX",emoji:"🇵🇦"},{phoneCode:"675",code:"PG",name:"Papua New Guinea",pattern:"",emoji:"🇵🇬"},{phoneCode:"595",code:"PY",name:"Paraguay",pattern:"595 XXX XXX XXX",emoji:"🇵🇾"},{phoneCode:"51",code:"PE",name:"Peru",pattern:"51 XXX XXX XXX",emoji:"🇵🇪"},{phoneCode:"63",code:"PH",name:"Philippines",pattern:"63 XXX XXX XXXX",emoji:"🇵🇭"},{phoneCode:"64",code:"PN",name:"Pitcairn Islands",pattern:"",emoji:"🇵🇳"},{phoneCode:"48",code:"PL",name:"Poland",pattern:"48 XXX XXX XXX",emoji:"🇵🇱"},{phoneCode:"351",code:"PT",name:"Portugal",pattern:"351 X XXXX XXXX",emoji:"🇵🇹"},{phoneCode:"1 787 and 1 939",code:"PR",name:"Puerto Rico",pattern:"1 XXX XXX XXXX",emoji:"🇵🇷"},{phoneCode:"974",code:"QA",name:"Qatar",pattern:"",emoji:"🇶🇦"},{phoneCode:"262",code:"RE",name:"Reunion",pattern:"262 XXX XXX XXX",emoji:"🇷🇪"},{phoneCode:"40",code:"RO",name:"Romania",pattern:"40 XXX XXX XXX",emoji:"🇷🇴"},{phoneCode:"7",code:"RU",name:"Russia",pattern:"7 XXX XXX XX XX",emoji:"🇷🇺"},{phoneCode:"250",code:"RW",name:"Rwanda",pattern:"250 XXX XXX XXX",emoji:"🇷🇼"},{phoneCode:"590",code:"BL",name:"St. Barthelemy",pattern:"",emoji:"🇧🇱"},{phoneCode:"290",code:"SH",name:"St. Helena",pattern:"290 XX XXX",emoji:"🇸🇭"},{phoneCode:"1 869",code:"KN",name:"St. Kitts & Nevis",pattern:"1869 XXX XXXX",emoji:"🇰🇳"},{phoneCode:"1 758",code:"LC",name:"St. Lucia",pattern:"1758 XXX XXXX",emoji:"🇱🇨"},{phoneCode:"590",code:"MF",name:"St. Martin (France)",pattern:"",emoji:"🇲🇫"},{phoneCode:"508",code:"PM",name:"St. Pierre and Miquelon",pattern:"",emoji:"🇵🇲"},{phoneCode:"1 784",code:"VC",name:"St. Vincent and the Grenadines",pattern:"1784 XXX XXXX",emoji:"🇻🇨"},{phoneCode:"685",code:"WS",name:"Samoa",pattern:"",emoji:"🇼🇸"},{phoneCode:"378",code:"SM",name:"San Marino",pattern:"378 XXX XXX XXXX",emoji:"🇸🇲"},{phoneCode:"239",code:"ST",name:"São Tome & Principe",pattern:"239 XX XXXXX",emoji:"🇸🇹"},{phoneCode:"966",code:"SA",name:"Saudi Arabia",pattern:"",emoji:"🇸🇦"},{phoneCode:"221",code:"SN",name:"Senegal",pattern:"221 XX XXX XXXX",emoji:"🇸🇳"},{phoneCode:"381",code:"RS",name:"Serbia",pattern:"381 XX XXX XXXX",emoji:"🇷🇸"},{phoneCode:"248",code:"SC",name:"Seychelles",pattern:"248 X XX XX XX",emoji:"🇸🇨"},{phoneCode:"232",code:"SL",name:"Sierra Leone",pattern:"232 XX XXX XXX",emoji:"🇸🇱"},{phoneCode:"65",code:"SG",name:"Singapore",pattern:"65 XXXX XXXX",emoji:"🇸🇬"},{phoneCode:"599 3",code:"BQ",name:"Sint Eustatius",pattern:"",emoji:"🇧🇶"},{phoneCode:"1 721",code:"SX",name:"Sint Maarten",pattern:"1721 XXX XXXX",emoji:"🇸🇽"},{phoneCode:"421",code:"SK",name:"Slovakia",pattern:"",emoji:"🇸🇰"},{phoneCode:"386",code:"SI",name:"Slovenia",pattern:"",emoji:"🇸🇮"},{phoneCode:"677",code:"SB",name:"Solomon Islands",pattern:"",emoji:"🇸🇧"},{phoneCode:"252",code:"SO",name:"Somalia",pattern:"252 XX XXX XXX",emoji:"🇸🇴"},{phoneCode:"27",code:"ZA",name:"South Africa",pattern:"27 XX XXX XXXX",emoji:"🇿🇦"},{phoneCode:"500",code:"GS",name:"South Georgia & South Sandwich Islands",pattern:"",emoji:"🇬🇸"},{phoneCode:"995 34",code:"",name:"South Ossetia",pattern:"",emoji:""},{phoneCode:"211",code:"SS",name:"South Sudan",pattern:"211 XX XXX XXXX",emoji:"🇸🇸"},{phoneCode:"34",code:"ES",name:"Spain",pattern:"34 XXX XXX XXX",emoji:"🇪🇸"},{phoneCode:"94",code:"LK",name:"Sri Lanka",pattern:"94 XX XXX XXXX",emoji:"🇱🇰"},{phoneCode:"249",code:"SD",name:"Sudan",pattern:"249 XX XXX XXXX",emoji:"🇸🇩"},{phoneCode:"597",code:"SR",name:"Suriname",pattern:"597 XXX XXXX",emoji:"🇸🇷"},{phoneCode:"47 79",code:"SJ",name:"Svalbard",pattern:"",emoji:"🇸🇯"},{phoneCode:"268",code:"SZ",name:"Swaziland",pattern:"268 XXXX XXXX",emoji:"🇸🇿"},{phoneCode:"46",code:"SE",name:"Sweden",pattern:"46 XX XXX XXXX",emoji:"🇸🇪"},{phoneCode:"41",code:"CH",name:"Switzerland",pattern:"41 XX XXX XXXX",emoji:"🇨🇭"},{phoneCode:"963",code:"SY",name:"Syria",pattern:"",emoji:"🇸🇾"},{phoneCode:"886",code:"TW",name:"Taiwan",pattern:"",emoji:"🇹🇼"},{phoneCode:"992",code:"TJ",name:"Tajikistan",pattern:"",emoji:"🇹🇯"},{phoneCode:"255",code:"TZ",name:"Tanzania",pattern:"255 XX XXX XXXX",emoji:"🇹🇿"},{phoneCode:"66",code:"TH",name:"Thailand",pattern:"66 X XXXX XXXX",emoji:"🇹🇭"},{phoneCode:"228",code:"TG",name:"Togo",pattern:"228 XX XXX XXX",emoji:"🇹🇬"},{phoneCode:"690",code:"TK",name:"Tokelau",pattern:"",emoji:"🇹🇰"},{phoneCode:"676",code:"TO",name:"Tonga",pattern:"",emoji:"🇹🇴"},{phoneCode:"1 868",code:"TT",name:"Trinidad & Tobago",pattern:"1868 XXX XXXX",emoji:"🇹🇹"},{phoneCode:"216",code:"TN",name:"Tunisia",pattern:"216 XX XXX XXX",emoji:"🇹🇳"},{phoneCode:"90",code:"TR",name:"Turkey",pattern:"90 XXX XXX XXXX",emoji:"🇹🇷"},{phoneCode:"993",code:"TM",name:"Turkmenistan",pattern:"993 XX XXXXXX",emoji:"🇹🇲"},{phoneCode:"1 649",code:"TC",name:"Turks & Caicos Islands",pattern:"1649 XXX XXXX",emoji:"🇹🇨"},{phoneCode:"688",code:"TV",name:"Tuvalu",pattern:"",emoji:"🇹🇻"},{phoneCode:"256",code:"UG",name:"Uganda",pattern:"256 XX XXX XXXX",emoji:"🇺🇬"},{phoneCode:"380",code:"UA",name:"Ukraine",pattern:"380 XX XXX XX XX",emoji:"🇺🇦"},{phoneCode:"971",code:"AE",name:"United Arab Emirates",pattern:"971 XX XXX XXXX",emoji:"🇦🇪"},{phoneCode:"44",code:"GB",name:"United Kingdom",pattern:"44 XXXX XXXXXX",emoji:"🇬🇧"},{phoneCode:"1",code:"US",name:"United States",pattern:"1 XXX XXX XXXX",emoji:"🇺🇸"},{phoneCode:"598",code:"UY",name:"Uruguay",pattern:"598 XXXX XXXX",emoji:"🇺🇾"},{phoneCode:"1 340",code:"VI",name:"U.S. Virgin Islands",pattern:"1340 XXX XXXX",emoji:"🇻🇮"},{phoneCode:"998",code:"UZ",name:"Uzbekistan",pattern:"998 XX XXXXXXX",emoji:"🇺🇿"},{phoneCode:"678",code:"VU",name:"Vanuatu",pattern:"",emoji:"🇻🇺"},{phoneCode:"58",code:"VE",name:"Venezuela",pattern:"58 XXX XXX XXXX",emoji:"🇻🇪"},{phoneCode:"39 06 698",code:"VA",name:"Vatican City",pattern:"",emoji:"🇻🇦"},{phoneCode:"84",code:"VN",name:"Vietnam",pattern:"",emoji:"🇻🇳"},{phoneCode:"681",code:"WF",name:"Wallis & Futuna",pattern:"",emoji:"🇼🇫"},{phoneCode:"967",code:"YE",name:"Yemen",pattern:"967 XXX XXX XXX",emoji:"🇾🇪"},{phoneCode:"260",code:"ZM",name:"Zambia",pattern:"260 XX XXX XXXX",emoji:"🇿🇲"},{phoneCode:"255",code:"",name:"Zanzibar",pattern:"",emoji:""},{phoneCode:"263",code:"ZW",name:"Zimbabwe",pattern:"263 XX XXX XXXX",emoji:"🇿🇼"}],n={1:a.find(e=>"United States"===e.name),44:a.find(e=>"United Kingdom"===e.name),61:a.find(e=>"Australia"===e.name),64:a.find(e=>"New Zealand"===e.name),246:a.find(e=>"Diego Garcia"===e.name),255:a.find(e=>"Tanzania"===e.name),262:a.find(e=>"Reunion"===e.name),500:a.find(e=>"Falkland Islands"===e.name),590:a.find(e=>"Guadeloupe"===e.name),672:a.find(e=>"Norfolk Island"===e.name),"1 268":a.find(e=>"Antigua & Barbuda"===e.name)};i.a.Countries=a,t.b=a},function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"d",(function(){return c})),s.d(t,"b",(function(){return h})),s.d(t,"c",(function(){return p}));var i=s(17),a=s(24);class n{constructor(e){this.items=new Map,this.locked=!1,this.observer=new IntersectionObserver(t=>{if(this.locked)return;const s=[];t.forEach(e=>{const t=e.target;this.items.get(t)!==e.isIntersecting&&(this.items.set(t,e.isIntersecting),s[e.isIntersecting?"unshift":"push"]({target:t,visible:e.isIntersecting}))}),s.forEach(t=>{e(t.target,t.visible)})})}getVisible(){const e=[];return this.items.forEach((t,s)=>{t&&e.push(s)}),e}clearVisible(){const e=this.getVisible();for(const t of e)this.items.set(t,!1)}isVisible(e){return this.items.get(e)}disconnect(){this.observer.disconnect(),this.items.clear()}refresh(){this.observer.disconnect();const e=[...this.items.keys()];for(const t of e)this.observer.observe(t)}refreshVisible(){const e=this.getVisible();for(const t of e)this.observer.unobserve(t);for(const t of e)this.observer.observe(t)}observe(e){this.items.set(e,!1),this.observer.observe(e)}unobserve(e){this.observer.unobserve(e),this.items.delete(e)}unlock(){this.locked=!1}unlockAndRefresh(){this.unlock(),this.refresh()}lock(){this.locked=!0}}var o=s(53),r=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class d{constructor(e=8){this.parallelLimit=e,this.queueId=0,this.queue=[],this.inProcess=new Set,this.lockPromise=null,this.unlockResolve=null,this.log=Object(a.b)("LL",a.a.Error),this.processQueue=Object(i.e)(()=>this._processQueue(),20,!1)}clear(){this.inProcess.clear(),this.queue.length=0}lock(){this.lockPromise||(this.lockPromise=new Promise((e,t)=>{this.unlockResolve=e}))}unlock(){this.unlockResolve&&(this.unlockResolve(),this.unlockResolve=this.lockPromise=null,this.processQueue())}processItem(e){return r(this,void 0,void 0,(function*(){if(!this.lockPromise){this.inProcess.add(e);try{yield this.loadItem(e)}catch(e){["NO_ENTRY_FOUND","STORAGE_OFFLINE"].includes(e)||this.log.error("loadMediaQueue error:",e)}this.inProcess.delete(e),this.processQueue()}}))}loadItem(e){return e.load()}getItem(){return this.queue.shift()}addElement(e,t){this.queue[e](t),this.processQueue()}_processQueue(e){if(!this.queue.length||this.lockPromise||this.parallelLimit>0&&this.inProcess.size>=this.parallelLimit)return;do{if(e?this.queue.findAndSplice(t=>t===e):e=this.getItem(),!e)break;this.processItem(e),e=null}while(this.inProcess.size<this.parallelLimit&&this.queue.length)}push(e){this.addElement("push",e)}unshift(e){this.addElement("unshift",e)}}class l extends d{constructor(e=8){super(e),this.parallelLimit=e,this.queue=[],this.inProcess=new Set}lock(){super.lock(),this.intersector.lock()}unlock(){super.unlock(),this.intersector.unlock()}unlockAndRefresh(){super.unlock(),this.intersector.unlockAndRefresh()}clear(){super.clear(),this.intersector.disconnect()}refresh(){this.intersector.refresh()}loadItem(e){return e.load(e.div)}addElement(e,t){if(this.queue.find(e=>e.div===t.div&&e.load===t.load))return!1;for(const e of this.inProcess)if(e.div===t.div&&e.load===t.load)return!1;return this.queue[e](t),!0}setProcessQueueTimeout(){this.intersectorTimeout||(this.intersectorTimeout=window.setTimeout(()=>{this.intersectorTimeout=0,this.processQueue()},0))}push(e){super.push(e)}unshift(e){super.unshift(e)}unobserve(e){Object(o.b)(this.queue,t=>t.div===e),this.intersector.unobserve(e)}}class c extends l{constructor(e=8){super(e),this.parallelLimit=e,this.onVisibilityChange=(e,t)=>{t&&(Object(o.b)(this.queue,t=>t.div===e).forEach(e=>{e.wasSeen=!0,this.queue.unshift(e)}),this.setProcessQueueTimeout())},this.intersector=new n(this.onVisibilityChange)}getItem(){return this.queue.findAndSplice(e=>e.wasSeen)}processItem(e){const t=Object.create(null,{processItem:{get:()=>super.processItem}});return r(this,void 0,void 0,(function*(){yield t.processItem.call(this,e),this.intersector.unobserve(e.div)}))}addElement(e,t){return!!super.addElement(e,t)&&(this.intersector.observe(t.div),t.hasOwnProperty("wasSeen")||(t.wasSeen=!1),!0)}}class h extends l{constructor(e=8,t){super(e),this.parallelLimit=e,this.onVisibilityChange=t,this._queue=new Map,this.intersector=new n((e,t)=>{const s=Object(o.b)(this.queue,t=>t.div===e);if(t){(s.length?s:[this._queue.get(e)]).forEach(t=>{this.queue.unshift(t||this._queue.get(e))})}this.onVisibilityChange&&this.onVisibilityChange(e,t),this.setProcessQueueTimeout()})}clear(){super.clear(),this._queue.clear()}observe(e){this._queue.set(e.div,e),this.intersector.observe(e.div)}}class p extends l{constructor(e=8,t){super(e),this.parallelLimit=e,this.onVisibilityChange=t,this.intersector=new n((e,t)=>{const s=Object(o.b)(this.queue,t=>t.div===e);t&&s.length&&s.forEach(e=>{this.queue.unshift(e)}),this.onVisibilityChange&&this.onVisibilityChange(e,t),this.setProcessQueueTimeout()})}observe(e){this.intersector.observe(e)}}},,,function(e,t,s){"use strict";var i=s(99),a=s(9),n=s(26),o=s(28),r=s(15),d=s(61),l=s(0),c=s(11),h=s(13),p=s(111),u=s(10),g=s(66),m=s(52),f=s(32),v=s(30),X=s(101),_=s(21),y=s(20);const b=new class{constructor(){this.notificationsShown={},this.notificationIndex=0,this.notificationsCount=0,this.soundsPlayed={},this.vibrateSupport=!!navigator.vibrate,this.peerSettings={notifyPeer:{},notifyUsers:null,notifyChats:null,notifyBroadcasts:null},this.faviconEl=document.head.querySelector('link[rel="icon"]'),this.titleBackup=document.title,this.titleChanged=!1,this.stopped=!1,this.settings={},this.pushInited=!1,this.updateLocalSettings=()=>{Promise.all(["notify_nodesktop","notify_volume","notify_novibrate","notify_nopreview","notify_nopush"].map(e=>g.a.get(e))).then(e=>{if(this.settings.nodesktop=e[0],this.settings.volume=void 0===e[1]?.5:e[1],this.settings.novibrate=e[2],this.settings.nopreview=e[3],this.settings.nopush=e[4],this.pushInited){const e=!this.settings.nopush&&!this.settings.nodesktop&&p.default.isAvailable||!1;e!==(!1!==this.registeredDevice)&&(e?p.default.subscribe():p.default.unsubscribe())}p.default.setSettings(this.settings)}),_.default.getState().then(e=>{this.settings.nosound=!e.settings.notifications.sound})},this.requestPermission=()=>{Notification.requestPermission(),window.removeEventListener("click",this.requestPermission)},navigator.vibrate=navigator.vibrate||navigator.mozVibrate||navigator.webkitVibrate,this.notificationsUiSupport="Notification"in window||"mozNotification"in navigator,this.topMessagesDeferred=Object(n.a)(),this.notifySoundEl=document.createElement("div"),this.notifySoundEl.id="notify-sound",document.body.append(this.notifySoundEl),u.default.addEventListener("instance_deactivated",()=>{this.stop()}),u.default.addEventListener("instance_activated",()=>{this.stopped&&this.start()}),u.default.addEventListener("idle",e=>{this.stopped||(e||this.clear(),this.toggleToggler())}),u.default.addMultipleEventsListeners({updateNotifySettings:e=>{this.savePeerSettings("notifyPeer"===e.peer._?v.a.getPeerId(e.peer.peer):e.peer._,e.notify_settings),u.default.dispatchEvent("notify_settings",e)}}),u.default.addEventListener("push_init",e=>{this.pushInited=!0,this.settings.nodesktop||this.settings.nopush?this.unregisterDevice(e):e?this.registerDevice(e):p.default.subscribe()}),u.default.addEventListener("push_subscribe",e=>{this.registerDevice(e)}),u.default.addEventListener("push_unsubscribe",e=>{this.unregisterDevice(e)}),u.default.addEventListener("dialogs_multiupdate",()=>{this.topMessagesDeferred.resolve()},!0),u.default.addEventListener("push_notification_click",e=>{if("push_settings"===e.action)return;if("mute1d"===e.action)return void h.a.invokeApi("account.updateDeviceLocked",{period:86400}).then(()=>{});const t=e.custom&&+e.custom.peerId;console.log("click",e,t),t&&this.topMessagesDeferred.then(()=>{e.custom.channel_id&&!f.a.hasChat(+e.custom.channel_id)||t>0&&!y.a.hasUser(t)||u.default.dispatchEvent("history_focus",{peerId:t,mid:+e.custom.msg_id})})})}toggleToggler(e=u.default.idle.isIDLE){if(l.isMobile)return;const t=()=>{this.titleChanged=!1,document.title=this.titleBackup,this.setFavicon()};window.clearInterval(this.titleInterval),this.titleInterval=0,e?this.titleInterval=window.setInterval(()=>{if(this.notificationsCount)if(this.titleChanged)t();else{this.titleChanged=!0,document.title=c.default.format("Notifications.Count",!0,[this.notificationsCount]);const e=document.createElement("canvas");e.width=32*window.devicePixelRatio,e.height=e.width;const t=e.getContext("2d");t.beginPath(),t.arc(e.width/2,e.height/2,e.width/2,0,2*Math.PI,!1),t.fillStyle="#3390ec",t.fill();let s=24,a=""+this.notificationsCount;this.notificationsCount<10?s=22:this.notificationsCount<100?s=20:(a="99+",s=16),s*=window.devicePixelRatio,t.font=`700 ${s}px ${i.a}`,t.textBaseline="middle",t.textAlign="center",t.fillStyle="white",t.fillText(a,e.width/2,.5625*e.height),this.setFavicon(e.toDataURL())}else this.toggleToggler(!1)},1e3):t()}getLocalSettings(){return this.settings}getNotifySettings(e){let t=Object(d.b)(e._),s=this.peerSettings[t];return"inputNotifyPeer"===e._&&(t=v.a.getPeerId(e.peer),s=s[t]),s||((s||this.peerSettings)[t]=h.a.invokeApi("account.getNotifySettings",{peer:e}).then(e=>(this.savePeerSettings(t,e),e)))}getNotifyPeerTypeSettings(){if(this.getNotifyPeerTypePromise)return this.getNotifyPeerTypePromise;const e=["inputNotifyBroadcasts","inputNotifyUsers","inputNotifyChats"].map(e=>this.getNotifySettings({_:e}));return this.getNotifyPeerTypePromise=Promise.all(e)}updateNotifySettings(e,t){return h.a.invokeApi("account.updateNotifySettings",{peer:e,settings:t}).then(s=>{s&&m.a.processUpdateMessage({_:"updateShort",update:{_:"updateNotifySettings",peer:Object.assign(Object.assign({},e),{_:Object(d.b)(e._)}),notify_settings:Object.assign(Object.assign({},t),{_:"peerNotifySettings"})}})})}getNotifyExceptions(){h.a.invokeApi("account.getNotifyExceptions",{compare_sound:!0}).then(e=>{m.a.processUpdateMessage(e)})}getContactSignUpNotification(){return this.notifyContactsSignUp?this.notifyContactsSignUp:this.notifyContactsSignUp=h.a.invokeApi("account.getContactSignUpNotification")}setContactSignUpNotification(e){h.a.invokeApi("account.setContactSignUpNotification",{silent:e}).then(t=>{this.notifyContactsSignUp=Promise.resolve(!e)})}setFavicon(e="assets/img/favicon.ico"){if(this.prevFavicon===e)return;const t=this.faviconEl.cloneNode();t.href=e,this.faviconEl.parentNode.replaceChild(t,this.faviconEl),this.faviconEl=t,this.prevFavicon=e}savePeerSettings(e,t){let s;"number"==typeof e&&(s=this.peerSettings.notifyPeer),(s||this.peerSettings)[e]=t,"number"!=typeof e&&u.default.dispatchEvent("notify_peer_type_settings",{key:e,settings:t})}isMuted(e){return"peerNotifySettings"===e._&&(1e3*e.mute_until>Object(o.h)()||e.silent)}getPeerMuted(e){const t=this.getNotifySettings({_:"inputNotifyPeer",peer:v.a.getInputPeerById(e)});return(t instanceof Promise?t:Promise.resolve(t)).then(e=>this.isMuted(e))}getPeerLocalSettings(e,t=!0){const s={_:"peerNotifySettings"},i=this.peerSettings.notifyPeer[e];if(!i||i instanceof Promise||Object.assign(s,i),t){const t=v.a.getInputNotifyPeerById(e,!0),i=Object(d.b)(t._),a=this.peerSettings[i];if(a&&!(a instanceof Promise))for(let e in a)void 0===s[e]&&(s[e]=a[e])}return s}isPeerLocalMuted(e,t=!0){if(e===u.default.myId)return!1;const s=this.getPeerLocalSettings(e,t);return this.isMuted(s)}start(){if(this.updateLocalSettings(),u.default.addEventListener("settings_updated",this.updateLocalSettings),p.default.start(),!this.notificationsUiSupport)return!1;"Notification"in window&&"granted"!==Notification.permission&&"denied"!==Notification.permission&&window.addEventListener("click",this.requestPermission);try{"onbeforeunload"in window&&window.addEventListener("beforeunload",this.clear)}catch(e){}}stop(){this.clear(),window.clearInterval(this.titleInterval),this.titleInterval=0,this.setFavicon(),this.stopped=!0}notify(e){if(this.stopped)return;e.image||(e.image="assets/img/logo_filled_rounded.png"),this.notificationsCount++,this.titleInterval||this.toggleToggler();const t=Object(o.h)();if(this.settings.volume>0&&!this.settings.nosound&&(this.testSound(this.settings.volume),this.soundsPlayed[e.tag]=t),!this.notificationsUiSupport||"Notification"in window&&"granted"!==Notification.permission)return!1;if(this.settings.nodesktop)return this.vibrateSupport&&!this.settings.novibrate?void navigator.vibrate([200,100,200]):void 0;const s=++this.notificationIndex,i=e.key||"k"+s;let a;if("Notification"in window){try{if(e.tag)for(let t in this.notificationsShown){const s=this.notificationsShown[t];s&&s.tag===e.tag&&(s.hidden=!0)}a=new Notification(e.title,{icon:e.image||"",body:e.message||"",tag:e.tag||"",silent:e.silent||!1})}catch(e){return this.notificationsUiSupport=!1,void p.default.setLocalNotificationsDisabled()}a.onclick=()=>{a.close(),X.a.focus(),this.clear(),e.onclick&&e.onclick()},a.onclose=()=>{a.hidden||(delete this.notificationsShown[i],this.clear())},a.show&&a.show(),this.notificationsShown[i]=a,l.isMobile||setTimeout(()=>{this.hide(i)},8e3)}}testSound(e){const t=Object(o.h)();if(this.nextSoundAt&&t<this.nextSoundAt&&this.prevSoundVolume===e)return;this.nextSoundAt=t+1e3,this.prevSoundVolume=e;const s="assets/audio/notification.mp3",i=document.createElement("audio");i.autoplay=!0,i.setAttribute("mozaudiochannel","notification"),i.volume=e,i.innerHTML=`\n      <source src="${s}" type="audio/mpeg" />\n      <embed hidden="true" autostart="true" loop="false" volume="${100*e}" src="${s}" />\n    `,this.notifySoundEl.append(i),i.addEventListener("ended",()=>{i.remove()},{once:!0})}cancel(e){const t=this.notificationsShown[e];if(t){this.notificationsCount>0&&this.notificationsCount--;try{t.close&&(t.hidden=!0,t.close())}catch(e){}delete this.notificationsShown[e]}}hide(e){const t=this.notificationsShown[e];if(t)try{t.close&&(t.hidden=!0,t.close())}catch(e){}}soundReset(e){delete this.soundsPlayed[e]}clear(){for(let e in this.notificationsShown){const t=this.notificationsShown[e];try{t.close&&t.close()}catch(e){}}this.notificationsShown={},this.notificationsCount=0,p.default.hidePushNotifications()}registerDevice(e){if(this.registeredDevice&&Object(r.b)(this.registeredDevice,e))return!1;h.a.invokeApi("account.registerDevice",{token_type:e.tokenType,token:e.tokenValue,other_uids:[],app_sandbox:!1,secret:new Uint8Array}).then(()=>{this.registeredDevice=e},e=>{e.handled=!0})}unregisterDevice(e){if(!this.registeredDevice)return!1;h.a.invokeApi("account.unregisterDevice",{token_type:e.tokenType,token:e.tokenValue,other_uids:[]}).then(()=>{this.registeredDevice=!1},e=>{e.handled=!0})}getVibrateSupport(){return this.vibrateSupport}};a.a.appNotificationsManager=b,t.a=b},,function(e,t,s){"use strict";var i=s(10);t.a=(e,t,s,a,n)=>{const o=e.dataset.timeout;void 0!==o&&clearTimeout(+o),s&&t&&e.classList.add(t);const r=()=>{delete e.dataset.timeout,!s&&t&&e.classList.remove("backwards",t),e.classList.remove("animating"),n&&n()};if(!i.default.settings.animationsEnabled)return e.classList.remove("animating","backwards"),void r();e.classList.add("animating"),e.classList.toggle("backwards",!s),e.dataset.timeout=""+setTimeout(r,a)}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s(23);function a(e,t,s,a,n=!0){if(e<s&&t<a&&n)return Object(i.c)(e,t);let o=s,r=a;return e/t>s/a?r=t*s/e|0:(o=e*a/t|0,o>s&&(r=r*s/o|0,o=s)),n&&o>=e&&r>=t&&(o=e,r=t),Object(i.c)(o,r)}s(9).a.calcImageInBox=a},function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s(11);class a{constructor(e){this.element=document.body.querySelector("."+e.className),this.container=document.createElement("div"),this.container.className="container center-align",this.imageDiv=document.createElement("div"),this.imageDiv.className="auth-image",this.title=document.createElement("h4"),e.titleLangKey&&this.title.append(Object(i.i18n)(e.titleLangKey)),this.subtitle=document.createElement("p"),this.subtitle.className="subtitle",e.subtitleLangKey&&this.subtitle.append(Object(i.i18n)(e.subtitleLangKey)),this.container.append(this.imageDiv,this.title,this.subtitle),e.withInputWrapper&&(this.inputWrapper=document.createElement("div"),this.inputWrapper.className="input-wrapper",this.container.append(this.inputWrapper)),this.element.append(this.container)}}},function(e,t,s){"use strict";var i=s(29),a=s(63),n=s(15),o=s(9),r=s(13);const d=new class{constructor(){this.contexts=new Map,this.links={},r.a.addTaskListener("requestFilePart",e=>{if(e.error){const t=s=>{if("FILE_REFERENCE_EXPIRED"===(null==s?void 0:s.type)){const s=e.originalPayload[1].file_reference;d.refreshReference(s).then(()=>{e.originalPayload[1].file_reference=d.getReferenceByLink(s);const t={type:e.type,id:e.id,payload:e.originalPayload};r.a.postMessage(t)}).catch(t)}else navigator.serviceWorker.controller.postMessage(e)};t(e.error)}else navigator.serviceWorker.controller.postMessage(e)})}saveContext(e,t,s){[s,e]=this.getContexts(e),s||(s=new Set,this.contexts.set(e,s),this.links[Object(a.e)(e)]=e);for(const e of s)if(Object(n.b)(e,t))return;s.add(t)}getReferenceByLink(e){return this.links[Object(a.e)(e)]}getContexts(e){return[this.contexts.get(e)||(e=this.getReferenceByLink(e)||e,this.contexts.get(e)),e]}getContext(e){const t=this.getContexts(e);return t?[t[0].values().next().value,t[1]]:void 0}deleteContext(e,t,s){if([s,e]=this.getContexts(e),s)for(const i of s)if(Object(n.b)(i,t))return s.delete(i),s.size||(this.contexts.delete(e),delete this.links[Object(a.e)(e)]),!0;return!1}refreshReference(e,t){switch([t,e]=this.getContext(e),null==t?void 0:t.type){case"message":return i.a.wrapSingleMessage(t.peerId,t.messageId,!0);default:return console.warn("FILE_REFERENCE_EXPIRED: not implemented context",t),Promise.reject()}}};o.a.referenceDatabase=d,t.a=d},function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s(70),a=s(17),n=s(15),o=s(12),r=s(14),d=s(40);class l{constructor(e){this.tempId=0,this.detached=!0,this.promise=null,this.isUpload=!1,this.cancelable=!0,this.streamable=!1,this.tryAgainOnFail=!0,this.attachMethod="append",this.onClick=e=>{e&&Object(o.a)(e),this.preloader.classList.contains("manual")?this.loadFunc&&this.loadFunc():this.promise&&this.promise.cancel&&this.promise.cancel()},e&&Object(n.g)(this,e)}constructContainer(e={}){this.preloader||(this.preloader=document.createElement("div"),this.preloader.classList.add("preloader-container"),e.color&&this.preloader.classList.add("preloader-"+e.color),e.bold&&this.preloader.classList.add("preloader-bold"),this.streamable&&this.preloader.classList.add("preloader-streamable"))}constructDownloadIcon(){this.constructContainer()}construct(){this.construct=null,this.constructContainer(),this.preloader.innerHTML=`\n    <div class="you-spin-me-round">\n    <svg xmlns="http://www.w3.org/2000/svg" class="preloader-circular" viewBox="${this.streamable?"25 25 50 50":"27 27 54 54"}">\n    <circle class="preloader-path-new" cx="${this.streamable?"50":"54"}" cy="${this.streamable?"50":"54"}" r="${this.streamable?19:24}" fill="none" stroke-miterlimit="10"/>\n    </svg>\n    </div>`,this.cancelable?(this.preloader.innerHTML+='\n      <svg xmlns="http://www.w3.org/2000/svg" class="preloader-close" viewBox="0 0 24 24">\n        <g fill="none" fill-rule="evenodd">\n          <polygon points="0 0 24 0 24 24 0 24"/>\n          <path fill="#000" fill-rule="nonzero" d="M5.20970461,5.38710056 L5.29289322,5.29289322 C5.65337718,4.93240926 6.22060824,4.90467972 6.61289944,5.20970461 L6.70710678,5.29289322 L12,10.585 L17.2928932,5.29289322 C17.6834175,4.90236893 18.3165825,4.90236893 18.7071068,5.29289322 C19.0976311,5.68341751 19.0976311,6.31658249 18.7071068,6.70710678 L13.415,12 L18.7071068,17.2928932 C19.0675907,17.6533772 19.0953203,18.2206082 18.7902954,18.6128994 L18.7071068,18.7071068 C18.3466228,19.0675907 17.7793918,19.0953203 17.3871006,18.7902954 L17.2928932,18.7071068 L12,13.415 L6.70710678,18.7071068 C6.31658249,19.0976311 5.68341751,19.0976311 5.29289322,18.7071068 C4.90236893,18.3165825 4.90236893,17.6834175 5.29289322,17.2928932 L10.585,12 L5.29289322,6.70710678 C4.93240926,6.34662282 4.90467972,5.77939176 5.20970461,5.38710056 L5.29289322,5.29289322 L5.20970461,5.38710056 Z"/>\n        </g>\n      </svg>\n      <svg xmlns="http://www.w3.org/2000/svg" class="preloader-download" viewBox="0 0 24 24">\n        <g fill="none" fill-rule="evenodd">\n          <polygon points="0 0 24 0 24 24 0 24"/>\n          <path fill="#000" fill-rule="nonzero" d="M5,19 L19,19 C19.5522847,19 20,19.4477153 20,20 C20,20.5128358 19.6139598,20.9355072 19.1166211,20.9932723 L19,21 L5,21 C4.44771525,21 4,20.5522847 4,20 C4,19.4871642 4.38604019,19.0644928 4.88337887,19.0067277 L5,19 L19,19 L5,19 Z M11.8833789,3.00672773 L12,3 C12.5128358,3 12.9355072,3.38604019 12.9932723,3.88337887 L13,4 L13,13.585 L16.2928932,10.2928932 C16.6533772,9.93240926 17.2206082,9.90467972 17.6128994,10.2097046 L17.7071068,10.2928932 C18.0675907,10.6533772 18.0953203,11.2206082 17.7902954,11.6128994 L17.7071068,11.7071068 L12.7071068,16.7071068 C12.3466228,17.0675907 11.7793918,17.0953203 11.3871006,16.7902954 L11.2928932,16.7071068 L6.29289322,11.7071068 C5.90236893,11.3165825 5.90236893,10.6834175 6.29289322,10.2928932 C6.65337718,9.93240926 7.22060824,9.90467972 7.61289944,10.2097046 L7.70710678,10.2928932 L11,13.585 L11,4 C11,3.48716416 11.3860402,3.06449284 11.8833789,3.00672773 L12,3 L11.8833789,3.00672773 Z"/>\n        </g>\n      </svg>',this.downloadSvg=this.preloader.lastElementChild,this.cancelSvg=this.downloadSvg.previousElementSibling):this.preloader.classList.add("preloader-swing"),this.circle=this.preloader.firstElementChild.firstElementChild.firstElementChild,this.cancelable&&Object(r.b)(this.preloader,this.onClick)}setDownloadFunction(e){this.loadFunc=e}setManual(){this.preloader.classList.add("manual"),this.setProgress(0)}attachPromise(e){if(this.isUpload&&this.promise)return;this.promise=e;const t=--this.tempId,s=Date.now(),n=n=>{if(e.notify=null,t!==this.tempId)return;const o=Date.now()-s;if(!n&&this.cancelable){this.setProgress(100);const e=150;o<e?this.detach():setTimeout(()=>{t===this.tempId&&this.detach()},e)}else this.tryAgainOnFail?(Object(i.a)(this.preloader,"",!0,200),Object(a.c)(()=>{this.setManual()})):this.detach();this.promise=e=null};e.then(()=>n(null)).catch(e=>n(e)),e.addNotifyListener&&e.addNotifyListener(e=>{if(t!==this.tempId)return;const s=e.done/e.total*100;this.setProgress(s)})}attach(e,t=!1,s){s&&this.attachPromise(s),this.detached=!1,this.construct&&this.construct(),this.preloader.parentElement&&this.preloader.classList.remove("manual"),this.preloader.parentElement!==e&&e[this.attachMethod](this.preloader),Object(a.c)(()=>{this.detached||Object(i.a)(this.preloader,"is-visible",!0,200)}),this.cancelable&&t&&this.setProgress(0)}detach(){this.detached=!0,this.preloader&&this.preloader.parentElement&&Object(a.c)(()=>{this.detached&&this.preloader.parentElement&&Object(i.a)(this.preloader,"is-visible",!1,200,()=>{this.preloader.remove()})})}setProgress(e){if(Object(d.a)(this.circle))if(0!==e)try{this.totalLength||(this.totalLength=this.circle.getTotalLength()),this.circle.style.strokeDasharray=Math.max(5,e/100*this.totalLength)+", "+this.totalLength}catch(e){}else this.circle.style.strokeDasharray=""}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return a}));function i(e,t){const s=""["".length-1]||"";let i;switch(e._){case"inputPhotoFileLocation":i=["photo",""[0],e.id,e.thumb_size].filter(Boolean).join("_");break;case"inputDocumentFileLocation":i=["document",""[0],e.id,e.thumb_size].filter(Boolean).join("_");break;case"inputPeerPhotoFileLocation":i=["peerPhoto",e.photo_id,e.pFlags.big?"big":"small"].join("_");break;case"inputStickerSetThumb":i=["stickerSetThumb",e.stickerset.id||e.stickerset.short_name||e.stickerset.emoticon||e.stickerset._,e.thumb_version].join("_");break;case"inputFileLocation":i=e.volume_id+"_"+e.local_id;break;default:console.error("Unrecognized location:",e),i=""}return i+(s?"."+s:s)}function a(e,t){return"/"+e+"/"+encodeURIComponent(JSON.stringify(t))}},function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var i=s(51),a=s(60),n=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};var o=new class{constructor(){this.blobSupported=!0;try{Object(a.a)([],"")}catch(e){this.blobSupported=!1}}isAvailable(){return this.blobSupported}write(e,t){return t instanceof Blob?new Promise((s,i)=>{let a=new FileReader;a.onload=function(t){let a=t.target.result,n=new Uint8Array(a);e.write(n).then(s,i)},a.readAsArrayBuffer(t)}):e.write(t)}getFakeFileWriter(e,t){const s=[];return{write:e=>n(this,void 0,void 0,(function*(){if(!this.blobSupported)throw!1;s.push(e)})),truncate:()=>{s.length=0},finalize:(i=!0)=>{const n=Object(a.a)(s,e);return i&&t&&t(n),n}}}},r=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};class d{constructor(e){this.dbName=e,this.useStorage=!0,i.a.test&&(this.dbName+="_test"),d.STORAGES.length&&(this.useStorage=d.STORAGES[0].useStorage),this.openDatabase(),d.STORAGES.push(this)}openDatabase(){return this.openDbPromise?this.openDbPromise:this.openDbPromise=caches.open(this.dbName)}delete(e){return this.timeoutOperation(t=>t.delete("/"+e))}deleteAll(){return caches.delete(this.dbName)}save(e,t){return this.useStorage?this.timeoutOperation(s=>s.put("/"+e,t)):Promise.reject("STORAGE_OFFLINE")}saveFile(e,t){if(!this.useStorage)return Promise.reject("STORAGE_OFFLINE");t instanceof Blob||(t=Object(a.a)(t));const s=new Response(t,{headers:{"Content-Length":""+t.size}});return this.save(e,s).then(()=>t)}getFile(e,t="blob"){return this.useStorage?this.timeoutOperation(s=>r(this,void 0,void 0,(function*(){const i=yield s.match("/"+e);if(!i||!s)throw"NO_ENTRY_FOUND";return i[t]()}))):Promise.reject("STORAGE_OFFLINE")}timeoutOperation(e){return new Promise((t,s)=>r(this,void 0,void 0,(function*(){let i=!1;const a=setTimeout(()=>{s(),i=!0},15e3);try{const s=yield this.openDatabase();if(!s)throw"no cache?";const a=yield e(s);if(i)return;t(a)}catch(e){s(e)}clearTimeout(a)})))}getFileWriter(e,t){const s=o.getFakeFileWriter(t,t=>this.saveFile(e,t).catch(()=>t));return Promise.resolve(s)}static toggleStorage(e){return Promise.all(this.STORAGES.map(t=>{if(t.useStorage=e,!e)return t.deleteAll()}))}}d.STORAGES=[]},function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s(79),a=s(10),n=s(17),o=s(43),r=s(90),d=s(47);function l(e,t,s,l,c=250,h){const p=Object(i.a)(t,e||"tabs"===t.dataset.animation?"tabs":"navigation",c,l);if(e){const i=new Proxy(p,{apply:(t,s,i)=>{const a=+i[0],n=void 0===i[1]||i[1],o=e.querySelector(`[data-tab="${a}"]`)||e.children[a];l(o,a,n)}}),l=(i,r,d=!0)=>{const l=t.children[r];if(s){const e=s(r,l,d);if(void 0!==e&&!e)return}h&&h.scrollIntoViewNew(i.parentElement.children[r],"center",void 0,void 0,d?void 0:o.a.Static,c,"x"),a.default.settings.animationsEnabled||(d=!1);const m=p.prevId();if(i.classList.contains("active")||r===m)return!1;const f=e.querySelector(g.toLowerCase()+".active");Object(n.c)(()=>{f&&f.classList.remove("active")}),u&&-1!==m&&d&&Object(n.c)(()=>{const e=i.querySelector("i"),t=i.parentElement.children[m].querySelector("i");t.classList.remove("animate"),e.classList.remove("animate");const s=t.parentElement.parentElement.offsetLeft-e.parentElement.parentElement.offsetLeft,a=t.clientWidth/e.clientWidth;e.style.transform=`translate3d(${s}px, 0, 0) scale3d(${a}, 1, 1)`,requestAnimationFrame(()=>{e.classList.add("animate"),e.style.transform="none"})}),Object(n.c)(()=>{i.classList.add("active")}),p(r,d)},u=!e.classList.contains("no-stripe"),g=e.firstElementChild.tagName;return e.addEventListener("click",(function(t){let s,i=t.target;if(i=Object(r.a)(i,e),!i)return!1;if(i.dataset.tab){if(s=+i.dataset.tab,-1===s)return!1}else s=Object(d.a)(i);l(i,s)})),i}return p}},function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var i=s(10),a=s(26),n=s(39),o=s(47),r=s(1),d=s(0);function l(e,t,s){const i=t.getBoundingClientRect().width,a=[e,t];return s&&a.reverse(),a[0].style.filter="brightness(80%)",a[0].style.transform=`translate3d(${.25*-i}px, 0, 0)`,a[1].style.transform=`translate3d(${i}px, 0, 0)`,e.classList.add("active"),e.offsetWidth,e.style.transform="",e.style.filter="",()=>{t.style.transform=t.style.filter=""}}function c(e,t,s){const i=Object(r.a)(e,"scrollable-y");i&&"hidden"!==i.style.overflowY&&(i.style.overflowY="hidden");const a=t.getBoundingClientRect().width,n=[e,t];return s&&n.reverse(),n[0].style.transform=`translate3d(${-a}px, 0, 0)`,n[1].style.transform=`translate3d(${a}px, 0, 0)`,e.classList.add("active"),e.offsetWidth,e.style.transform="",()=>{t.style.transform="",i&&(d.isSafari&&(i.style.display="none"),i.style.overflowY="",d.isSafari&&(i.offsetLeft,i.style.display=""))}}const h=(e,t,s,i,a=!0)=>{let n=null;switch(t){case"tabs":n=c;break;case"navigation":n=l}return e.dataset.animation=t,p(e,n,s,i,a)},p=(e,t,s,r,d=!0)=>{const l=new Map;let c,h=0,p=null;function u(g,m=!0){const f=u;g instanceof HTMLElement&&(g=Object(o.a)(g));const v=f.prevId();if(g===v)return!1;const X=p,_=e.children[g];if(i.default.settings.animationsEnabled&&-1!==v||(m=!1),!m)return X&&X.classList.remove("active","to","from"),_&&(_.classList.remove("to","from"),_.classList.add("active")),e.classList.remove("animating","backwards","disable-hover"),p=_,void(r&&r(g));p&&(p.classList.remove("to"),p.classList.add("from")),e.classList.add("animating","disable-hover");const y=v<g;let b;if(e.classList.toggle("backwards",!y),_&&(t?b=t(_,p,y):_.classList.add("active"),_.classList.remove("from"),_.classList.add("to")),_&&l.set(_,()=>{_.classList.remove("to"),l.delete(_)}),X){const e=()=>{X.classList.remove("active","from"),b&&b(),l.delete(X)};if(_)l.set(X,e);else{const t=window.setTimeout(e,s);l.set(X,()=>{clearTimeout(t)})}d&&(c||(c=Object(a.a)(),h=performance.now()),Object(n.b)(c,2*s))}p=_}return e.addEventListener(t?"transitionend":"animationend",t=>{if(t.target.parentElement!==e)return;const s=l.get(t.target);s&&s(),t.target===p&&(!c&&d||(c&&(c.resolve(),c=void 0),r&&r(u.prevId()),e.classList.remove("animating","backwards","disable-hover")))}),u.prevId=()=>p?Object(o.a)(p):-1,u}},,,function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r})),s.d(t,"d",(function(){return d})),s.d(t,"c",(function(){return l})),s.d(t,"e",(function(){return c}));var i=s(17),a=s(0),n=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};function o(e){return new Promise((t,s)=>{e.onseeked=()=>{const s=document.createElement("canvas");s.width=Math.min(1280,e.videoWidth),s.height=Math.min(720,e.videoHeight);s.getContext("2d").drawImage(e,0,0),s.toBlob(e=>{t(e)},"image/jpeg",1)},e.onerror=s,e.currentTime=Math.min(e.duration,1)})}function r(e){return n(this,void 0,void 0,(function*(){const t=yield function(e){return new Promise((t,s)=>{const i=document.createElement("video");i.volume=0,i.onloadedmetadata=()=>t(i),i.onerror=s,i.src=e})}(e);return Promise.race([Object(i.d)(2e3),o(t)])}))}function d(e){return new Promise(t=>{e.readyState>=e.HAVE_METADATA?t():e.addEventListener(a.isAppleMobile?"loadeddata":"canplay",()=>t(),{once:!0})})}function l(e,t=!1){return n(this,void 0,void 0,(function*(){const s=[],i=(e,a)=>n(this,void 0,void 0,(function*(){if(e.isDirectory){const t=e.createReader();yield new Promise((e,s)=>{t.readEntries(t=>n(this,void 0,void 0,(function*(){for(const e of t)yield i(e,a);e()})))})}else if(e)if(t)s.push(e.type);else{const t=a.getAsFile(),i=e instanceof File?e:e instanceof DataTransferItem?e.getAsFile():yield new Promise((s,i)=>e.file(s,e=>s(t)));if(!i)return;s.push(i)}}));if(e instanceof DragEvent&&e.dataTransfer.files&&!e.dataTransfer.items)for(let i=0;i<e.dataTransfer.files.length;i++){const a=e.dataTransfer.files[i];s.push(t?a.type:a)}else{const s=(e.dataTransfer||e.clipboardData||e.originalEvent.clipboardData).items,a=[];for(let e=0;e<s.length;++e){const n=s[e];if("file"===n.kind){const e=(t?n:n.webkitGetAsEntry())||n.getAsFile();a.push(i(e,n))}}yield Promise.all(a)}return s}))}function c(e){const t=document.createElement("input");t.type="file",t.style.display="none",e&&(t.accept=e),document.body.append(t);const s=new Promise((e,s)=>{t.addEventListener("change",t=>{const i=t.target.files[0];i?e(i):s("NO_FILE_SELECTED")},{once:!0})}).finally(()=>{t.remove()});return t.click(),s}},,function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r}));var i=s(17),a=s(26);const n=new Map;function o(e){const t=function(e){return n.get(e)}(e);t&&(t.isCancelled=!0,t.deferred.resolve())}function r(e,t,s){return s||(s=function(e){o(e);const t={isCancelled:!1,deferred:Object(a.a)()};return n.set(e,t),t.deferred.then(()=>{n.delete(e)}),t}(t)),Object(i.c)(()=>{s.isCancelled||(e()?r(e,t,s):s.deferred.resolve())}),s.deferred}},,,,function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return n}));var i,a=s(9);!function(e){e[e.None=0]="None",e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Both=3]="Both"}(i||(i={}));class n{constructor(){this.sliceConstructor=n.getSliceConstructor(this);const e=this.constructSlice();this.slices=[e]}static getSliceConstructor(e){return class extends Array{constructor(){super(...arguments),this.end=i.None}isEnd(t){if((this.end&t)===t)return!0;let s=!1;if(t===i.Top){const i=e.last;s=!!(i.end&t)&&this.includes(i[i.length-1])}else if(t===i.Bottom){const i=e.first;s=!!(i.end&t)&&this.includes(i[0])}else if(t===i.Both)return this.isEnd(i.Top)&&this.isEnd(i.Bottom);return s&&this.setEnd(t),s}setEnd(e){this.end|=e}unsetEnd(e){this.end^=e}splice(t,s,...a){const n=super.splice(t,s,...a);if(!this.length){const t=e.slices,s=t.indexOf(this);-1!==s&&(1===t.length?this.unsetEnd(i.Both):t.splice(s,1))}return n}}}constructSlice(...e){const t=new this.sliceConstructor(e.length);for(let s=0,i=e.length;s<i;++s)t[s]=e[s];return t}insertSlice(e,t=!0){if(!e.length)return;const s=this.slices[0];if(!s.length)return s.push(...e),s;const i=e[e.length-1],a=e[0];let n,o=-1,r=-1,d=0;for(;d<this.slices.length&&(n=this.slices[d],o=n.indexOf(i),r=n.indexOf(a),-1===r||-1===o)&&(-1===r&&-1===o);++d);if(-1!==r&&-1!==o);else if(-1!==r){const t=e.slice(n.length-r);n.push(...t)}else if(-1!==o){const t=e.slice(0,e.length-o-1);n.unshift(...t)}else{let t=0;for(const s=this.slices.length;t<s;++t){const s=this.slices[t];if(e[0]>s[0])break}this.slices.splice(t,0,this.constructSlice(...e)),d=t}return t?this.flatten(d):void 0}flatten(e){if(this.slices.length>=2)for(let t=0,s=this.slices.length;t<s-1;++t){const i=this.slices[t],a=this.slices[t+1];-1!==i.indexOf(a[0])&&(i.setEnd(a.end),this.slices.splice(t+1,1),t<e&&--e,--s,--t,this.insertSlice(a,!1))}return this.slices[e]}get first(){return this.slices[0]}get last(){return this.slices[this.slices.length-1]}get slice(){return this.first}get length(){return this.slice.length}findSlice(e){for(let t=0,s=this.slices.length;t<s;++t){const s=this.slices[t],i=s.indexOf(e);if(-1!==i)return{slice:s,index:i}}}findSliceOffset(e){let t;for(let s=0;s<this.slices.length;++s){let i=0;if(t=this.slices[s],!(t.length<2))for(;i<t.length;i++)if(e>=t[i])return{slice:t,offset:e===t[i]?i:i-1}}if(t&&t.isEnd(i.Top))return{slice:t,offset:t.length}}sliceMe(e,t,s){let a=this.slice,n=0,o=0;if(e){const t=this.findSliceOffset(e);if(!t)return;a=t.slice,n=o=t.offset,a.includes(e)&&(o+=1)}let r=Math.max(o+t,0),d=o+t+s;const l=a.slice(r,d),c=t<0?s+t:s,h=Math.abs(t),p=a.length-o>=c||!!a.isEnd(i.Top)&&(l.setEnd(i.Top),!0),u=o-h>=0||!!a.isEnd(i.Bottom)&&(l.setEnd(i.Bottom),!0);return{slice:l,offsetIdOffset:n,fulfilled:i.None|(p&&u?i.Both:(p?i.Top:i.None)|(u?i.Bottom:i.None))}}unshift(...e){let t=this.first;t.length?t.isEnd(i.Bottom)||(t=this.constructSlice(),t.setEnd(i.Bottom),this.slices.unshift(t)):t.setEnd(i.Bottom),t.unshift(...e)}push(...e){let t=this.last;t.length?t.isEnd(i.Top)||(t=this.constructSlice(),t.setEnd(i.Top),this.slices.push(t)):t.setEnd(i.Top),t.push(...e)}delete(e){const t=this.findSlice(e);return!!t&&(t.slice.splice(t.index,1),!0)}}a.a&&(a.a.SlicedArray=n)},,function(e,t,s){"use strict";function i(e,t){if(e.parentElement===t)return e;for(;e.parentElement;)if((e=e.parentElement).parentElement===t)return e;return null}s.d(t,"a",(function(){return i}))},function(e,t,s){"use strict";var i=s(9),a=s(15),n=s(24),o=s(13),r=s(16),d=s(10),l=s(52),c=s(29),h=s(30),p=s(20);const u=new class{constructor(){this.polls={},this.results={},this.log=Object(n.b)("POLLS",n.a.Error),d.default.addMultipleEventsListeners({updateMessagePoll:e=>{this.log("updateMessagePoll:",e);let t=e.poll||this.polls[e.poll_id];t&&(t=this.savePoll(t,e.results),d.default.dispatchEvent("poll_update",{poll:t,results:e.results}))}})}savePoll(e,t){const s=e.id;return this.polls[s]?(e=Object.assign(this.polls[s],e),this.saveResults(e,t),e):(this.polls[s]=e,e.rQuestion=r.a.wrapEmojiText(e.question),e.rReply=r.a.wrapEmojiText("📊")+" "+(e.rQuestion||"poll"),e.chosenIndexes=[],this.saveResults(e,t),e)}saveResults(e,t){var s;this.results[e.id]?t=Object.assign(this.results[e.id],t):this.results[e.id]=t,t.pFlags.min||(e.chosenIndexes.length=0,(null===(s=null==t?void 0:t.results)||void 0===s?void 0:s.length)&&t.results.forEach((t,s)=>{var i;(null===(i=t.pFlags)||void 0===i?void 0:i.chosen)&&e.chosenIndexes.push(s)}))}getPoll(e){return{poll:this.polls[e],results:this.results[e]}}getInputMediaPoll(e,t,s,i){return s?(i||(i=[]),s=r.a.parseMarkdown(s,i)):s=void 0,{_:"inputMediaPoll",poll:e,correct_answers:t,solution:s,solution_entities:s?i:void 0}}sendVote(e,t){const s=e.media.poll,i=t.map(e=>s.answers[e].option),a=e.mid,n=e.peerId,r=h.a.getInputPeerById(n);return e.pFlags.is_outgoing?c.a.invokeAfterMessageIsSent(a,"sendVote",e=>(this.log("invoke sendVote callback"),this.sendVote(e,t))):o.a.invokeApi("messages.sendVote",{peer:r,msg_id:c.a.getServerMessageId(e.mid),options:i}).then(e=>{this.log("sendVote updates:",e),l.a.processUpdateMessage(e)})}getResults(e){const t=h.a.getInputPeerById(e.peerId);return o.a.invokeApi("messages.getPollResults",{peer:t,msg_id:c.a.getServerMessageId(e.mid)}).then(e=>{l.a.processUpdateMessage(e),this.log("getResults updates:",e)})}getVotes(e,t,s,i=20){return o.a.invokeApi("messages.getPollVotes",{peer:h.a.getInputPeerById(e.peerId),id:c.a.getServerMessageId(e.mid),option:t,offset:s,limit:i}).then(e=>(this.log("getPollVotes messages:",e),p.a.saveApiUsers(e.users),e))}stopPoll(e){const t=e.media.poll;if(t.pFlags.closed)return Promise.resolve();const s=Object(a.a)(t);return s.pFlags.closed=!0,c.a.editMessage(e,void 0,{newMedia:this.getInputMediaPoll(s)}).then(()=>{},e=>{this.log.error("stopPoll error:",e)})}};i.a.appPollsManager=u,t.a=u},function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var i=s(26),a=s(39),n=s(17),o=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const r=[];let d=!1;function l(e,t="push"){return e.items.length?(e.promise=Object(i.a)(),r[t](e),function e(){if(!d){(function(e){if(!e.items.length)return e.promise.resolve([]),Promise.resolve([]);const t=e.items.slice(),s=[];return new Promise((i,r)=>{const d=()=>o(this,void 0,void 0,(function*(){const o=performance.now();do{yield Object(a.c)();const i=e.process.apply(e.context,t.shift());let n;if(i instanceof Promise)try{n=yield i}catch(e){return void r(e)}else n=i;s.push(n)}while(t.length>0&&performance.now()-o<6);t.length>0?Object(n.c)(d):i(s)}));Object(n.c)(d)}).then(e.promise.resolve,e.promise.reject)})(r.shift()).finally(()=>{d=!1,r.length&&e()})}}(),e.promise):Promise.resolve([])}const c="filter"in(document.createElement("canvas").getContext("2d")||{});let h,p;function u(e,t,s){return new Promise(i=>{const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const n=a.getContext("2d",{alpha:!1});c?(n.filter=`blur(${t}px)`,n.drawImage(e,2*-t,2*-t,a.width+4*t,a.height+4*t)):(n.drawImage(e,0,0),p(n,0,0,a.width,a.height,t,s)),i(a.toDataURL())})}h=c?Promise.resolve():s.e(30).then(s.bind(null,125)).then(e=>{p=e.default});const g=new Map;function m(e,t=2,s=2){if(!e)return console.error("no dataUri for blur",e),Promise.resolve(e);if(g.size>1e3&&g.clear(),g.has(e))return g.get(e);const i=new Promise(i=>{h.then(()=>{const a=new Image;a.onload=()=>{c?u(a,t,s).then(i):l({items:[[a,t,s]],context:null,process:u},"unshift").then(e=>{i(e[0])})},a.src=e})});return g.set(e,i),i}},,,,,,function(e,t,s){"use strict";var i=s(10),a=s(30),n=s(29),o=s(52),r=s(16),d=s(57),l=s(13),c=s(28),h=s(15),p=s(110),u=s(9),g=s(66),m=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const f=new class{constructor(){this.drafts={},this.getAllDraftPromise=null,g.a.get("drafts").then(e=>{this.drafts=e||{}}),i.default.addMultipleEventsListeners({updateDraftMessage:e=>{const t=a.a.getPeerId(e.peer);this.saveDraft(t,e.threadId,e.draft,{notify:!0})}})}getKey(e,t){return e+(t?"_"+t:"")}getDraft(e,t){return this.drafts[this.getKey(e,t)]}addMissedDialogs(){return this.getAllDrafts().then(()=>{for(const e in this.drafts){if(-1!==e.indexOf("_"))continue;const t=+e;n.a.getDialogOnly(t)||n.a.reloadConversation(t)}})}getAllDrafts(){return this.getAllDraftPromise||(this.getAllDraftPromise=new Promise(e=>{l.a.invokeApi("messages.getAllDrafts").then(t=>{(o.a.updatesState.syncLoading||Promise.resolve()).then(()=>{o.a.processUpdateMessage(t)}),e()})}))}saveDraft(e,t,s,a={}){const n=this.processApiDraft(s),o=this.getKey(e,t);return n?this.drafts[o]=n:delete this.drafts[o],g.a.set({drafts:this.drafts}),a.notify&&i.default.dispatchEvent("draft_updated",{peerId:e,threadId:t,draft:n}),n}draftsAreEqual(e,t){if(typeof e!=typeof t)return!1;if(!Object(p.a)(e))return!0;if(e._!==t._)return!1;if("draftMessage"===e._&&t._===e._){if(e.reply_to_msg_id!==t.reply_to_msg_id)return!1;if(!Object(h.b)(e.entities,t.entities))return!1;if(e.message!==t.message)return!1;if(e.pFlags.no_webpage!==t.pFlags.no_webpage)return!1}return!0}isEmptyDraft(e){return!e||"draftMessageEmpty"===e._||!(e.reply_to_msg_id>0)&&!e.message.length}processApiDraft(e){if(!e||"draftMessage"!==e._)return;const t=r.b.parseEntities(e.message),s=e.entities||[],i=r.b.mergeEntities(s.slice(),t);return e.rMessage=r.b.wrapDraftText(e.message,{entities:i}),e.reply_to_msg_id&&(e.reply_to_msg_id=n.a.generateMessageId(e.reply_to_msg_id)),e}syncDraft(e,t,s,i=!0){return m(this,void 0,void 0,(function*(){const o=this.getDraft(e,t);if(this.draftsAreEqual(o,s))return!0;let r,h={peer:a.a.getInputPeerById(e),message:""};if(this.isEmptyDraft(s))r={_:"draftMessageEmpty"};else{let e=s.message,t=s.entities;s.reply_to_msg_id&&(h.reply_to_msg_id=n.a.getServerMessageId(s.reply_to_msg_id)),(null==t?void 0:t.length)&&(h.entities=n.a.getInputEntities(t)),s.pFlags.no_webpage&&(h.no_webpage=s.pFlags.no_webpage),h.message=e}const p=r||s;return p.date=Object(c.h)(!0)+d.a.serverTimeOffset,this.saveDraft(e,t,p,{notify:!0}),!(i&&!t)||l.a.invokeApi("messages.saveDraft",h)}))}};u.a.appDraftsManager=f,t.a=f},function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var i=s(46);const a=new Map,n=new Set,o='Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif';let r;const d=()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(l)},l=()=>{n.forEach(c),n.clear()};window.addEventListener("resize",()=>{for(const[e]of a)n.add(e);d()},{capture:!0,passive:!0});const c=e=>{let t=a.get(e);const s=!t;let{text:n,textLength:r,from:d,multiplier:l,font:c,textWidth:h,elementWidth:u}=t||{};s&&(n=e.textContent,r=n.length,d=50,l=d>0&&d/100,c=`${e.dataset.fontWeight||400} 16px ${o}`,h=p(n,c),u=e.getBoundingClientRect().width,t={text:n,textLength:r,from:d,multiplier:l,font:c,textWidth:h,elementWidth:u},a.set(e,t));const g=e.getBoundingClientRect().width,m=s||u!==g;if(!s&&m&&(t.elementWidth=u=g),m)if(h>u){e.setAttribute("title",n);let s=n,a=u;for(;s.length>3;){let t=s.length;const n=l&&Object(i.a)(l*t<<0,1,t-2)||Math.max(t+d-1,1),o=s.substr(0,n).replace(/\s*$/,""),r=s.substr(n+1).replace(/^\s*/,"");if(s=o+r,a=p(s+"…",c),a<u){e.textContent=o+"…"+r;break}}t.elementWidth=e.getBoundingClientRect().width}else e.removeAttribute("title")};let h;function p(e,t){if(!h){const e=document.createElement("canvas");h=e.getContext("2d"),h.font=t}return h.measureText(e).width}class u extends HTMLElement{constructor(){super()}connectedCallback(){a.set(this,null),n.add(this),d()}disconnectedCallback(){a.delete(this)}}customElements.define("middle-ellipsis-element",u)},function(e,t,s){"use strict";var i=s(62),a=s(25),n=s(56),o=s(16),r=s(10),d=s(37),l=s(30),c=s(35),h=s(20);const p=new class{constructor(){this.savedAvatarURLs={}}removeFromAvatarsCache(e){this.savedAvatarURLs[e]&&delete this.savedAvatarURLs[e]}loadAvatar(e,t,s){const i=l.a.getInputPeerById(e);let a,n=!1,o=this.savedAvatarURLs[e];if(o&&o[s])"string"!=typeof o[s]?a=o[s]:(a=Promise.resolve(o[s]),n=!0);else{o||(o=this.savedAvatarURLs[e]={});const n={_:"inputPeerPhotoFileLocation",pFlags:{},peer:i,photo_id:t.photo_id};"photo_big"===s&&(n.pFlags.big=!0);const r={dcId:t.dc_id,location:n},l=d.a.download(r);a=o[s]=l.then(e=>o[s]=URL.createObjectURL(e))}return{cached:n,loadPromise:a}}putAvatar(e,t,s,o,d=new Image,l=!1){let h,p,{cached:u,loadPromise:g}=this.loadAvatar(t,s,o);if(u)p=()=>{Object(a.a)(e,d),e.dataset.color=""};else{const t=r.default.settings.animationsEnabled;let o;if(t&&d.classList.add("fade-in"),s.stripped_thumb){o=new Image,e.classList.add("avatar-relative"),o.classList.add("avatar-photo","avatar-photo-thumbnail"),d.classList.add("avatar-photo");const t=c.a.getPreviewURLFromBytes(s.stripped_thumb);h=Object(i.a)(o,t).then(()=>{Object(a.a)(e,o)})}p=()=>{s.stripped_thumb?e.append(d):Object(a.a)(e,d),setTimeout(()=>{e.childElementCount&&n.a.mutateElement(d,()=>{e.dataset.color="",t&&d.classList.remove("fade-in"),o&&o.remove()})},t?200:0)}}const m=g.then(e=>Object(i.a)(d,e)).then(()=>p());return{cached:u,loadPromise:h||m}}putPhoto(e,t,s=!1,i="",a=!1){var n;const d=l.a.getPeerPhoto(t),c=!!d,p=e.firstElementChild&&!e.firstElementChild.classList.contains("emoji"),u=r.default.myId;if(t===u&&s)return e.innerText="",e.dataset.color="",e.classList.add("tgico-saved"),void e.classList.remove("tgico-deletedaccount");if(t>0){const s=h.a.getUser(t);if(s&&s.pFlags&&s.pFlags.deleted)return e.innerText="",e.dataset.color=l.a.getPeerColorById(t),e.classList.add("tgico-deletedaccount"),void e.classList.remove("tgico-saved")}if(!c||!p||!this.savedAvatarURLs[t]){let a,r="";if(!t||t===u&&s||(r=l.a.getPeerColorById(t)),e.innerText="",e.classList.remove("tgico-saved","tgico-deletedaccount"),e.dataset.color=r,i)a=o.b.getAbbreviation(i);else{a=null!==(n=l.a.getPeer(t).initials)&&void 0!==n?n:""}e.innerHTML=a}return c?this.putAvatar(e,t,d,"photo_small",void 0,a):void 0}};t.a=p},,,,,function(e,t,s){"use strict";var i=s(9),a=s(0),n=s(24),o=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{d(i.next(e))}catch(e){n(e)}}function r(e){try{d(i.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}d((i=i.apply(e,t||[])).next())}))};const r=new class{constructor(){this.sampleRate=48e3,this.tasks=[],this.keepAlive=!1,this.log=Object(n.b)("OPUS",n.a.Error)}isPlaySupported(){if(void 0!==this.isPlaySupportedResult)return this.isPlaySupportedResult;const e=document.createElement("audio");return this.isPlaySupportedResult=!(!e.canPlayType||!e.canPlayType("audio/ogg;").replace(/no/,""))}loadWavWorker(){this.wavWorker||(this.wavWorker=new Worker("waveWorker.min.js"),this.wavWorker.addEventListener("message",e=>{const t=e.data;if(this.log("[WAV] got message:",t),t&&t.page){const e=t.page;this.onTaskEnd(this.tasks.shift(),e)}}))}loadWorker(){this.worker||(this.worker=new Worker("decoderWorker.min.js"),this.worker.addEventListener("message",e=>{const t=e.data;this.log("[DECODER] got message",t),"done"===t.type?(this.wavWorker.postMessage({command:"done"}),t.waveform&&(this.tasks[0].waveform=t.waveform)):this.wavWorker.postMessage({command:"encode",buffers:e.data},a.isSafari?void 0:t.map(e=>e.buffer))}))}setKeepAlive(e){this.keepAlive=e,this.keepAlive?(this.loadWorker(),this.loadWavWorker()):this.tasks.length||this.terminateWorkers()}onTaskEnd(e,t){t?(clearTimeout(e.timeout),e.callback.resolve({bytes:t,waveform:e.waveform})):e.callback.reject("timeout"),this.tasks.length&&this.executeNewTask(this.tasks[0]),this.terminateWorkers()}terminateWorkers(e=!1){(!this.keepAlive&&!this.tasks.length||e)&&(this.worker&&(this.worker.terminate(),this.worker=null),this.wavWorker&&(this.wavWorker.terminate(),this.wavWorker=null))}executeNewTask(e){this.worker.postMessage({command:"init",decoderSampleRate:this.sampleRate,outputBufferSampleRate:this.sampleRate}),this.wavWorker.postMessage({command:"init",wavBitDepth:16,wavSampleRate:this.sampleRate}),this.log("[DECODER] send decode"),this.worker.postMessage({command:"decode",pages:e.pages,waveform:e.withWaveform},a.isSafari?void 0:[e.pages.buffer]),e.timeout=window.setTimeout(()=>{this.log.error("decode timeout"),this.terminateWorkers(!0),this.tasks.length&&(this.loadWorker(),this.loadWavWorker()),this.onTaskEnd(this.tasks.shift())},1e4)}pushDecodeTask(e,t){return new Promise((s,i)=>{const a={pages:e,withWaveform:t,callback:{resolve:s,reject:i},timeout:0};this.loadWorker(),this.loadWavWorker(),1===this.tasks.push(a)&&this.executeNewTask(a)})}decode(e,t=!1){return o(this,void 0,void 0,(function*(){return this.pushDecodeTask(e,t).then(e=>{const t=new Blob([e.bytes],{type:"audio/wav"});return{url:URL.createObjectURL(t),waveform:e.waveform}})}))}};i.a.opusDecodeController=r,t.a=r},function(e,t,s){"use strict";var i=s(35),a=s(49),n=s(16),o=s(10),r=s(15),d=s(61);t.a=new class{constructor(){this.webpages={},this.pendingWebPages={},o.default.addMultipleEventsListeners({updateWebPage:e=>{this.saveWebPage(e.webpage)}})}saveWebPage(e,t,s){e.photo&&"photo"===e.photo._?e.photo=i.a.savePhoto(e.photo,s):delete e.photo,e.document&&"document"===e.document._?e.document=a.a.saveDoc(e.document,s):("document"===e.type&&delete e.type,delete e.document);const l=e.site_name;let c=e.title||e.author||l||"";l&&c===l&&delete e.site_name,c=Object(d.f)(c,80,100),e.rTitle=n.a.wrapRichText(c,{noLinks:!0,noLinebreaks:!0});let h="";if("GitHub"===l){const t=e.url.match(/(https?:\/\/github\.com\/[^\/]+\/[^\/]+)/);t&&(h=t[0]+"/issues/{1}")}const p=Object(d.f)(e.description||"",150,180);if(e.rDescription=n.a.wrapRichText(p,{contextSite:l||"external",contextHashtag:h}),"photo"!==e.type&&"video"!==e.type&&"gif"!==e.type&&"document"!==e.type&&!e.description&&e.photo&&(e.type="photo"),t&&(void 0===this.pendingWebPages[e.id]&&(this.pendingWebPages[e.id]={}),this.pendingWebPages[e.id][t]=!0),void 0===this.webpages[e.id]?this.webpages[e.id]=e:Object(r.i)(this.webpages[e.id],e),!t&&void 0!==this.pendingWebPages[e.id]){const t=[];for(const s in this.pendingWebPages[e.id])t.push(+s);o.default.dispatchEvent("webpage_updated",{id:e.id,msgs:t})}return e}deleteWebPageFromPending(e,t){const s=e.id;this.pendingWebPages[s]&&this.pendingWebPages[s][t]&&(delete this.pendingWebPages[s][t],Object.keys(this.pendingWebPages[s]).length||delete this.pendingWebPages[s])}getWebPage(e){return this.webpages[e]}}},function(e,t,s){"use strict";function i(e){var t=document.createElement("template");return e=e.trim(),t.innerHTML=e,t.content}s.d(t,"a",(function(){return i}))},function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var i=s(37);var a=function(e,t){let s,i,a,n={},o=0,r=0,d=0,l=0,c=0;function h(){e.classList.add("crop-blur"),e.draggable=!1,a=new Image,a.src=e.src,a.draggable=!1,a.classList.add("crop-overlay-image"),t||(t=document.createElement("canvas")),s=document.createElement("div"),s.classList.add("crop-component"),i=document.createElement("div"),i.classList.add("crop-overlay");const n=document.createElement("div");n.classList.add("crop-overlay-color"),s.appendChild(i);e.parentNode.appendChild(s),s.appendChild(a),s.appendChild(e),s.appendChild(n),i.appendChild(a),a.style.maxWidth=e.width+"px",c=e.naturalWidth/e.offsetWidth;const o=e.offsetWidth/2-100,r=e.offsetHeight/2-100;p(200,200),u(o,r),g(o,r),i.addEventListener("mousedown",X,!1),i.addEventListener("touchstart",X,!1),i.addEventListener("wheel",v,!1),document.addEventListener("keypress",f,!1)}function p(e,t){d=e*c,l=t*c,i.style.width=e+"px",i.style.height=t+"px"}function u(e,t){r=t*c,o=e*c,a.style.top=-t+"px",a.style.left=-e+"px"}function g(e,t){i.style.top=t+"px",i.style.left=e+"px"}function m(e){e=e*Math.PI*2;let t,s,n,o,r=Math.floor(i.clientWidth+e),d=Math.floor(i.clientHeight+e),l=a.clientWidth,c=a.clientHeight;r<50||r>l||(t=i.offsetLeft-e/2,s=i.offsetTop-e/2,n=t+r,o=s+d,t<0&&(t=0),s<0&&(s=0),n>l||o>c||(p(r,r),u(t,s),g(t,s)))}function f(e){switch(e.preventDefault(),String.fromCharCode(e.charCode)){case"+":m(4);break;case"-":m(-4)}}function v(e){e.preventDefault(),m(e.deltaY>0?1:-1)}function X(e){e.preventDefault(),e.stopPropagation(),function(e){n.container_width=i.offsetWidth,n.container_height=i.offsetHeight,n.container_left=i.offsetLeft,n.container_top=i.offsetTop,n.mouse_x=(e.clientX||e.pageX||e.touches&&e.touches[0].clientX)+window.scrollX,n.mouse_y=(e.clientY||e.pageY||e.touches&&e.touches[0].clientY)+window.scrollY}(e),document.addEventListener("mousemove",y),document.addEventListener("touchmove",y),document.addEventListener("mouseup",_),document.addEventListener("touchend",_)}function _(e){e.preventDefault(),document.removeEventListener("mouseup",_),document.removeEventListener("touchend",_),document.removeEventListener("mousemove",y),document.removeEventListener("touchmove",y)}function y(e){let t,s,o,r,d={x:0,y:0};e.preventDefault(),e.stopPropagation(),d.x=e.pageX||e.touches&&e.touches[0].pageX,d.y=e.pageY||e.touches&&e.touches[0].pageY,t=d.x-(n.mouse_x-n.container_left),s=d.y-(n.mouse_y-n.container_top),o=i.offsetWidth,r=i.offsetHeight,t<0?t=0:t>a.offsetWidth-o&&(t=a.offsetWidth-o),s<0?s=0:s>a.offsetHeight-r&&(s=a.offsetHeight-r),u(t,s),g(t,s)}return e.complete?h():e.onload=h,{crop:function(){t.width=d,t.height=l,t.getContext("2d").drawImage(e,o,r,d,l,0,0,d,l)},removeHandlers:function(){i.removeEventListener("mousedown",X),i.removeEventListener("touchstart",X),i.removeEventListener("wheel",v),document.removeEventListener("mouseup",_),document.removeEventListener("touchend",_),document.removeEventListener("mousemove",y),document.removeEventListener("touchmove",y),document.removeEventListener("keypress",f),s.remove(),i.remove(),a.remove()}}},n=s(59),o=s(27),r=s(11);class d extends n.b{constructor(){super("popup-avatar",null,{closable:!0}),this.image=new Image,this.cropper={crop:()=>{},removeHandlers:()=>{}},this.h6=document.createElement("h6"),Object(r._i18n)(this.h6,"Popup.Avatar.Title"),this.btnClose.classList.remove("btn-icon"),this.header.append(this.h6),this.cropContainer=document.createElement("div"),this.cropContainer.classList.add("crop"),this.cropContainer.append(this.image),this.input=document.createElement("input"),this.input.type="file",this.input.style.display="none",this.input.addEventListener("change",e=>{const t=e.target.files[0];if(!t)return;const s=new FileReader;s.onload=e=>{const t=e.target.result;this.image=new Image,this.cropContainer.append(this.image),this.image.src=t,this.image.onload=()=>{this.show(),this.cropper=a(this.image,this.canvas),this.input.value=""}},s.readAsDataURL(t)},!1),this.btnSubmit=document.createElement("button"),this.btnSubmit.className="btn-primary btn-color-primary btn-circle btn-crop btn-icon tgico-check z-depth-1",Object(o.ripple)(this.btnSubmit),this.btnSubmit.addEventListener("click",()=>{this.cropper.crop(),this.btnClose.click(),this.canvas.toBlob(e=>{this.blob=e,this.darkenCanvas(),this.resolve()},"image/jpeg",1)}),this.container.append(this.cropContainer,this.btnSubmit,this.input),this.onCloseAfterTimeout=()=>{this.cropper.removeHandlers(),this.image&&this.image.remove()}}resolve(){this.onCrop(()=>i.a.upload(this.blob))}open(e,t){this.canvas=e,this.onCrop=t,this.input.click()}darkenCanvas(){let e=this.canvas.getContext("2d");e.fillStyle="rgba(0, 0, 0, 0.3)",e.fillRect(0,0,this.canvas.width,this.canvas.height)}}},,function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));s(63);var i=0,a=0;for(i=0;1<<i+1>1<<i;i++);a=(1<<(i>>=1))-1;n(1,1,1),n(0,1,1),new Array(0);function n(e,t,s){var a;a=s>(a=Math.ceil(t/i)+1)?s:a;var n=new Array(a);return o(n,e),n}function o(e,t){var s,n,o=e.length;for(n=t,s=0;s<o;s++)e[s]=n&a,n>>=i}s(55);function r(e){return"object"==typeof e&&null!==e}},,,,,function(e,t,s){"use strict";s.r(t);var i=s(19),a=s(31),n=s(22),o=s(108),r=s(21),d=s(11),l=s(13),c=s(16),h=s(73),p=s(50),u=s(2),g=s(25);let m=null;const f=new p.a("page-signUp",!0,()=>Promise.resolve().then(s.bind(null,58)).then(e=>{const t=new h.a({className:"page-signUp",withInputWrapper:!0,titleLangKey:"YourName",subtitleLangKey:"Login.Register.Subtitle"});t.imageDiv.classList.add("avatar-edit"),t.title.classList.add("fullName");const r=document.createElement("canvas");r.id="canvas-avatar",r.className="avatar-edit-canvas";const p=document.createElement("span");p.className="tgico tgico-cameraadd",t.imageDiv.append(r,p);const f=e.default;let v;t.imageDiv.addEventListener("click",()=>{(new o.a).open(r,e=>{v=e})});const X=e=>{const s=_.value||"",i=y.value||"",a=s||i?(s+" "+i).trim():"";a?Object(g.a)(t.title,c.b.wrapEmojiText(a)):Object(g.a)(t.title,Object(d.i18n)("YourName"))};const _=new a.b({label:"FirstName",maxLength:70}),y=new a.b({label:"LastName",maxLength:64}),b=Object(i.a)("btn-primary btn-color-primary"),M=new d.default.IntlElement({key:"StartMessaging"});return b.append(M.element),t.inputWrapper.append(_.container,y.container,b),_.input.addEventListener("input",X),y.input.addEventListener("input",X),b.addEventListener("click",(function(e){if(_.input.classList.contains("error")||y.input.classList.contains("error"))return!1;if(!_.value.length)return _.input.classList.add("error"),!1;this.disabled=!0;const t=_.value.trim(),i=y.value.trim(),a={phone_number:m.phone_number,phone_code_hash:m.phone_code_hash,first_name:t,last_name:i};M.update({key:"PleaseWait"});const o=Object(n.f)(this);l.a.invokeApi("auth.signUp",a).then(e=>{switch(e._){case"auth.authorization":l.a.setUserAuth(e.user.id),new Promise((e,t)=>{if(!v)return e();v().then(s=>{f.uploadProfilePhoto(s).then(e,t)},t)}).finally(()=>{s.e(5).then(s.bind(null,69)).then(e=>{e.default.mount()})});break;default:M.update({key:e._}),this.removeAttribute("disabled"),o.remove()}}).catch(e=>{this.removeAttribute("disabled"),o.remove(),e.type,M.update({key:e.type})})})),Object(u.a)(),new Promise(e=>{window.requestAnimationFrame(e)})}),e=>{m=e,r.default.pushToState("authState",{_:"authStateSignUp",authCode:e})});t.default=f}]]);
//# sourceMappingURL=12.27915462f7b0b96460c9.chunk.js.map