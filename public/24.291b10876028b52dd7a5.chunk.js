(this.webpackJsonp=this.webpackJsonp||[]).push([[24],{20:function(e,t,n){"use strict";n.r(t);var a=n(27),i=n(59),o=n(55),r=n(76),s=n(32),d=n(5),l=n(31),c=n(12),u=n(15),g=n(13),p=n(33),m=n(80),f=function(e,t,n,a){return new(n||(n=Promise))((function(i,o){function r(e){try{d(a.next(e))}catch(e){o(e)}}function s(e){try{d(a.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}d((a=a.apply(e,t||[])).next())}))};let h;const y=new i.a("page-signQR",!0,()=>h,()=>{h||(h=f(void 0,void 0,void 0,(function*(){const e=y.pageEl.querySelector(".auth-image");let t=Object(p.f)(e,!0);const i=document.createElement("div");i.classList.add("input-wrapper");const u=Object(l.a)("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});i.append(u),Object(m.a)(i);const v=e.parentElement,b=document.createElement("h4");Object(c._i18n)(b,"Login.QR.Title");const w=document.createElement("ol");w.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(e=>{const t=document.createElement("li");t.append(Object(c.i18n)(e)),w.append(t)}),v.append(b,w,i),u.addEventListener("click",()=>{Promise.all([n.e(2),n.e(18)]).then(n.bind(null,18)).then(e=>e.default.mount()),O=!0});const _=(yield Promise.all([n.e(11).then(n.t.bind(null,116,7))]))[0].default;let O=!1;g.default.addEventListener("user_auth",()=>{O=!0,h=null},!0);let E,L={ignoreErrors:!0};const k=i=>f(void 0,void 0,void 0,(function*(){try{let l=yield a.a.invokeApi("auth.exportLoginToken",{api_id:d.a.id,api_hash:d.a.hash,except_ids:[]},{ignoreErrors:!0});if("auth.loginTokenMigrateTo"===l._&&(L.dcId||(L.dcId=l.dc_id,a.a.setBaseDcId(l.dc_id)),l=yield a.a.invokeApi("auth.importLoginToken",{token:l.token},L)),"auth.loginTokenSuccess"===l._){const e=l.authorization;return a.a.setUserAuth(e.user.id),n.e(5).then(n.bind(null,17)).then(e=>e.default.mount()),!0}if(!E||!Object(r.b)(E,l.token)){E=l.token;let n="tg://login?token="+Object(r.d)(l.token).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"");const a=window.getComputedStyle(document.documentElement),i=a.getPropertyValue("--surface-color").trim(),o=a.getPropertyValue("--primary-text-color").trim(),d=a.getPropertyValue("--primary-color").trim(),c=yield fetch("assets/img/logo_padded.svg").then(e=>e.text()).then(e=>{e=e.replace(/(fill:).+?(;)/,`$1${d}$2`);const t=new Blob([e],{type:"image/svg+xml;charset=utf-8"});return new Promise(e=>{const n=new FileReader;n.onload=t=>{e(t.target.result)},n.readAsDataURL(t)})}),u=new _({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:n,image:c,dotsOptions:{color:o,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:i},qrOptions:{errorCorrectionLevel:"L"}});let g;u.append(e),e.lastChild.classList.add("qr-canvas"),g=u._drawingPromise?u._drawingPromise:Promise.race([Object(s.e)(1e3),new Promise(e=>{u._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>e())},{once:!0})})]),yield g.then(()=>{if(t){t.style.animation="hide-icon .4s forwards";const n=e.children[1];n.style.display="none",n.style.animation="grow-icon .4s forwards",setTimeout(()=>{n.style.display=""},150),setTimeout(()=>{n.style.animation=""},500),t=void 0}else Array.from(e.children).slice(0,-1).forEach(e=>{e.remove()})})}if(i){let e=Date.now()/1e3,t=l.expires-e-o.a.serverTimeOffset;yield Object(s.e)(t>3?3e3:1e3*t|0)}}catch(e){switch(e.type){case"SESSION_PASSWORD_NEEDED":console.warn("pageSignQR: SESSION_PASSWORD_NEEDED"),e.handled=!0,Promise.all([n.e(2),n.e(4),n.e(19)]).then(n.bind(null,19)).then(e=>e.default.mount()),O=!0,h=null;break;default:console.error("pageSignQR: default error:",e),O=!0}return!0}return!1}));return()=>f(void 0,void 0,void 0,(function*(){for(O=!1;!O&&!(yield k(!0)););}))}))),h.then(e=>{e()}),u.default.pushToState("authState",{_:"authStateSignQr"})});t.default=y},55:function(e,t,n){"use strict";var a=n(26),i=n(58),o=n(27);const r=new class{constructor(){this.serverTimeOffset=0,i.a.get("server_time_offset").then(e=>{e&&(this.serverTimeOffset=e)}),o.a.addTaskListener("applyServerTimeOffset",e=>{this.serverTimeOffset=e.payload})}};a.a&&(a.a.serverTimeManager=r),t.a=r},80:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(2),i=n(28),o=n(6),r=n(12),s=n(27),d=n(13),l=n(31),c=n(33);let u,g=!1,p=0;function m(e){g||(u||(u=s.a.invokeApiCacheable("help.getConfig").then(e=>e.suggested_lang_code!==r.default.lastRequestedLangCode?Promise.all([e,r.default.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),r.default.getCacheLangPack()]):[]))).then(([t,n])=>{if(!t)return;const s=[];n.forEach(e=>{const t=r.default.strings.get(e.key);t&&(s.push(t),r.default.strings.set(e.key,e))});const u=Object(l.a)("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.ContinueOnLanguage"});Object(o.a)().then(()=>{window.requestAnimationFrame(()=>{e.append(u)})}),d.default.addEventListener("language_change",()=>{u.remove()},!0),s.forEach(e=>{r.default.strings.set(e.key,e)}),Object(i.b)(u,e=>{Object(a.a)(e),u.disabled=!0,Object(c.f)(u),r.default.getLangPack(t.suggested_lang_code)})})}d.default.addEventListener("language_change",()=>{++p<2||(console.log("language_change"),g=!0)})}}]);
//# sourceMappingURL=24.291b10876028b52dd7a5.chunk.js.map