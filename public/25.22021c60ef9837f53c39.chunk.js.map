{"version":3,"sources":["webpack:///./src/pages/pageSignUp.ts","webpack:///./src/pages/loginPage.ts"],"names":["authCode","page","then","imported","className","withInputWrapper","titleLangKey","subtitleLangKey","imageDiv","classList","add","title","avatarPreview","document","createElement","id","addIco","append","appProfileManager","default","uploadAvatar","addEventListener","open","_uploadAvatar","handleInput","e","name","nameInputField","value","lastName","lastNameInputField","fullName","trim","wrapEmojiText","label","maxLength","btnSignUp","btnI18n","IntlElement","key","element","inputWrapper","container","input","contains","length","this","disabled","params","phone_number","phone_code_hash","first_name","last_name","update","preloader","invokeApi","response","_","setUserAuth","user","Promise","resolve","reject","inputFile","uploadProfilePhoto","finally","m","mount","removeAttribute","remove","catch","err","type","window","requestAnimationFrame","_authCode","pushToState","LoginPage","options","body","querySelector","subtitle"],"mappings":"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","file":"25.22021c60ef9837f53c39.chunk.js","sourcesContent":["/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type { CancellablePromise } from '../helpers/cancellablePromise';\nimport type { InputFile } from '../layer';\nimport type { AuthState } from '../types';\nimport Button from '../components/button';\nimport InputField from '../components/inputField';\nimport { putPreloader } from '../components/misc';\nimport PopupAvatar from '../components/popups/avatar';\nimport appStateManager from '../lib/appManagers/appStateManager';\nimport I18n, { i18n } from '../lib/langPack';\n//import apiManager from '../lib/mtproto/apiManager';\nimport apiManager from '../lib/mtproto/mtprotoworker';\nimport RichTextProcessor from '../lib/richtextprocessor';\nimport LoginPage from './loginPage';\nimport Page from './page';\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\nimport replaceContent from '../helpers/dom/replaceContent';\n\nlet authCode: AuthState.signUp['authCode'] = null;\n\nconst onFirstMount = () => import('../lib/appManagers/appProfileManager').then(imported => {\n  const page = new LoginPage({\n    className: 'page-signUp',\n    withInputWrapper: true,\n    titleLangKey: 'YourName',\n    subtitleLangKey: 'Login.Register.Subtitle'\n  });\n\n  page.imageDiv.classList.add('avatar-edit');\n\n  page.title.classList.add('fullName');\n\n  const avatarPreview = document.createElement('canvas');\n  avatarPreview.id = 'canvas-avatar';\n  avatarPreview.className = 'avatar-edit-canvas';\n\n  const addIco = document.createElement('span');\n  addIco.className = 'tgico tgico-cameraadd';\n\n  page.imageDiv.append(avatarPreview, addIco);\n  \n  const appProfileManager = imported.default;\n\n  let uploadAvatar: () => CancellablePromise<InputFile>;\n  page.imageDiv.addEventListener('click', () => {\n    new PopupAvatar().open(avatarPreview, (_uploadAvatar) => {\n      uploadAvatar = _uploadAvatar;\n    });\n  });\n\n  const handleInput = (e: Event) => {\n    const name = nameInputField.value || '';\n    const lastName = lastNameInputField.value || '';\n\n    const fullName = name || lastName \n      ? (name + ' ' + lastName).trim() \n      : '';\n    \n    if(fullName) replaceContent(page.title, RichTextProcessor.wrapEmojiText(fullName));\n    else replaceContent(page.title, i18n('YourName'));\n  };\n\n  let sendAvatar = () => new Promise<void>((resolve, reject) => {\n    if(!uploadAvatar) {\n      //console.log('User has not selected avatar');\n      return resolve();\n    }\n\n    //console.log('invoking uploadFile...');\n    uploadAvatar().then((inputFile) => {\n      //console.log('uploaded smthn', inputFile);\n  \n      appProfileManager.uploadProfilePhoto(inputFile).then(resolve, reject);\n    }, reject);\n  });\n\n  const nameInputField = new InputField({\n    label: 'FirstName',\n    maxLength: 70\n  });\n\n  const lastNameInputField = new InputField({\n    label: 'LastName',\n    maxLength: 64\n  });\n\n  const btnSignUp = Button('btn-primary btn-color-primary');\n  const btnI18n = new I18n.IntlElement({key: 'StartMessaging'});\n  btnSignUp.append(btnI18n.element);\n\n  page.inputWrapper.append(nameInputField.container, lastNameInputField.container, btnSignUp);\n\n  nameInputField.input.addEventListener('input', handleInput);\n  lastNameInputField.input.addEventListener('input', handleInput);\n\n  btnSignUp.addEventListener('click', function(this: typeof btnSignUp, e) {\n    if(nameInputField.input.classList.contains('error') || lastNameInputField.input.classList.contains('error')) {\n      return false;\n    }\n\n    if(!nameInputField.value.length) {\n      nameInputField.input.classList.add('error');\n      return false;\n    }\n\n    this.disabled = true;\n\n    const name = nameInputField.value.trim();\n    const lastName = lastNameInputField.value.trim();\n\n    const params = {\n      phone_number: authCode.phone_number,\n      phone_code_hash: authCode.phone_code_hash,\n      first_name: name,\n      last_name: lastName\n    };\n\n    //console.log('invoking auth.signUp with params:', params);\n\n    btnI18n.update({key: 'PleaseWait'});\n    const preloader = putPreloader(this);\n\n    apiManager.invokeApi('auth.signUp', params)\n    .then((response) => {\n      //console.log('auth.signUp response:', response);\n      \n      switch(response._) {\n        case 'auth.authorization': // success\n          apiManager.setUserAuth(response.user.id);\n\n          sendAvatar().finally(() => {\n            import('./pageIm').then(m => {\n              m.default.mount();\n            });\n          });\n          \n          break;\n        default:\n          btnI18n.update({key: response._ as any});\n          this.removeAttribute('disabled');\n          preloader.remove();\n          break;\n      }\n\n      /* (document.body.getElementsByClassName('page-sign')[0] as HTMLDivElement).style.display = 'none';\n      pageAuthCode(Object.assign(code, {phoneNumber})); */\n    }).catch(err => {\n      this.removeAttribute('disabled');\n      preloader.remove();\n\n      switch(err.type) {\n        default:\n          btnI18n.update({key: err.type});\n          break;\n      }\n    });\n  });\n\n  blurActiveElement();\n  return new Promise((resolve) => {\n    window.requestAnimationFrame(resolve);\n  });\n});\n\nconst page = new Page('page-signUp', true, onFirstMount, (_authCode: typeof authCode) => {\n  authCode = _authCode;\n\n  appStateManager.pushToState('authState', {_: 'authStateSignUp', authCode: _authCode});\n});\n\nexport default page;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport { LangPackKey, i18n } from \"../lib/langPack\";\n\nexport default class LoginPage {\n  public element: HTMLElement;\n  public container: HTMLElement;\n  public imageDiv: HTMLElement;\n  public inputWrapper: HTMLElement;\n  public title: HTMLElement;\n  public subtitle: HTMLParagraphElement;\n\n  constructor(options: {\n    className: string,\n    withInputWrapper?: boolean,\n    titleLangKey?: LangPackKey,\n    subtitleLangKey?: LangPackKey,\n  }) {\n    this.element = document.body.querySelector('.' + options.className) as HTMLDivElement;\n    //this.element = document.createElement('div');\n    //this.element.className = 'page-' + options.className;\n\n    this.container = document.createElement('div');\n    this.container.className = 'container center-align';\n\n    this.imageDiv = document.createElement('div');\n    this.imageDiv.className = 'auth-image';\n\n    this.title = document.createElement('h4');\n    if(options.titleLangKey) {\n      this.title.append(i18n(options.titleLangKey));\n    }\n\n    this.subtitle = document.createElement('p');\n    this.subtitle.className = 'subtitle';\n    if(options.subtitleLangKey) {\n      this.subtitle.append(i18n(options.subtitleLangKey));\n    }\n    \n    this.container.append(this.imageDiv, this.title, this.subtitle);\n\n    if(options.withInputWrapper) {\n      this.inputWrapper = document.createElement('div');\n      this.inputWrapper.className = 'input-wrapper';\n      this.container.append(this.inputWrapper);\n    }\n\n    this.element.append(this.container);\n  }\n}\n"],"sourceRoot":""}