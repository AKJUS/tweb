const __vite__fileDeps=["./pageSignIn-Dw-2Aaoj.js","./index-4ugwRoSj.js","./index-BoJ0raUO.css","./putPreloader-DHZpVoox.js","./page-BJ2GTZdy.js","./countryInputField-BKbl9wI1.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-CvBVNv73.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-DWPLw3Lc.js","./pagePassword-0H3tUjuI.js","./loginPage-D1rgGi0E.js","./htmlToSpan-DhAls8qz.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{z as d,B as R,l as $,d as c,k as z,x as F,M as H,v as N,q as j,h as W,_ as E,C as U,A as P,D as T}from"./index-4ugwRoSj.js";import{P as G}from"./page-BJ2GTZdy.js";import{p as O}from"./putPreloader-DHZpVoox.js";import{b as J,t as K}from"./textToSvgURL-Cnw_Q8Rw.js";let b=!1;function X(){return C||(C=c.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==d.lastRequestedLangCode?Promise.all([e,d.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),d.getCacheLangPackAndApply()]):[]))}let C;function Y(e){b||X().then(([t,u])=>{if(!t)return;const s=[];u.forEach(i=>{const m=d.strings.get(i.key);m&&(s.push(m),d.strings.set(i.key,i))});const o="Login.ContinueOnLanguage",a=R("btn-primary btn-secondary btn-primary-transparent primary",{text:o});a.lastElementChild.classList.remove("i18n"),$({text:[d.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(a)})}),c.addEventListener("language_apply",()=>{a.remove()},{once:!0}),s.forEach(i=>{d.strings.set(i.key,i)}),z(a,i=>{F(i),b=!0,a.disabled=!0,O(a),d.getLangPackAndApply(t.suggested_lang_code)})})}function Z(e,t){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function x(e){let t,u="";for(let s=e.length,o=0,a=0;a<s;++a)t=a%3,o|=e[a]<<(16>>>t&24),(t===2||s-a===1)&&(u+=String.fromCharCode(L(o>>>18&63),L(o>>>12&63),L(o>>>6&63),L(o&63)),o=0);return u.replace(/A(?=A$|$)/g,"=")}function L(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}H.bytesToBase64=x;const A=3,ee=async()=>{const t=I.pageEl.querySelector(".auth-image");let u=O(t,!0);const s=document.createElement("div");s.classList.add("input-wrapper");const o=R("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});s.append(o),N()===1&&Y(s);const a=t.parentElement,i=document.createElement("h4");j(i,"Login.QR.Title");const m=document.createElement("ol");m.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(l=>{const p=document.createElement("li");p.append(W(l)),m.append(p)}),a.append(i,m,s),o.addEventListener("click",()=>{E(()=>import("./pageSignIn-Dw-2Aaoj.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url).then(l=>l.default.mount()),f=!0});const M=(await Promise.all([E(()=>import("./qr-code-styling-CvBVNv73.js").then(l=>l.q),__vite__mapDeps([7,8]),import.meta.url)]))[0].default;let f=!1;c.addEventListener("user_auth",l=>{f=!0,_=null},{once:!0});const k={ignoreErrors:!0};let w;const q=async l=>{try{const p=await U.getUserIds();let n=await c.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:P.id,api_hash:P.hash,except_ids:p.map(g=>g.toUserId())},{ignoreErrors:!0});if(n._==="auth.loginTokenMigrateTo"&&(k.dcId||(k.dcId=n.dc_id,c.managers.apiManager.setBaseDcId(n.dc_id)),n=await c.managers.apiManager.invokeApi("auth.importLoginToken",{token:n.token},k)),n._==="auth.loginTokenSuccess"){const g=n.authorization;return await c.managers.apiManager.setUser(g.user),E(()=>import("./pageIm-DWPLw3Lc.js"),__vite__mapDeps([9,1,2,4]),import.meta.url).then(h=>h.default.mount()),!0}if(!w||!J(w,n.token)){w=n.token;const g=x(n.token),h="tg://login?token="+Z(g,!0),v=window.getComputedStyle(document.documentElement),B=v.getPropertyValue("--surface-color").trim(),D=v.getPropertyValue("--primary-text-color").trim(),Q=v.getPropertyValue("--primary-color").trim(),V=await fetch("assets/img/logo_padded.svg").then(r=>r.text()).then(r=>(r=r.replace(/(fill:).+?(;)/,`$1${Q}$2`),K(r))),y=new M({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:h,image:V,dotsOptions:{color:D,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:B},qrOptions:{errorCorrectionLevel:"L"}});y.append(t),t.lastChild.classList.add("qr-canvas");let S;y._drawingPromise?S=y._drawingPromise:S=Promise.race([T(1e3),new Promise(r=>{y._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>r())},{once:!0})})]),await S.then(()=>{if(u){u.style.animation="hide-icon .4s forwards";const r=t.children[1];r.style.display="none",r.style.animation="grow-icon .4s forwards",setTimeout(()=>{r.style.display=""},150),setTimeout(()=>{r.style.animation=""},500),u=void 0}else Array.from(t.children).slice(0,-1).forEach(r=>{r.remove()})})}if(l){const g=Date.now()/1e3,h=n.expires-g-await c.managers.timeManager.getServerTimeOffset();await T(h>A?1e3*A:1e3*h|0)}}catch(p){switch(p.type){case"SESSION_PASSWORD_NEEDED":E(()=>import("./pagePassword-0H3tUjuI.js"),__vite__mapDeps([10,1,2,3,4,11,12]),import.meta.url).then(n=>n.default.mount()),f=!0,_=null;break;default:console.error("pageSignQR: default error:",p),f=!0;break}return!0}return!1};return async()=>{f=!1;do if(f||await q(!0))break;while(!0)}};let _;const I=new G("page-signQR",!0,()=>_,()=>{_||(_=ee()),_.then(e=>{e()}),c.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),ie=Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"}));export{ie as a,Y as g,I as p};
//# sourceMappingURL=pageSignQR-CyUD80c3.js.map
